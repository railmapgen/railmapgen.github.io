import{j as e,S as T,G as E,I as ge,T as y,c as S,i as Ve,M as U,C as N,F as z,k as ct,B as w,m as dt,P as ue,n as Be,o as ut,p as Fe,q as me,s as ht,A as te,t as $,u as pt,v as xt,w as gt,x as Z,d as A,e as _,y as B,z as K,D as $e,E as ve,H as ye,l as ie,J as F,K as se,O as je,Q as mt,U as fe,V as We,W as jt,X as ne,Y as ft,Z as bt,_ as wt,r as b,$ as St,a0 as Ct,a1 as vt,N as yt,a2 as kt,a3 as Mt,a4 as Le,a5 as Rt,a6 as Ge,L as He,a7 as ke,a8 as At,a9 as _t,aa as Lt,ab as Ot,ac as Et,ad as Tt,b as It,ae as Pt,af as Nt,ag as Dt,ah as zt,ai as Ut,f as Vt,aj as Bt,g as Ft}from"./mantine-DJ-xZ26H.js";import{n as f,r as x,o as Je,R as W,B as $t}from"./react-Bl-1YcU-.js";import{u as O,o as be,F as Wt,a as R,b as Gt,S as X,l as D,s as qe,f as oe,g as we,c as Ke,n as Ye,d as Xe,e as Ht,A as re,h as I,i as Q,j as Jt,k as V,m as Me,p as qt,q as Kt,r as G,E as P,t as Yt,v as Se,w as Xt,x as Qt,y as Zt,z as Qe,B as es,O as ts,L as he,C as Ze,D as ss,G as ns,H as os,I as as,J as is,K as rs}from"./main-Bg-kC5Gh.js";import"./index-ZBc0wcXx.js";const ls="_burger_1y0se_1",cs={burger:ls},ds="_workspace_anux8_1",us="_show_anux8_11",hs="_welcome_anux8_20",ps="_icons_anux8_35",le={workspace:ds,"app-container":"_app-container_anux8_7",show:us,welcome:hs,icons:ps},xs="/assets/rmp-logo512-eHekupnf.png";function gs(){const{t}=f(),s=O();return e.jsxs(T,{className:le.welcome,children:[e.jsxs(E,{className:le.icons,grow:!0,children:[e.jsx(ge,{src:"/logo512.png",title:t("Open")+" "+t("Rail Map Generator"),onClick:()=>s(be({appId:"rmg"}))}),e.jsx(ge,{src:xs,title:t("Open")+" "+t("Rail Map Painter"),onClick:()=>s(be({appId:"rmp"}))})]}),e.jsx(y,{children:t("Welcome to Rail Map Toolkit")}),e.jsx(S,{children:t("Select an app to start your own rail map design!")})]})}function ms(t){const{tab:s,isActive:o}=t,n=x.useMemo(()=>s.url??"/"+s.app+"/",[s.app]);return e.jsx("div",{className:Ve(le["app-container"],o&&le.show),children:e.jsx("iframe",{id:Wt+s.id,src:n,loading:"lazy",title:s.app,width:"100%",height:"100%","data-persisted-url":s.url,"data-testid":"app-container-iframe"})})}function js({alwaysShowWelcome:t}){const{openedTabs:s,activeTab:o}=R(a=>a.app),[,n]=Je();return x.useEffect(()=>{var a;if(o){const i=(a=s.find(l=>l.id===o))==null?void 0:a.app;n(i?{app:i}:{})}else n({})},[o]),e.jsx("div",{className:le.workspace,children:t||s.length===0?e.jsx(gs,{}):s.map(a=>e.jsx(ms,{tab:a,isActive:o===a.id},a.id))})}const fs="_root_1mptk_5",bs="_wrapper_1mptk_26",ws="_alert_1mptk_37",Ss="_header_1mptk_44",Cs="_body_1mptk_50",vs="_aside_1mptk_57",ys="_main_1mptk_70",q={root:fs,"show-menu":"_show-menu_1mptk_14",wrapper:bs,alert:ws,header:Ss,body:Cs,aside:vs,main:ys},ks="_card_15zs0_1",Oe={card:ks},Ee=(t,s,o)=>{const n=new Blob([o],{type:s});Ms(t,n)},Ms=(t,s)=>{const o=window.URL.createObjectURL(s),n=document.createElement("a");n.href=o,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(o)},Rs=()=>{const{t}=f(),{token:s,refreshToken:o,currentSaveId:n}=R(M=>M.account),{resolveConflictModal:{isOpen:a,lastChangedAtTimeStamp:i,lastUpdatedAtTimeStamp:l,cloudData:d}}=R(M=>M.rmpSave),u=O(),[c,h]=W.useState(!1),p=()=>u(Ht()),r=()=>{Ke(X.RMP,d),Ye(),u(Xe(l)),p()},C=()=>{Ee(`RMP_${l}.json`,"application/json",d)},k=async()=>{if(!n||!s||!o)return;h(!0);const M=await Gt(n,s,o,X.RMP);if(!M){u(D()),h(!1);return}if(M.status===409){u(qe()),h(!1);return}M.status===200&&(u(oe()),h(!1),p())},v=async()=>{const{data:M}=await we(X.RMP);Ee(`RMP_${i}.json`,"application/json",M)};return e.jsxs(U,{opened:a,onClose:()=>{},size:"lg",title:t("Oops! It seems there's a conflict"),withCloseButton:!1,closeOnClickOutside:!1,closeOnEscape:!1,centered:!0,children:[e.jsx(S,{children:t("The local save is newer than the cloud one. Which one would you like to keep?")}),e.jsxs(E,{my:"xs",children:[e.jsx(N,{withBorder:!0,className:Oe.card,children:e.jsxs(T,{children:[e.jsxs(z,{children:[e.jsx(ct,{}),e.jsx(S,{span:!0,children:t("Local save")})]}),e.jsxs(S,{span:!0,children:[t("Update at:")," ",new Date(i).toLocaleString()]}),e.jsx(w,{color:"red",loading:c,onClick:()=>k(),children:t("Replace cloud with local")}),e.jsx(w,{onClick:()=>v(),children:t("Download Local save")})]})}),e.jsx(N,{withBorder:!0,className:Oe.card,children:e.jsxs(T,{children:[e.jsxs(z,{children:[e.jsx(dt,{}),e.jsx(S,{span:!0,children:t("Cloud save")})]}),e.jsxs(S,{span:!0,children:[t("Update at:")," ",new Date(l).toLocaleString()]}),e.jsx(w,{color:"red",onClick:()=>r(),children:t("Replace local with cloud")}),e.jsx(w,{onClick:()=>C(),children:t("Download Cloud save")})]})})]})]})},As="_body_yczk0_1",_s={body:As};function Te({meets:t,label:s}){return e.jsxs(S,{c:t?"teal":"red",style:{display:"flex",alignItems:"center"},mt:7,size:"sm",children:[t?e.jsx(Fe,{size:14}):e.jsx(me,{size:14}),e.jsx(ht,{ml:10,children:s})]})}const Ce=[{re:/[0-9]/,label:"Includes number"},{re:/[a-zA-Z]/,label:"Includes letter"}];function Ls(t){let s=t.length>=8?0:1;return Ce.forEach(o=>{o.re.test(t)||(s+=1)}),Math.max(100-100/(Ce.length+1)*s,10)}function Re({value:t,onChange:s}){const{t:o}=f(),[n,a]=x.useState(!1),i=Ce.map((u,c)=>e.jsx(Te,{label:u.label,meets:u.re.test(t)},c)),l=Ls(t),d=l===100?"teal":l>50?"yellow":"red";return e.jsxs(ue,{opened:n,position:"bottom",width:"target",transitionProps:{transition:"pop"},children:[e.jsx(ue.Target,{children:e.jsx("div",{onFocusCapture:()=>a(!0),onBlurCapture:()=>a(!1),children:e.jsx(Be,{label:o("Password"),value:t,onChange:u=>s(u.currentTarget.value)})})}),e.jsxs(ue.Dropdown,{children:[e.jsx(ut,{color:d,value:l,size:5,mb:"xs"}),e.jsx(Te,{label:o("Includes at least 8 characters"),meets:t.length>=8}),i]})]})}const Os=()=>{const{t}=f(),s=O(),{isLoggedIn:o,email:n,name:a,refreshToken:i}=R(c=>c.account),[l,d]=W.useState(void 0),u=async()=>{o&&(await fetch(re+I.AUTH_LOGOUT,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({refreshToken:i})}),s(D()))};return e.jsxs(e.Fragment,{children:[e.jsxs(z,{py:"xs",align:"center",wrap:"wrap",children:[e.jsx(te,{size:"lg",name:a,color:"initials"}),e.jsxs(z,{direction:"column",ml:"xs",flex:1,children:[e.jsx(S,{span:!0,fw:"bold",children:a}),e.jsx(S,{span:!0,size:"sm",children:n})]}),e.jsxs(z,{ml:"auto",children:[e.jsx($,{variant:"subtle",color:"gray",size:"sm",onClick:()=>d("name"),"aria-label":t("Change name"),title:t("Change name"),children:e.jsx(pt,{})}),e.jsx($,{variant:"subtle",color:"gray",size:"sm",onClick:()=>d("password"),"aria-label":t("Change password"),title:t("Change password"),children:e.jsx(xt,{})}),e.jsx($,{variant:"subtle",color:"gray",size:"sm",onClick:u,"aria-label":t("Log out"),title:t("Log out"),children:e.jsx(gt,{})})]})]}),e.jsx(Es,{infoType:l,onClose:()=>d(void 0)})]})};function Es(t){const{infoType:s,onClose:o}=t,{t:n}=f(),a=O(),{isLoggedIn:i,id:l,token:d}=R(r=>r.account),[u,c]=W.useState(""),h=r=>a(V({title:n("Unable to update account info"),message:r,type:"error",duration:9e3})),p=async()=>{if(!(!i||!s))try{const r=await Q(I.USER+"/"+l,{method:"PATCH",body:JSON.stringify({[s]:u})},d);if(!r){h(n("Login status expired")),a(D());return}if(r.status!==200){h(await r.text());return}if(s==="password"){a(D()),o();return}if(s==="name"){a(Jt(u)),o();return}}catch(r){h(r.message)}};return e.jsxs(U,{opened:!!s,onClose:o,title:n("Update account info"),closeOnEscape:!1,children:[s==="name"&&e.jsx(Z,{label:n("Name"),value:u,onChange:({currentTarget:{value:r}})=>c(r)}),s==="password"&&e.jsx(Re,{value:u,onChange:r=>c(r)}),e.jsx(E,{mt:"xs",children:e.jsx(w,{ml:"auto",onClick:p,children:n("Change")})})]})}const Ts=/^\S+@\S+\.\S+$/,ce=t=>!!t.match(Ts),et=t=>t.length>=8&&!!t.match(/\d/)&&!!t.match(/[a-zA-Z]/),Ie=60;function tt({value:t,onChange:s,onVerify:o,otpSent:n,allowResendOtp:a,...i}){const{t:l}=f(),[d,u]=x.useState(!1),[c,h]=x.useState(Ie),p=!!t&&ce(t),r=()=>{a&&(u(!0),h(Ie)),o()};return x.useEffect(()=>{let C;return d&&c>0?C=window.setTimeout(()=>{h(c-1)},1e3):c===0&&u(!1),()=>clearTimeout(C)},[d,c]),e.jsx(Z,{type:"email",label:l("Email"),value:t,onChange:({currentTarget:{value:C}})=>s(C),error:t&&!ce(t),rightSection:n?e.jsx(w,{variant:"transparent",size:"xs",leftSection:e.jsx(Fe,{}),disabled:!0,children:l("Verification code sent")}):e.jsx(w,{variant:"subtle",size:"xs",onClick:r,disabled:!p||d,children:d?`${c}s`:l("Send verification code")}),rightSectionWidth:"fit-content",...i})}const Is=t=>{const{t:s}=f(),o=O(),[n,a]=x.useState(""),[i,l]=x.useState(""),[d,u]=x.useState(""),[c,h]=x.useState(""),[p,r]=x.useState(!1),k=!!n&&ce(n)&&!!d&&!!i&&et(i),v=L=>o(V({title:s("Unable to reset your password"),message:L,type:"error",duration:9e3})),M=async()=>{try{const L=await fetch(re+I.AUTH_SEND_RESET_PASSWORD_EMAIL,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:n})});L.status===204?h(n):L.status>400&&h("error")}catch{h("error")}},g=async()=>{r(!0);const L=new URLSearchParams({token:d}),m=`${re}${I.AUTH_RESET_PASSWORD}?${L.toString()}`;try{const j=await fetch(m,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({password:i})});if(j.status!==204){v(await j.text());return}const{error:H,username:J}=(await o(Me({email:n,password:i}))).payload;H?v(H):o(V({title:s("Welcome ")+J,message:s("Your password has been reset successfully."),type:"success",duration:5e3}))}catch(j){v(j.message)}finally{r(!1)}};return e.jsxs(A,{children:[e.jsx(_,{children:e.jsx(y,{order:3,size:"h5",children:s("Forgot password")})}),e.jsxs(B,{direction:"column",gap:"xs",children:[c==="error"&&e.jsx(K,{color:"red",icon:e.jsx($e,{}),title:s("Check your email again!")}),c&&c!=="error"&&e.jsx(K,{color:"blue",icon:e.jsx(ve,{}),title:s("Email with reset link is sent to")+" "+c}),e.jsx(tt,{value:n,onChange:a,onVerify:M,otpSent:c}),e.jsx(Z,{label:s("Reset password token"),value:d,onChange:({currentTarget:{value:L}})=>u(L)}),e.jsx(Re,{value:i,onChange:l}),e.jsx(w,{onClick:g,loading:p,disabled:!k||p,children:s("Reset password")}),e.jsx(w,{variant:"default",onClick:()=>t.setLoginState("login"),disabled:p,children:s("Back to log in")})]})]})},Ps=/^\S+@\S+\.\S+$/,Pe=t=>!!t.match(Ps),Ns=t=>{const{t:s}=f(),o=O(),[n,a]=x.useState(""),[i,l]=x.useState(""),[d,u]=x.useState(!1),c=!!n&&Pe(n)&&!!i,h=async()=>{u(!0);try{const{error:p,username:r}=(await o(Me({email:n,password:i}))).payload;o(p?V({title:s("Unable to login"),message:p,type:"error",duration:9e3}):V({title:s("Welcome ")+r,message:s("Login success"),type:"success",duration:5e3}))}finally{u(!1)}};return e.jsxs(A,{children:[e.jsx(_,{children:e.jsx(y,{order:3,size:"h5",children:s("Log in")})}),e.jsxs(B,{direction:"column",gap:"xs",children:[e.jsx(Z,{type:"email",label:s("Email"),value:n,onChange:({currentTarget:{value:p}})=>a(p),error:n&&!Pe(n)}),e.jsx(Be,{label:s("Password"),value:i,onChange:({currentTarget:{value:p}})=>l(p)}),e.jsx(ye,{component:"button",ml:"auto",onClick:()=>t.setLoginState("forgot-password"),children:s("Forgot password")+"?"}),e.jsx(w,{onClick:h,loading:d,disabled:!c||d,children:s("Log in")}),e.jsx(w,{variant:"default",onClick:()=>t.setLoginState("register"),disabled:d,children:s("Create an account")})]})]})},Ds=t=>{const{t:s}=f(),o=O(),[n,a]=x.useState(""),[i,l]=x.useState(""),[d,u]=x.useState(""),[c,h]=x.useState(""),[p,r]=x.useState(""),[C,k]=x.useState(!1),v=!!i&&ce(i),M=!!n&&v&&!!c&&!!d&&et(d),g=j=>o(V({title:s("Unable to create your account"),message:j,type:"error",duration:9e3})),L=async()=>{try{const j=await fetch(re+I.AUTH_SEND_VERIFICATION_EMAIL,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:i})});j.status===204?r(i):j.status>400&&r("error")}catch{r("error")}},m=async()=>{k(!0);try{const j=await fetch(re+I.AUTH_REGISTER,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({name:n,email:i,password:d,emailVerificationToken:Number(c)})});if(j.status!==201){g(await j.text());return}const{error:H,username:J}=(await o(Me({email:i,password:d}))).payload;H?g(H):o(V({title:s("Welcome ")+J,message:s("Your account is created successfully."),type:"success",duration:5e3}))}catch(j){g(j.message)}finally{k(!1)}};return e.jsxs(A,{children:[e.jsx(_,{children:e.jsx(y,{order:3,size:"h5",children:s("Create an account")})}),e.jsxs(B,{direction:"column",gap:"xs",children:[p==="error"&&e.jsx(K,{color:"red",icon:e.jsx($e,{}),title:s("The email is not valid!")}),p&&p!=="error"&&e.jsx(K,{color:"blue",icon:e.jsx(ve,{}),title:s("Verification email is sent to")+" "+p}),e.jsx(Z,{label:s("Name"),description:s("You may always change it later."),value:n,onChange:({currentTarget:{value:j}})=>a(j)}),e.jsx(tt,{description:s("We'll never share your email."),value:i,onChange:l,onVerify:L,otpSent:p,allowResendOtp:!0}),e.jsx(Z,{label:s("Verification code"),value:c,onChange:({currentTarget:{value:j}})=>h(j)}),e.jsx(Re,{value:d,onChange:u}),e.jsx(w,{onClick:m,loading:C,disabled:!M||C,children:s("Sign up")}),e.jsx(w,{variant:"default",onClick:()=>t.setLoginState("login"),disabled:C,children:s("Back to log in")})]})]})},zs=1,Us=10,Vs=()=>{const{t}=f(),s=O(),{isLoggedIn:o,token:n,activeSubscriptions:a,currentSaveId:i,saves:l}=R(m=>m.account),{lastChangedAtTimeStamp:d}=R(m=>m.rmpSave),u=o&&l&&(a.RMP_CLOUD?l.length<Us:l.length<zs),c=Math.min(...(l??[]).map(m=>m.id)),h=m=>!a.RMP_CLOUD&&m!==c,[p,r]=W.useState(void 0),[C,k]=W.useState(void 0),v=m=>s(V({title:t("Unable to sync your save"),message:m,type:"error",duration:9e3})),M=async()=>{const m=await we(X.RMP);if(!o||!m||!n){v(t("Failed to get the RMP save!"));return}const{data:j,hash:H}=m,J=crypto.randomUUID();try{const Y=await Q(I.SAVES,{method:"POST",body:JSON.stringify({index:J,data:j,hash:H})},n);if(!Y){v(t("Login status expired")),s(D());return}if(Y.status!==200){v(await Y.text());return}s(oe())}catch(Y){v(Y.message)}},g=async m=>{if(!(!o||!n)){if(m===i){if(r(i),!i||h(i)){v(t("Can not sync this save!")),r(void 0);return}const j=await s(oe());if(j.meta.requestStatus!=="fulfilled"){v(t("Login status expired")),r(void 0);return}const J=j.payload.saves.filter(lt=>lt.id===i).at(0);if(!J){v(t("Current save id is not in saveList!")),r(void 0);return}const Y=new Date(J.lastUpdateAt);if(new Date(d)<Y){ie.warn(`Save id: ${i} is newer in the cloud via local compare.`),s(qe()),r(void 0);return}const _e=await we(X.RMP);if(!_e){v(t("Failed to get the RMP save!")),r(void 0);return}const{data:it,hash:rt}=_e,de=await Q(I.SAVES+"/"+i,{method:"PATCH",body:JSON.stringify({data:it,hash:rt})},n);if(!de){v(t("Login status expired")),r(void 0),s(D());return}if(de.status!==200){v(await de.text()),r(void 0);return}r(void 0)}else{r(m);const j=await Q(I.SAVES+"/"+m,{},n);if(!j){v(t("Login status expired")),r(void 0),s(D());return}if(j.status!==200){v(await j.text()),r(void 0);return}ie.info(`Set ${X.RMP} with save id: ${m}`),Ke(X.RMP,await j.text()),s(Xe(new Date().valueOf())),Ye(),r(void 0)}s(oe())}},L=async m=>{if(!o||!m||!n)return;k(m);const j=await Q(I.SAVES+"/"+i,{method:"DELETE"},n);if(!j){v(t("Login status expired")),k(void 0),s(D());return}if(j.status!==200){v(await j.text()),k(void 0);return}s(oe()),k(void 0)};return e.jsxs(A,{children:[e.jsxs(_,{align:"center",children:[e.jsx(y,{order:3,size:"h5",children:t("Synced saves")}),e.jsxs(S,{ml:"auto",size:"sm",children:[t("Maximum save count:")," ",a.RMP_CLOUD?10:1]}),e.jsx(w,{variant:"subtle",size:"xs",ml:"xs",disabled:!u,onClick:M,children:t("Create")})]}),e.jsx(B,{direction:"column",gap:"xs",children:l==null?void 0:l.map(m=>e.jsxs(N,{withBorder:!0,shadow:"sm",style:{flexDirection:"row"},children:[e.jsxs(T,{gap:"xs",flex:1,children:[e.jsx(S,{fw:500,children:m.id===i?t("Current save"):t("Cloud save")}),e.jsxs(S,{children:[t("Last update at:")," ",new Date(m.lastUpdateAt).toLocaleString()]})]}),e.jsxs(T,{gap:"xs",ml:"xs",children:[e.jsx(w,{variant:"filled",color:"red",loading:C===m.id,onClick:()=>L(m.id),children:t("Delete this save")}),e.jsx(w,{variant:"filled",disabled:h(m.id),loading:p===m.id,onClick:()=>g(m.id),children:m.id===i?t("Sync now"):t("Sync this slot")})]})]},m.id))})]})},Bs=t=>{const{t:s}=f(),{opened:o,onClose:n,getSubscriptions:a}=t,{isLoggedIn:i,token:l}=R(r=>r.account),d=O(),[u,c]=W.useState(""),h=r=>d(V({title:s("Unable to redeem"),message:r,type:"error",duration:9e3})),p=async r=>{if(!i)return;const C=await Q(I.SUBSCRIPTION_REDEEM,{method:"POST",body:JSON.stringify({cdkey:r.trim()})},l);if(!C){h(s("Login status expired")),d(D());return}if(C.status!==202){const k=(await C.json()).message;h(s(k));return}await a(),n()};return e.jsxs(U,{opened:o,onClose:n,title:s("Redeem your subscription"),children:[e.jsx(S,{children:s("CDKey could be purchased in the following sites:")}),e.jsx(F,{withPadding:!0,mt:"xs",children:e.jsx(F.Item,{children:e.jsxs(ye,{href:"https://afdian.com/item/9c8b220c614311efab2d52540025c377",target:"_blank",children:["爱发电 ",e.jsx(se,{})]})})}),e.jsxs(E,{align:"flex-end",gap:"sm",mt:"xs",children:[e.jsx(Z,{label:"CDKey",placeholder:s("Enter your CDKey here"),value:u,onChange:({currentTarget:{value:r}})=>c(r),style:{minWidth:240}}),e.jsx(w,{onClick:()=>p(u),children:s("Redeem")})]})]})},Fs=()=>{const{t}=f(),{isLoggedIn:s,token:o}=R(h=>h.account),n=O(),[a,i]=W.useState([]),[l,d]=W.useState(!1),u=h=>n(V({title:t("Unable to retrieve your subscriptions"),message:h,type:"error",duration:9e3})),c=async()=>{if(!s)return;const h=await Q(I.SUBSCRIPTION,{},o);if(!h){u(t("Login status expired")),n(D());return}if(h.status!==200){u(await h.text());return}const p=(await h.json()).subscriptions;if(!p.map(C=>C.type).includes("RMP_CLOUD"))return;i([{type:"RMP",expires:p[0].expires}]);const r=structuredClone(qt);for(const C of p){const k=C.type;k in r&&(r[k]=!0)}n(Kt(r))};return W.useEffect(()=>{c()},[]),e.jsxs(A,{children:[e.jsxs(_,{align:"center",children:[e.jsx(y,{order:3,size:"h5",children:t("All subscriptions")}),e.jsx(w,{variant:"subtle",size:"xs",ml:"auto",onClick:()=>d(!0),children:t("Redeem")})]}),e.jsxs(B,{direction:"column",gap:"xs",children:[a.length===0&&e.jsxs(N,{withBorder:!0,shadow:"sm",children:[e.jsx(N.Section,{p:"xs",children:e.jsx(y,{order:4,size:"h3",children:t("Rail Map Painter")})}),e.jsxs(T,{gap:"xs",children:[e.jsx(S,{children:t("With this subscription, the following features are unlocked:")}),e.jsxs(F,{withPadding:!0,children:[e.jsx(F.Item,{children:t("PRO features")}),e.jsx(F.Item,{children:t("Sync 9 more saves")}),e.jsx(F.Item,{children:t("Unlimited master nodes")}),e.jsx(F.Item,{children:t("Unlimited parallel lines")})]}),e.jsxs(S,{children:[t("Expires at:")," ",t("Not applicable")]})]})]}),a.map(h=>e.jsxs(N,{withBorder:!0,shadow:"sm",children:[e.jsx(N.Section,{p:"xs",children:e.jsx(y,{order:4,size:"h3",children:t(h.type==="RMP"?"Rail Map Painter":h.type)})}),e.jsxs(T,{gap:"xs",children:[e.jsxs(S,{children:[t("Expires at:")," ",new Date(h.expires).toLocaleString()]}),e.jsx(w,{color:"blue",onClick:()=>d(!0),children:t("Renew")})]})]},h.type))]}),e.jsx(Bs,{opened:l,onClose:()=>d(!1),getSubscriptions:c})]})},$s=()=>{const{t}=f(),{isLoggedIn:s}=R(a=>a.account),[o,n]=x.useState("login");return e.jsxs(A,{children:[e.jsx(_,{children:e.jsx(y,{order:2,size:"h4",children:t("Account")})}),s?e.jsxs(B,{className:_s.body,children:[e.jsx(Os,{}),e.jsx(je,{}),e.jsx(Fs,{}),e.jsx(Vs,{})]}):o==="login"?e.jsx(Ns,{setLoginState:n}):o==="register"?e.jsx(Ds,{setLoginState:n}):e.jsx(Is,{setLoginState:n})]})},Ws="_button_1hzui_1",Gs="_label_1hzui_11",ee={button:Ws,label:Gs,"sub-label":"_sub-label_1hzui_17"};function Hs(t){var M;const{appId:s,onAboutOpen:o}=t,{t:n}=f(),a=O(),i=mt("(min-width: 36em)"),{activeTab:l,openedTabs:d}=R(g=>g.app),u=G[s],c=u.name.split(" - ").map(g=>n(g)).join(" - "),h=d.some(g=>g.app===s),p=!u.allowMultiInstances&&((M=d.find(g=>g.id===l))==null?void 0:M.app)===s,r=g=>{h||b.event(P.OPEN_APP,{appId:s,isOpenInNew:g}),a(g?Yt(s):be({appId:s})),i||(a(Se()),b.toggleNavMenu(!1))},C=g=>{a(Xt(g)),i||(a(Se()),b.toggleNavMenu(!1))},k=g=>{a(Qt(g)),b.event(P.CLOSE_APP,{app:s})},v=g=>{a(Zt(g)),b.event(P.CLOSE_APP,{app:g})};return e.jsx(fe,{component:"div",role:"button",variant:"filled",label:c,active:p,classNames:{root:ee.button,label:ee.label},leftSection:h?e.jsx(wt,{title:n("Running")}):void 0,rightSection:e.jsxs(e.Fragment,{children:[u.allowMultiInstances&&e.jsx($,{"aria-label":n("New tab"),title:n("New tab"),variant:"subtle",color:p?"white":"gray",mr:4,onClick:g=>{g.stopPropagation(),r(!0)},children:e.jsx(jt,{})}),e.jsxs(ne,{children:[e.jsx(ne.Target,{children:e.jsx($,{variant:"subtle",color:p?"white":"gray",onClick:g=>g.stopPropagation(),children:e.jsx(ft,{})})}),e.jsxs(ne.Dropdown,{children:[h&&e.jsx(ne.Item,{leftSection:e.jsx(me,{}),onClick:g=>{g.stopPropagation(),v(s)},children:u.allowMultiInstances?n("Close all tabs"):n("Close app")}),e.jsx(ne.Item,{leftSection:e.jsx(bt,{}),onClick:g=>{g.stopPropagation(),o()},children:n("About")})]})]})]}),disableRightSectionRotation:!0,opened:!0,onClick:()=>r(!1),children:u.allowMultiInstances&&d.filter(g=>g.app===s).map((g,L)=>{const m=g.id===l;return e.jsx(fe,{component:"div",role:"button",variant:"filled",active:m,label:e.jsxs(e.Fragment,{children:[e.jsx(We,{color:"lightgray",c:"black",mr:"xs",circle:!0,display:"inline-flex",children:L+1}),g.title??n("Tab")+" "+(L+1).toString()+" - "+c]}),classNames:{root:ee.button,label:ee["sub-label"]},rightSection:e.jsx($,{variant:"subtle",color:m?"white":"gray","aria-label":n("Close tab"),title:n("Close tab"),onClick:j=>{j.stopPropagation(),k(g.id)},children:e.jsx(me,{})}),onClick:()=>C(g.id)},g.id)})})}const Js=async t=>{const s=`/${t}/info.json`;try{return(await(await fetch(s)).json()).version}catch(o){return ie.info(`Failed to get version of ${t}`,o),"unknown"}},qs=async(t,s)=>{const o=`/${t}/legacy-contributor-list.txt`;return(await(await fetch(o,{signal:s})).text()).split(`
`)};function Ks(t){var d,u,c;const{appId:s,onClose:o}=t,{t:n}=f(),[a,i]=x.useState("Unknown"),l=s?(c=(u=(d=G[s])==null?void 0:d.url)==null?void 0:u.split("/"))==null?void 0:c[1]:void 0;return x.useEffect(()=>{l?Js(l).then(h=>i(h)):i("Unknown")},[l]),e.jsx(U,{opened:!!s,onClose:o,size:"xl",title:e.jsxs(e.Fragment,{children:[n("About")+" "+(s?G[s].name.split(" - ").map(h=>n(h)).join(" - "):""),e.jsx(We,{color:"gray",radius:"sm",ml:"xs",children:a})]}),children:e.jsx(w,{component:"a",href:"https://github.com/railmapgen/"+l,target:"_blank",children:n("Visit GitHub")})})}function Ne({assetType:t}){const{t:s}=f(),[o,n]=x.useState(),a=Qe(t,b.getEnv(),b.getInstance());return e.jsxs(A,{children:[e.jsx(_,{children:e.jsx(y,{order:2,size:"h4",children:s(t==="devtool"?"Devtools":"Apps")})}),e.jsx(z,{direction:"column",children:a.map(i=>e.jsx(Hs,{appId:i,onAboutOpen:()=>n(i)},i))}),e.jsx(Ks,{appId:o,onClose:()=>n(void 0)})]})}function Ys(){const{t}=f(),s=Qe("link",b.getEnv(),b.getInstance()),o=n=>{b.event(P.OPEN_LINK,{id:n})};return e.jsxs(A,{children:[e.jsx(_,{children:e.jsx(y,{order:2,size:"h4",children:t("Useful links")})}),e.jsx(z,{direction:"column",children:s.map(n=>e.jsx(fe,{variant:"filled",label:t(G[n].name),classNames:{root:ee.button,label:ee.label},rightSection:e.jsx(se,{}),href:G[n].url,target:"_blank",onClick:()=>o(n)},n))})]})}const De={"textarea-label":"_textarea-label_kau51_1","textarea-input":"_textarea-input_kau51_5"};function Xs(t){var u;const{opened:s,onClose:o}=t,{t:n}=f(),[a,i]=x.useState(),l=Object.entries(localStorage),d=()=>{a&&(window.localStorage.removeItem(a),window.location.reload())};return e.jsxs(U,{opened:s,onClose:o,size:"xl",title:n("Local Storage"),children:[e.jsx(T,{gap:"xs",children:l.map(c=>e.jsx(St,{label:e.jsxs(E,{align:"center",gap:"xs",children:[c[0],e.jsx($,{variant:"default",size:"xs",title:n("Remove this item"),"aria-label":n("Remove this item"),onClick:()=>i(c[0]),children:e.jsx(Ct,{})})]}),value:c[1],readOnly:!0,rows:4,classNames:{label:De["textarea-label"],input:De["textarea-input"]}},c[0]))}),e.jsx(E,{pt:"xs",children:e.jsx(w,{ml:"auto",onClick:o,children:n("Go back")})}),a&&e.jsxs(U,{opened:!0,onClose:()=>i(void 0),centered:!0,title:n("Warning"),children:[e.jsxs(S,{children:[n("LocalStorageModal.text1"),e.jsx(vt,{children:a}),n("LocalStorageModal.text2"),e.jsx(S,{span:!0,fw:500,children:n(((u=G[a.split("__")[0]])==null?void 0:u.name)??"Unknown app")}),n("LocalStorageModal.text3"),e.jsx("br",{}),n("LocalStorageModal.text4")]}),e.jsxs(E,{gap:"xs",mt:"xs",children:[e.jsx(w,{variant:"default",ml:"auto",onClick:()=>i(void 0),children:n("Back")}),e.jsx(w,{color:"red",onClick:d,children:n("Delete and reload")})]})]})]})}function st(t){const{t:s}=f(),o=[{group:s("Main languages"),items:es.map(n=>({value:n,label:he[n][n]}))},{group:s("Other languages"),items:ts.map(n=>({value:n,label:he[n][n]??he[n].en}))}];return e.jsx(yt,{label:s("Language"),defaultValue:b.getLanguage(),onChange:({currentTarget:{value:n}})=>{const a=n;b.setLanguage(a),b.getI18nInstance().changeLanguage(a),b.event(P.CHANGE_LANGUAGE,{language:a})},data:o,...t})}function Qs(){const{t}=f(),{setColorScheme:s}=kt(),o=O(),{lastShowDevtools:n,refreshRequired:a}=R(r=>r.app),[i,l]=x.useState(b.isAllowAnalytics()),[d,u]=x.useState(!1),c=Ze(n),h=r=>{l(r),b.allowAnalytics(r).refreshRequired&&o(os())},p=[{value:"light",label:t("Light")},{value:"dark",label:t("Dark")},{value:"system",label:t("System")}];return e.jsxs(A,{children:[a&&e.jsx(K,{color:"blue",icon:e.jsx(ve,{}),mb:"xs",children:t("Refreshing is required for changes to take effect.")}),e.jsx(_,{children:e.jsx(y,{order:2,size:"h4",children:t("Settings")})}),e.jsxs(T,{gap:"xs",py:"xs",children:[e.jsx(st,{}),e.jsx(Mt,{size:"sm",label:t("Appearance"),defaultValue:b.getColourMode(),onChange:r=>{s(r==="system"?"auto":r),b.setColourMode(r)},data:p}),e.jsx(Le,{label:t("Allow cookies to help improve our website"),labelPosition:"left",checked:i,onChange:({currentTarget:{checked:r}})=>h(r),disabled:a,styles:{labelWrapper:{flex:1}}}),e.jsx(Le,{label:t("Show dev tools for 1 day"),labelPosition:"left",checked:c,onChange:({currentTarget:{checked:r}})=>{r?(o(ss()),b.event(P.SHOW_DEVTOOLS)):o(ns())},styles:{labelWrapper:{flex:1}}}),c&&e.jsx(w,{variant:"default",leftSection:e.jsx(Rt,{}),onClick:()=>u(!0),children:t("Export Local Storage")})]}),c&&e.jsx(Xs,{opened:d,onClose:()=>u(!1)})]})}function Zs(){const{t}=f(),{remoteFonts:s}=R(o=>o.app);return e.jsxs(A,{children:[e.jsx(_,{children:e.jsx(y,{order:2,size:"h4",children:t("Web fonts")})}),e.jsxs(T,{gap:"xs",children:[e.jsxs(S,{fs:"italic",children:[t("FontsSection.text1")," ",t("FontsSection.text2")," ",t("FontsSection.text3")," (",t("FontsSection.safari"),")"]}),Object.entries(s).map(([o,n])=>e.jsx(w,{variant:"default",rightSection:n.url?e.jsx(se,{}):void 0,disabled:!n.url,onClick:()=>{window.open(n.url,"_blank"),b.event(P.DOWNLOAD_FONT,{family:o})},children:n.displayName?`${n.displayName} (${o})`:o},o))]})]})}const en="_bilibili_5ep1h_1",tn={bilibili:en};function sn(t){return Ge({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 32C132.3 32 32 134.9 32 261.7c0 101.5 64.2 187.5 153.2 217.9a17.56 17.56 0 0 0 3.8.4c8.3 0 11.5-6.1 11.5-11.4 0-5.5-.2-19.9-.3-39.1a102.4 102.4 0 0 1-22.6 2.7c-43.1 0-52.9-33.5-52.9-33.5-10.2-26.5-24.9-33.6-24.9-33.6-19.5-13.7-.1-14.1 1.4-14.1h.1c22.5 2 34.3 23.8 34.3 23.8 11.2 19.6 26.2 25.1 39.6 25.1a63 63 0 0 0 25.6-6c2-14.8 7.8-24.9 14.2-30.7-49.7-5.8-102-25.5-102-113.5 0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8a18.64 18.64 0 0 1 5-.5c8.1 0 26.4 3.1 56.6 24.1a208.21 208.21 0 0 1 112.2 0c30.2-21 48.5-24.1 56.6-24.1a18.64 18.64 0 0 1 5 .5c12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6 0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5 0 30.7-.3 55.5-.3 63 0 5.4 3.1 11.5 11.4 11.5a19.35 19.35 0 0 0 4-.4C415.9 449.2 480 363.1 480 261.7 480 134.9 379.7 32 256 32z"},child:[]}]})(t)}function nn(t){return Ge({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M126.12 315.1A47.06 47.06 0 1 1 79.06 268h47.06zm23.72 0a47.06 47.06 0 0 1 94.12 0v117.84a47.06 47.06 0 1 1-94.12 0zm47.06-188.98A47.06 47.06 0 1 1 244 79.06v47.06zm0 23.72a47.06 47.06 0 0 1 0 94.12H79.06a47.06 47.06 0 0 1 0-94.12zm188.98 47.06a47.06 47.06 0 1 1 47.06 47.1h-47.06zm-23.72 0a47.06 47.06 0 0 1-94.12 0V79.06a47.06 47.06 0 1 1 94.12 0zM315.1 385.88a47.06 47.06 0 1 1-47.1 47.06v-47.06zm0-23.72a47.06 47.06 0 0 1 0-94.12h117.84a47.06 47.06 0 1 1 0 94.12z"},child:[]}]})(t)}function on(){const{t}=f();return e.jsxs(A,{children:[e.jsx(_,{children:e.jsx(y,{order:2,size:"h4",children:t("Help & support")})}),e.jsxs(T,{gap:"xs",children:[e.jsx(w,{variant:"default",leftSection:e.jsx(sn,{}),rightSection:e.jsx(se,{}),onClick:()=>{window.open("https://github.com/railmapgen/railmapgen.github.io/issues","_blank"),b.event(P.RAISE_ISSUE)},children:t("Raise an Issue on GitHub")}),e.jsx(w,{variant:"default",leftSection:e.jsx(nn,{}),rightSection:e.jsx(se,{}),onClick:()=>{window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),b.event(P.JOIN_SLACK)},children:t("Join us on Slack")}),e.jsx(w,{variant:"default",leftSection:e.jsx(ge,{className:tn.bilibili,src:"images/bilibili.svg"}),rightSection:e.jsx(se,{}),onClick:()=>{window.open("https://space.bilibili.com/10124055","_blank"),b.event(P.FOLLOW_BILIBILI)},children:t("Follow us on Bilibili")})]})]})}const an="_body_j0z9a_1",ae={body:an,"dev-section-body":"_dev-section-body_j0z9a_7","dev-card":"_dev-card_j0z9a_13"};function rn(){const{t}=f();return e.jsxs(A,{children:[e.jsx(_,{children:e.jsx(y,{order:2,size:"h4",children:t("Developer team")})}),e.jsxs(B,{className:ae["dev-section-body"],children:[e.jsxs(N,{component:"a",className:ae["dev-card"],href:"https://github.com/wongchito",target:"_blank",withBorder:!0,children:[e.jsx(te,{src:"https://github.com/wongchito.png",size:"lg"}),e.jsxs(z,{children:[e.jsx(y,{order:3,children:"Chito Wong"}),e.jsx(S,{span:!0,children:"Author of Rail Map Toolkit platform"}),e.jsx(S,{span:!0,children:"Author of Rail Map Generator"})]})]}),e.jsxs(N,{component:"a",className:ae["dev-card"],href:"https://github.com/thekingofcity",target:"_blank",withBorder:!0,children:[e.jsx(te,{src:"https://github.com/thekingofcity.png",size:"lg"}),e.jsxs(z,{children:[e.jsx(y,{order:3,children:"thekingofcity"}),e.jsx(S,{span:!0,children:"Author of Rail Map Painter"}),e.jsx(S,{span:!0,children:"Author of RMG (Shanghai Metro style)"})]})]}),e.jsxs(N,{component:"a",className:ae["dev-card"],href:"https://github.com/langonginc",target:"_blank",withBorder:!0,children:[e.jsx(te,{src:"https://github.com/langonginc.png",size:"lg"}),e.jsxs(z,{children:[e.jsx(y,{order:3,children:"langonginc"}),e.jsx(S,{span:!0,children:"Author of Rail Map Painter"})]})]})]})]})}function Ae(t){const{login:s,urlRepo:o,...n}=t,a=o?`https://github.com/railmapgen/${o}/issues?q=is:issue+author:${s}`:`https://github.com/${s}`;return e.jsx(te,{component:"a",name:s,title:s,src:`https://github.com/${s}.png`,alt:s,href:a,target:"_blank",color:"initials",...n})}const ln=["Swiftiecott","linchen1965","28yfang","Windows-Taskmgr"];function cn(){const{t}=f();return e.jsxs(A,{children:[e.jsx(_,{children:e.jsx(y,{order:2,size:"h4",children:t("Resource administrators")})}),e.jsx(E,{gap:"xs",children:ln.map(s=>e.jsx(Ae,{login:s,size:"lg"},s))})]})}const nt="https://api.github.com/repos/railmapgen",pe={},ot=async(t,s)=>{if(t in pe)return pe[t];const n=await(await fetch(t,s)).json();return pe[t]=n,n},dn=async(t,s,o)=>{const n=`${nt}/${t}/contributors`,a=new URLSearchParams({per_page:"100",page:s.toString()});return(await ot(n+"?"+a.toString(),{signal:o})).map(l=>l.login)},un=async(t,s,o)=>{const n=`${nt}/${t}/issues`,a=new URLSearchParams({state:"closed",labels:"donation",per_page:"100",page:s.toString()});return(await ot(n+"?"+a.toString(),{signal:o})).filter(l=>l.state_reason==="completed").map(l=>{var d;return(d=l.user)==null?void 0:d.login})};function at(t){const[s,o]=x.useState([]);return[s,a=>{o(i=>{const l=new Set(i?i.concat(a):a);return Array.from(l)})}]}const hn=["","wongchito","thekingofcity","github-actions[bot]"],ze=t=>!hn.includes(t);function pn(t){const[s,o]=at(),[n,a]=x.useState(!0),[i,l]=x.useState(!1),d=x.useRef(null),u=async()=>{var h;let c=0;for(;++c;){d.current=new AbortController;const p=await dn(t,c,(h=d.current)==null?void 0:h.signal);if(o(p.filter(ze)),p.length<100)break}};return x.useEffect(()=>(u().then(()=>{var c;return G[t].legacyContributors?(d.current=new AbortController,qs(t,(c=d.current)==null?void 0:c.signal)):[]}).then(c=>o(c.filter(ze))).catch(c=>{ie.error("unable to fetch contributors for:",t,c),l(!0)}).finally(()=>a(!1)),()=>{var c;(c=d.current)==null||c.abort(),a(!0),l(!1)}),[t]),{contributors:s,isLoading:n,isError:i}}function xn(t){const{appId:s}=t,{t:o}=f(),{contributors:n,isLoading:a,isError:i}=pn(s);return e.jsxs(B,{children:[e.jsx(He,{visible:a}),i&&e.jsx(K,{color:"yellow",icon:e.jsx(ke,{}),title:o("Unable to load contributors"),flex:1}),!i&&n&&e.jsx(E,{gap:"xs",children:n==null?void 0:n.map(l=>e.jsx(Ae,{login:l,urlRepo:s},l))})]})}function gn(){const{t}=f();return e.jsxs(A,{children:[e.jsx(_,{children:e.jsx(y,{order:2,size:"h4",children:t("Resource contributors")})}),e.jsxs(B,{direction:"column",gap:"xs",children:[Object.entries(G).filter(([,s])=>s.showContributors).map(([s,o])=>e.jsxs(A,{children:[e.jsx(_,{children:e.jsx(y,{order:3,size:"h5",children:t(o.name)})}),e.jsx(xn,{appId:s},s)]},s)),e.jsx(S,{fs:"italic",children:t("Notes: Contributors are sorted by number of commits and commit time.")})]})]})}function mn(){const[t,s]=at(),[o,n]=x.useState(!0),[a,i]=x.useState(!1),l=x.useRef(null),d=async()=>{var c;const u=Object.entries(G).filter(([,h])=>h.showDonators).map(([h])=>h);for(const h of u)try{let p=0;for(;++p;){l.current=new AbortController;const r=await un(h,p,(c=l.current)==null?void 0:c.signal);if(s(r),r.length<100)break}}catch(p){throw ie.error("unable to fetch donators for:",h,p),p}};return x.useEffect(()=>(d().catch(()=>i(!0)).finally(()=>n(!1)),()=>{var u;(u=l.current)==null||u.abort(),n(!0),i(!1)}),[]),{donators:t,isLoading:o,isError:a}}function jn(){const{t}=f(),{donators:s,isLoading:o,isError:n}=mn();return e.jsxs(A,{children:[e.jsx(_,{children:e.jsx(y,{order:2,size:"h4",children:"❤️ "+t("Donators")})}),e.jsxs(B,{children:[e.jsx(He,{visible:o}),n&&e.jsx(K,{color:"yellow",icon:e.jsx(ke,{}),title:t("Unable to load donators"),flex:1}),!n&&s&&e.jsx(E,{gap:"xs",children:s==null?void 0:s.map(a=>e.jsx(Ae,{login:a},a))})]})]})}function fn(t){const{opened:s,onClose:o}=t,{t:n}=f();return e.jsxs(U,{opened:s,onClose:o,size:"xl",title:n("Contributors"),classNames:{body:ae.body},children:[e.jsx(rn,{}),e.jsx(jn,{}),e.jsx(cn,{}),e.jsx(gn,{}),e.jsx(E,{children:e.jsx(w,{component:"a",href:"https://github.com/railmapgen/rmg/wiki/How-to-add-color-palette-and-line-templates",target:"_blank",children:n("Contribution Wiki")})})]})}function bn(){const{t}=f(),{isShowMenu:s,menuView:o,lastShowDevtools:n}=R(r=>r.app),{isLoggedIn:a,name:i}=R(r=>r.account),l=O(),[d,u]=x.useState(!1),[c]=Je(),h=(b.getInstance()==="GitLab"?"https://railmapgen.gitlab.io/":"https://railmapgen.github.io/")+"?"+c.toString(),p=[{key:"apps",label:t("Apps"),Icon:e.jsx(At,{size:22})},{key:"links",label:t("Useful links"),Icon:e.jsx(_t,{size:22})},{key:"devtools",label:t("Devtools"),Icon:e.jsx(Lt,{size:22}),ActionIconProps:{style:{display:Ze(n)?"inline-flex":"none"}}},{key:"account",label:t("Account"),Icon:e.jsx(te,{variant:"light",name:a?i:void 0,size:"sm",color:"initials"}),ActionIconProps:{mt:"auto"}},{key:"contributors",label:t("Contributors"),Icon:e.jsx(Ot,{size:22}),ActionIconProps:{onClick:()=>u(!0)}},{key:"support",label:t("Help & support"),Icon:e.jsx(Et,{size:22})},{key:"settings",label:t("Settings"),Icon:e.jsx(Tt,{size:22})}];return e.jsxs("nav",{className:Ve(q.root,s&&q["show-menu"]),children:[e.jsxs("div",{className:q.wrapper,children:[e.jsxs(It,{className:q.header,children:[e.jsx(y,{children:t("Rail Map Toolkit")}),e.jsx(Pt,{env:b.getEnv(),ver:b.getAppVersion()})]}),e.jsx(je,{}),b.getEnv()!=="PRD"&&e.jsxs(K,{color:"yellow",icon:e.jsx(ke,{}),className:q.alert,children:[t("You're currently viewing a testing environment.")," ",e.jsx(ye,{size:"sm",href:h,target:"_blank",children:t("Back to production environment")})]}),e.jsxs("div",{className:q.body,children:[e.jsx("div",{className:q.aside,children:p.map(({key:r,label:C,Icon:k,ActionIconProps:v})=>e.jsx(Nt,{label:C,position:"right",withArrow:!0,children:e.jsx($,{variant:o===r?"light":"subtle",color:o===r?void 0:"gray",size:"lg",onClick:()=>l(as(r)),...v,children:k})},r))}),e.jsx(je,{orientation:"vertical"}),e.jsxs("div",{className:q.main,children:[o==="apps"?e.jsx(Ne,{assetType:"app"}):o==="links"?e.jsx(Ys,{}):o==="devtools"?e.jsx(Ne,{assetType:"devtool"}):o==="settings"?e.jsx(Qs,{}):o==="support"?e.jsxs(e.Fragment,{children:[e.jsx(on,{}),e.jsx(Zs,{})]}):o==="account"?e.jsx($s,{}):e.jsx(e.Fragment,{}),e.jsx(Rs,{})]})]})]}),e.jsx(fn,{opened:d,onClose:()=>u(!1)})]})}function wn(t){const{opened:s,onClose:o}=t,{t:n}=f(),a=()=>{b.allowAnalytics(!0),o()},i=()=>{b.allowAnalytics(!1).refreshRequired?window.location.reload():o()};return e.jsxs(U,{opened:s,onClose:()=>{},title:n("CookiesModal.header"),withCloseButton:!1,closeOnEscape:!1,closeOnClickOutside:!1,centered:!0,children:[e.jsx(E,{children:e.jsx(st,{ml:"auto"})}),e.jsxs(T,{gap:"xs",py:"xs",children:[e.jsx(S,{children:n("CookiesModal.text1")}),e.jsx(S,{mt:2,children:n("CookiesModal.text2")}),e.jsx(F,{withPadding:!0,children:e.jsxs(F.Item,{children:[" ",n("CookiesModal.item1")]})}),e.jsx(S,{mt:2,children:n("CookiesModal.text3")})]}),e.jsxs(E,{gap:"sm",children:[e.jsx(w,{variant:"default",ml:"auto",onClick:i,children:n("CookiesModal.reject")}),e.jsx(w,{onClick:a,children:n("CookiesModal.accept")})]})]})}const Sn=()=>{};function Cn(){const{t}=f(),[s,o]=x.useState(!1),n=()=>{o(!0),is(),setTimeout(()=>{window.location.reload()},1e3)};return e.jsxs(U,{opened:!0,onClose:Sn,title:t("Rail Map Toolkit is opened in another window"),withCloseButton:!1,closeOnEscape:!1,closeOnClickOutside:!1,centered:!0,children:[e.jsx(S,{children:t("You cannot open multiple Rail Map Toolkit at the same time. Please close this window.")}),e.jsx(E,{mt:"xs",children:e.jsx(w,{variant:"default",onClick:n,loading:s,disabled:s,children:t("Restart RMT in this window")})})]})}const vn=()=>{};function yn(){const{t}=f();return e.jsx(U,{opened:!0,onClose:vn,title:t("Rail Map Toolkit is opened in another window"),withCloseButton:!1,closeOnEscape:!1,closeOnClickOutside:!1,centered:!0,children:e.jsx(S,{children:t("Current session has been terminated. Please close this window.")})})}const kn="_root_nos1z_1",Mn={root:kn},Rn={info:void 0,success:"green",warning:"yellow",error:"red"},xe=200,Ue=400;function An({notification:t}){const s=O(),[o,n]=x.useState(!1);return x.useEffect(()=>{setTimeout(()=>{n(!0)},xe);const a=setTimeout(()=>{n(!1)},xe+t.duration);return setTimeout(()=>{s(rs(t.id))},xe+t.duration+Ue),()=>{clearTimeout(a)}},[]),e.jsx(Dt,{mounted:o,transition:"slide-left",duration:Ue,timingFunction:"ease",children:a=>e.jsx(zt,{color:Rn[t.type],title:t.title,onClose:()=>n(!1),withBorder:!0,style:a,children:t.message})})}function _n(){const{notifications:t}=R(s=>s.notification);return e.jsx(Ut,{children:e.jsx(T,{className:Mn.root,children:t.map(s=>e.jsx(An,{notification:s},s.id))})})}function Pn(){const{t}=f(),s=O(),{isPrimary:o,isTerminated:n,isShowMenu:a}=R(u=>u.app),[i,l]=x.useState(!1);x.useEffect(()=>{b.isAnalyticsQADone()||l(!0)},[]);const d=()=>{b.toggleNavMenu(!a),s(Se()),b.event(P.TOGGLE_NAV_MENU)};return e.jsx($t,{basename:"/",children:e.jsxs(Vt,{className:a?"show-menu":"",children:[e.jsx($,{className:cs.burger,variant:a?"subtle":"filled",color:a?"gray":void 0,"aria-label":t("Toggle menu"),title:t("Toggle menu"),onClick:d,children:e.jsx(Bt,{})}),e.jsxs(Ft,{direction:"row",children:[e.jsx(bn,{}),e.jsx(js,{alwaysShowWelcome:n||o===!1})]}),e.jsx(_n,{}),n&&e.jsx(yn,{}),o===!1&&e.jsx(Cn,{}),e.jsx(wn,{opened:i,onClose:()=>l(!1)})]})})}export{Pn as default};

import{j as e,ad as oe,a as Te,ae as Le,H as z,T as g,B as pe,af as y,ag as N,M as Z,ah as F,E as U,J as W,ai as T,aj as ce,ak as de,F as k,al as Re,am as je,b as m,K as q,an as ne,a2 as G,ao as ee,G as xe,Q as ae,R as re,V as Oe,I as tt,q as st,O as Pe,N as ft,ap as He,aq as te,p as vt,ar as Ue,D as Ae,a1 as wt,a9 as bt,as as We,at as St,au as Ct,av as yt,aw as $e,t as nt,d as Se,e as Ce,i as Ve,W as _e,P as Mt,k as kt,l as zt,v as Lt,w as Rt,x as At,y as Et,ax as It,ay as Dt,az as ye,r as Tt}from"./chakra-AL7qUQmT.js";import{o as v,a as x,p as it,d as V,B as Ot}from"./react-Cz8QwcEg.js";import{F as Pt,u as R,a as A,b as Ht,S as Y,l as B,s as ot,f as se,g as Ee,c as at,n as rt,d as lt,e as Vt,h as ge,A as he,i as P,j as Q,k as _t,m as Be,o as Bt,p as Nt,q as J,E as _,r as Ft,t as Ut,v as Ie,w as Wt,x as $t,y as Gt,z as ct,B as Me,C as Jt,L as qt,N as Kt,O as Xt,D as Yt,G as Ge,H as De,I as Qt,J as Zt,K as es,M as ts}from"./main-DK1VWlfq.js";import{i as Ne,e as E,f as I,l as ue,r as S,b as dt,u as ss,j as ns,g as ke,h as is}from"./index-_UJKhj6C.js";import{R as me}from"./rmg-fields-Bkn18_Pr.js";const os="/assets/rmp-logo512-eHekupnf.png",as={flex:1,justifyContent:"center",mb:10,"& > div":{mb:3},"& img":{w:120,p:2,backgroundColor:"white",borderRadius:12}};function rs(){const{t}=v();return e.jsxs(oe,{sx:as,children:[e.jsxs(Te,{spacing:3,children:[e.jsx(Le,{src:"/logo512.png"}),e.jsx(Le,{src:os,backgroundColor:"white"})]}),e.jsx(z,{children:t("Welcome to Rail Map Toolkit")}),e.jsx(g,{fontSize:"lg",textAlign:"center",children:t("Select an app to start your own rail map design!")})]})}function ls(t){const{tab:s,isActive:n}=t,i=x.useMemo(()=>{var o;return(o=s.url)!=null?o:"/"+s.app+"/"},[s.app]);return e.jsx(pe,{display:n?"block":"none",flex:1,children:e.jsx("iframe",{id:Pt+s.id,src:i,loading:"lazy",title:s.app,width:"100%",height:"100%","data-persisted-url":s.url,"data-testid":"app-container-iframe"})})}function cs(){const{openedTabs:t,activeTab:s}=R(i=>i.app),[,n]=it();return x.useEffect(()=>{var i;if(s){const o=(i=t.find(r=>r.id===s))==null?void 0:i.app;n(o?{app:o}:{})}else n({})},[s]),t.length===0?e.jsx(rs,{}):e.jsx(e.Fragment,{children:t.map(i=>e.jsx(ls,{tab:i,isActive:s===i.id},i.id))})}function ds(t){return y({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM8 9h8v10H8V9zm7.5-5-1-1h-5l-1 1H5v2h14V4z"},child:[]}]})(t)}function hs(t){return y({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"},child:[]}]})(t)}function us(t){return y({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M11 7h2v2h-2V7zm0 4h2v6h-2v-6zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"},child:[]}]})(t)}function ps(t){return y({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"m17 7-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"},child:[]}]})(t)}function ie(t){return y({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 19H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"},child:[]}]})(t)}function xs(t){return y({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 0 0 .12-.61l-1.92-3.32a.488.488 0 0 0-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 0 0-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58a.49.49 0 0 0-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"},child:[]}]})(t)}function ms(t){return y({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"},child:[]}]})(t)}function js(t){return y({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M12 2C6.49 2 2 6.49 2 12s4.49 10 10 10 10-4.49 10-10S17.51 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3-8c0 1.66-1.34 3-3 3s-3-1.34-3-3 1.34-3 3-3 3 1.34 3 3z"},child:[]}]})(t)}function gs(t){return y({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M2 17h20v2H2v-2zm1.15-4.05L4 11.47l.85 1.48 1.3-.75-.85-1.48H7v-1.5H5.3l.85-1.47L4.85 7 4 8.47 3.15 7l-1.3.75.85 1.47H1v1.5h1.7l-.85 1.48 1.3.75zm6.7-.75 1.3.75.85-1.48.85 1.48 1.3-.75-.85-1.48H15v-1.5h-1.7l.85-1.47-1.3-.75L12 8.47 11.15 7l-1.3.75.85 1.47H9v1.5h1.7l-.85 1.48zM23 9.22h-1.7l.85-1.47-1.3-.75L20 8.47 19.15 7l-1.3.75.85 1.47H17v1.5h1.7l-.85 1.48 1.3.75.85-1.48.85 1.48 1.3-.75-.85-1.48H23v-1.5z"},child:[]}]})(t)}function fs(t){return y({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.5 14H8c-1.66 0-3-1.34-3-3s1.34-3 3-3l.14.01A3.98 3.98 0 0 1 12 7c2.21 0 4 1.79 4 4h.5a2.5 2.5 0 0 1 0 5z"},child:[]}]})(t)}function vs(t){return y({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M18.41 5.8 17.2 4.59c-.78-.78-2.05-.78-2.83 0l-2.68 2.68L3 15.96V20h4.04l8.74-8.74 2.63-2.63c.79-.78.79-2.05 0-2.83zM6.21 18H5v-1.21l8.66-8.66 1.21 1.21L6.21 18zM11 20l4-4h6v4H11z"},child:[]}]})(t)}function ws(t){return y({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M20 18c1.1 0 1.99-.9 1.99-2L22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2H0v2h24v-2h-4zM4 6h16v10H4V6z"},child:[]}]})(t)}function bs(t){return y({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"},child:[]}]})(t)}function ht(t){return y({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"},child:[]}]})(t)}function Ss(t){return y({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"},child:[]}]})(t)}function Je(t){return y({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},child:[]}]})(t)}function Cs(t){return y({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"},child:[]}]})(t)}function ys(t){return y({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"},child:[]}]})(t)}function Ms(t){return y({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"},child:[]}]})(t)}const qe=(t,s,n)=>{const i=new Blob([n],{type:s});ks(t,i)},ks=(t,s)=>{const n=window.URL.createObjectURL(s),i=document.createElement("a");i.href=n,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(n)},zs=()=>{const{t}=v(),{token:s,refreshToken:n,currentSaveId:i}=R(f=>f.account),{resolveConflictModal:{isOpen:o,lastChangedAtTimeStamp:r,lastUpdatedAtTimeStamp:a,cloudData:c}}=R(f=>f.rmpSave),l=A(),[u,h]=V.useState(!1),p=()=>l(Vt()),w=()=>{at(Y.RMP,c),rt(),l(lt(a)),p()},d=()=>{qe("RMP_".concat(a,".json"),"application/json",c)},C=async()=>{if(!i||!s||!n)return;h(!0);const f=await Ht(i,s,n,Y.RMP);if(!f){l(B()),h(!1);return}if(f.status===409){l(ot()),h(!1);return}f.status===200&&(l(se()),h(!1),p())},M=async()=>{const{data:f}=await Ee(Y.RMP);qe("RMP_".concat(r,".json"),"application/json",f)};return e.jsxs(N,{isOpen:o,onClose:()=>{},size:"xl",scrollBehavior:"inside",closeOnOverlayClick:!1,closeOnEsc:!1,children:[e.jsx(Z,{}),e.jsxs(F,{children:[e.jsx(U,{children:t("Oops! It seems there's a conflict")}),e.jsxs(W,{children:[e.jsx(g,{children:t("The local save is newer than the cloud one. Which one would you like to keep?")}),e.jsxs(T,{direction:{base:"column",sm:"row"},mt:"5",children:[e.jsxs(ce,{overflow:"hidden",variant:"outline",mb:"3",children:[e.jsxs(de,{children:[e.jsxs(k,{align:"center",children:[e.jsx(Re,{as:ws,mr:"2"}),e.jsx(g,{py:"2",as:"b",children:t("Local save")})]}),e.jsxs(g,{py:"2",children:[t("Update at:")," ",new Date(r).toLocaleString()]})]}),e.jsx(je,{children:e.jsxs(T,{children:[e.jsx(m,{variant:"solid",colorScheme:"red",isLoading:u,onClick:()=>C(),children:t("Replace cloud with local")}),e.jsx(m,{variant:"solid",colorScheme:"primary",onClick:()=>M(),children:t("Download Local save")})]})})]}),e.jsxs(ce,{overflow:"hidden",variant:"outline",mb:"3",children:[e.jsxs(de,{children:[e.jsxs(k,{align:"center",children:[e.jsx(Re,{as:fs,mr:"2"}),e.jsx(g,{py:"2",as:"b",children:t("Cloud save")})]}),e.jsxs(g,{py:"2",children:[t("Update at:")," ",new Date(a).toLocaleString()]})]}),e.jsx(je,{children:e.jsxs(T,{children:[e.jsx(m,{variant:"solid",colorScheme:"red",onClick:()=>w(),children:t("Replace local with cloud")}),e.jsx(m,{variant:"solid",colorScheme:"primary",onClick:()=>d(),children:t("Download Cloud save")})]})})]})]})]}),e.jsx(q,{})]})]})},Ls=()=>{const{t}=v(),s=A(),{isLoggedIn:n,name:i}=R(o=>o.account);return V.useEffect(()=>{n&&s(se())},[n]),e.jsxs(m,{variant:"ghost",onClick:()=>s(ge("account")),rightIcon:e.jsx(bs,{}),"aria-label":"More account info",mx:2,px:3,py:8,children:[e.jsx(ne,{name:n?i:void 0}),e.jsx(g,{as:"b",ml:2,mr:"auto",children:n?i:t("Log in / Sign up")})]})},Rs={alignItems:"center",m:2,px:3,alignSelf:{base:"center",md:"auto"},maxW:{base:"100vw",md:"unset"},w:{base:400,md:"unset"}},As=()=>{const{t}=v(),s=A(),{isLoggedIn:n,email:i,name:o,refreshToken:r}=R(u=>u.account),[a,c]=V.useState(void 0),l=async()=>{n&&(await fetch(he+P.AUTH_LOGOUT,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({refreshToken:r})}),s(B()))};return e.jsxs(e.Fragment,{children:[e.jsxs(k,{sx:Rs,children:[e.jsx(ne,{size:"md",name:o}),e.jsxs(oe,{spacing:0,alignItems:"flex-start",ml:2,children:[e.jsx(g,{as:"b",children:o}),e.jsx(g,{fontSize:"sm",children:i})]}),e.jsxs(Te,{ml:"auto",spacing:1,children:[e.jsx(G,{variant:"ghost",size:"sm",onClick:()=>c("name"),"aria-label":t("Change name"),title:t("Change name"),icon:e.jsx(vs,{})}),e.jsx(G,{variant:"ghost",size:"sm",onClick:()=>c("password"),"aria-label":t("Change password"),title:t("Change password"),icon:e.jsx(gs,{})}),e.jsx(G,{variant:"ghost",size:"sm",onClick:l,"aria-label":t("Log out"),title:t("Log out"),icon:e.jsx(ps,{})})]})]}),e.jsx(Es,{infoType:a,onClose:()=>c(void 0)})]})};function Es(t){const{infoType:s,onClose:n}=t,{t:i}=v(),o=ee(),r=A(),{isLoggedIn:a,id:c,token:l}=R(d=>d.account),[u,h]=V.useState(""),p=d=>o({title:d,status:"error",duration:9e3,isClosable:!0}),w=async()=>{if(!a||!s)return;const d=await Q(P.USER+"/"+c,{method:"PATCH",body:JSON.stringify({[s]:u})},l);if(!d){p(i("Login status expired")),r(B());return}if(d.status!==200){p(await d.text());return}if(s==="password"){r(B()),n();return}if(s==="name"){r(_t(u)),n();return}};return e.jsxs(N,{isOpen:!!s,onClose:n,size:"xl",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(F,{children:[e.jsx(U,{children:i("Update account info")}),e.jsx(xe,{}),e.jsx(W,{children:e.jsx(Ne,{defaultValue:u,onDebouncedChange:d=>h(d)})}),e.jsx(q,{children:e.jsx(m,{onClick:w,children:i("Change")})})]})]})}const Is=/^\S+@\S+\.\S+$/,fe=t=>!!t.match(Is),ve=t=>t.length>=8&&!!t.match(/\d/)&&!!t.match(/[a-zA-Z]/),Ds=t=>{const s=ee(),{t:n}=v(),i=A(),[o,r]=x.useState(""),[a,c]=x.useState(""),[l,u]=x.useState(""),[h,p]=x.useState(""),[w,d]=x.useState(!1),C=!!o&&fe(o),M=C&&!!l&&!!a&&ve(a),f=D=>s({title:D,status:"error",duration:9e3,isClosable:!0}),b=async()=>{const D=await fetch(he+P.AUTH_SEND_RESET_PASSWORD_EMAIL,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:o})});if(D.status===204){p(o);return}if(D.status===400){p("error");return}},O=async()=>{d(!0);const D=new URLSearchParams({token:l}),j="".concat(he).concat(P.AUTH_RESET_PASSWORD,"?").concat(D.toString());try{const L=await fetch(j,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({password:a})});if(L.status!==204){f(await L.text());return}const{error:K,username:$}=(await i(Be({email:o,password:a}))).payload;s(K?{title:K,status:"error",duration:9e3,isClosable:!0}:{title:n("Welcome ")+$,status:"success",duration:5e3,isClosable:!0})}finally{d(!1)}};return e.jsxs(E,{children:[e.jsx(I,{children:e.jsx(z,{as:"h4",size:"md",my:1,children:n("Forgot password")})}),h&&e.jsxs(ae,{status:h==="error"?"error":"info",children:[e.jsx(re,{}),e.jsx(Oe,{children:h==="error"?n("Check your email again!"):n("Email with reset link is sent to: ")+h})]}),e.jsxs(k,{p:2,flexDirection:"column",children:[e.jsx(me,{fields:[{label:n("Email"),type:"custom",component:e.jsxs(tt,{size:"sm",children:[e.jsx(Ne,{type:"email",value:o,onDebouncedChange:r,delay:0,validator:fe}),e.jsx(st,{width:"auto",bottom:0,top:"unset",children:h?e.jsxs(e.Fragment,{children:[e.jsx(ht,{}),e.jsx(g,{fontSize:"xs",ml:1,children:n("Reset link sent")})]}):e.jsx(m,{size:"xs",onClick:b,isDisabled:!C,children:n("Send reset link")})})]})},{label:n("Reset password token"),type:"input",value:l,onChange:u,debouncedDelay:0},{label:n("Password"),type:"input",variant:"password",value:a,onChange:c,debouncedDelay:0,validator:ve,helper:n("Minimum 8 characters. Contain at least 1 letter and 1 number.")}],minW:"full"}),e.jsxs(T,{mt:1,children:[e.jsx(m,{colorScheme:"primary",onClick:O,isLoading:w,isDisabled:!M||w,children:n("Reset password")}),e.jsx(m,{onClick:()=>t.setLoginState("login"),isDisabled:w,children:n("Back to log in")})]})]})]})},Ts=/^\S+@\S+\.\S+$/,Ke=t=>!!t.match(Ts),Os=t=>{const s=ee(),{t:n}=v(),i=A(),[o,r]=x.useState(""),[a,c]=x.useState(""),[l,u]=x.useState(!1),h=!!o&&Ke(o)&&!!a,p=async()=>{u(!0);try{const{error:w,username:d}=(await i(Be({email:o,password:a}))).payload;s(w?{title:w,status:"error",duration:9e3,isClosable:!0}:{title:n("Welcome ")+d,status:"success",duration:5e3,isClosable:!0})}finally{u(!1)}};return e.jsxs(E,{children:[e.jsx(I,{children:e.jsx(z,{as:"h4",size:"md",my:1,children:n("Log in")})}),e.jsxs(k,{px:2,flexDirection:"column",children:[e.jsx(me,{fields:[{label:n("Email"),type:"input",variant:"email",value:o,onChange:r,validator:Ke,debouncedDelay:0},{label:n("Password"),type:"input",variant:"password",value:a,onChange:c,debouncedDelay:0}],minW:"full"}),e.jsx(Pe,{as:"button",fontSize:"sm",onClick:()=>t.setLoginState("forgot-password"),ml:"auto",children:n("Forgot password")+"?"}),e.jsxs(T,{mt:1,children:[e.jsx(m,{colorScheme:"primary",onClick:p,isLoading:l,isDisabled:!h||l,children:n("Log in")}),e.jsx(m,{onClick:()=>t.setLoginState("register"),isDisabled:l,children:n("Create an account")})]})]})]})},Xe=60,Ps=t=>{const s=ee(),{t:n}=v(),i=A(),[o,r]=x.useState(""),[a,c]=x.useState(""),[l,u]=x.useState(""),[h,p]=x.useState(""),[w,d]=x.useState(""),[C,M]=x.useState(!1),[f,b]=x.useState(!1),[O,D]=x.useState(Xe);x.useEffect(()=>{let H;return f&&O>0?H=window.setTimeout(()=>{D(O-1)},1e3):O===0&&b(!1),()=>clearTimeout(H)},[f,O]);const j=!!a&&fe(a),L=!!o&&j&&!!h&&!!l&&ve(l),K=H=>s({title:H,status:"error",duration:9e3,isClosable:!0}),$=async()=>{b(!0),D(Xe);const H=await fetch(he+P.AUTH_SEND_VERIFICATION_EMAIL,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:a})});if(H.status===204){d(a);return}if(H.status===400){d("error");return}},X=async()=>{M(!0);try{const H=await fetch(he+P.AUTH_REGISTER,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({name:o,email:a,password:l,emailVerificationToken:Number(h)})});if(H.status!==201){K(await H.text());return}const{error:le,username:we}=(await i(Be({email:a,password:l}))).payload;s(le?{title:le,status:"error",duration:9e3,isClosable:!0}:{title:n("Welcome ")+we,status:"success",duration:5e3,isClosable:!0})}finally{M(!1)}};return e.jsxs(E,{children:[e.jsx(I,{children:e.jsx(z,{as:"h4",size:"md",my:1,children:n("Create an account")})}),w&&e.jsxs(ae,{status:w==="error"?"error":"info",children:[e.jsx(re,{}),e.jsx(Oe,{children:w==="error"?n("The email is not valid!"):n("Verification email is sent to: ")+w})]}),e.jsxs(k,{px:2,flexDirection:"column",children:[e.jsx(me,{fields:[{label:n("Name"),type:"input",value:o,onChange:r,debouncedDelay:0,helper:n("You may always change it later.")},{label:n("Email"),type:"custom",component:e.jsxs(tt,{size:"sm",children:[e.jsx(Ne,{type:"email",value:a,onDebouncedChange:c,delay:0,validator:fe}),e.jsx(st,{width:"auto",bottom:0,top:"unset",children:w?e.jsxs(e.Fragment,{children:[e.jsx(ht,{}),e.jsx(g,{fontSize:"xs",ml:1,children:n("Verification code sent")})]}):e.jsx(m,{size:"xs",onClick:$,isDisabled:!j||f,children:f?"".concat(O,"s"):n("Send verification code")})})]}),helper:n("We'll never share your email.")},{label:n("Verification code"),type:"input",variant:"number",value:h,onChange:p,debouncedDelay:0},{label:n("Password"),type:"input",variant:"password",value:l,onChange:u,debouncedDelay:0,validator:ve,helper:n("Minimum 8 characters. Contain at least 1 letter and 1 number.")}],minW:"full"}),e.jsxs(T,{mt:1,children:[e.jsx(m,{colorScheme:"primary",onClick:X,isLoading:C,isDisabled:!L||C,children:n("Sign up")}),e.jsx(m,{onClick:()=>t.setLoginState("login"),isDisabled:C,children:n("Back to log in")})]})]})]})},Hs=1,Vs=10,_s=()=>{const t=ee(),{t:s}=v(),n=A(),{isLoggedIn:i,token:o,activeSubscriptions:r,currentSaveId:a,saves:c}=R(j=>j.account),{lastChangedAtTimeStamp:l}=R(j=>j.rmpSave),u=i&&c&&(r.RMP_CLOUD?c.length<Vs:c.length<Hs),h=Math.min(...(c!=null?c:[]).map(j=>j.id)),p=j=>!r.RMP_CLOUD&&j!==h,[w,d]=V.useState(void 0),[C,M]=V.useState(void 0),f=j=>t({title:j,status:"error",duration:9e3,isClosable:!0}),b=async()=>{const j=await Ee(Y.RMP);if(!i||!j||!o){f(s("Failed to get the RMP save!"));return}const{data:L,hash:K}=j,$=crypto.randomUUID(),X=await Q(P.SAVES,{method:"POST",body:JSON.stringify({index:$,data:L,hash:K})},o);if(!X){f(s("Login status expired")),n(B());return}if(X.status!==200){f(await X.text());return}n(se())},O=async j=>{if(!(!i||!o)){if(j===a){if(d(a),!a||p(a)){f(s("Can not sync this save!")),d(void 0);return}const L=await n(se());if(L.meta.requestStatus!=="fulfilled"){f(s("Login status expired")),d(void 0);return}const $=L.payload.saves.filter(gt=>gt.id===a).at(0);if(!$){f(s("Current save id is not in saveList!")),d(void 0);return}const X=new Date($.lastUpdateAt);if(new Date(l)<X){ue.warn("Save id: ".concat(a," is newer in the cloud via local compare.")),n(ot()),d(void 0);return}const le=await Ee(Y.RMP);if(!le){f(s("Failed to get the RMP save!")),d(void 0);return}const{data:we,hash:jt}=le,be=await Q(P.SAVES+"/"+a,{method:"PATCH",body:JSON.stringify({data:we,hash:jt})},o);if(!be){f(s("Login status expired")),d(void 0),n(B());return}if(be.status!==200){f(await be.text()),d(void 0);return}d(void 0)}else{d(j);const L=await Q(P.SAVES+"/"+j,{},o);if(!L){f(s("Login status expired")),d(void 0),n(B());return}if(L.status!==200){f(await L.text()),d(void 0);return}ue.info("Set ".concat(Y.RMP," with save id: ").concat(j)),at(Y.RMP,await L.text()),n(lt(new Date().valueOf())),rt(),d(void 0)}n(se())}},D=async j=>{if(!i||!j||!o)return;M(j);const L=await Q(P.SAVES+"/"+a,{method:"DELETE"},o);if(!L){f(s("Login status expired")),M(void 0),n(B());return}if(L.status!==200){f(await L.text()),M(void 0);return}n(se()),M(void 0)};return e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsx(z,{as:"h4",size:"md",my:1,children:s("Synced saves")}),e.jsxs(g,{ml:"auto",children:[s("Maximum save count:")," ",r.RMP_CLOUD?10:1]}),e.jsx(m,{size:"sm",ml:1,isDisabled:!u,onClick:b,children:s("Create")})]}),e.jsx(T,{p:2,children:c&&c.map(j=>e.jsx(ce,{overflow:"hidden",variant:"outline",mb:"3",children:e.jsxs(T,{direction:{base:"column",sm:"row"},children:[e.jsxs(de,{children:[e.jsx(g,{py:"2",as:"b",children:j.id===a?s("Current save"):s("Cloud save")}),e.jsxs(g,{py:"2",children:[s("Last update at:")," ",new Date(j.lastUpdateAt).toLocaleString()]})]}),e.jsx(je,{children:e.jsxs(T,{children:[e.jsx(m,{variant:"solid",colorScheme:"red",isLoading:C===j.id,onClick:()=>D(j.id),children:s("Delete this save")}),e.jsx(m,{variant:"solid",colorScheme:"primary",isDisabled:p(j.id),isLoading:w===j.id,onClick:()=>O(j.id),children:j.id===a?s("Sync now"):s("Sync this slot")})]})})]})},j.id))})]})},Bs=t=>{const s=ee(),{t:n}=v(),{isOpen:i,onClose:o,getSubscriptions:r}=t,{isLoggedIn:a,token:c}=R(C=>C.account),l=A(),u=ft("primary.500","primary.300"),[h,p]=V.useState(""),w=C=>s({title:C,status:"error",duration:9e3,isClosable:!0}),d=async C=>{if(!a)return;const M=await Q(P.SUBSCRIPTION_REDEEM,{method:"POST",body:JSON.stringify({cdkey:C.trim()})},c);if(!M){w(n("Login status expired")),l(B());return}if(M.status!==202){const f=(await M.json()).message;s({title:n(f),status:"error",duration:5e3,isClosable:!0});return}await r(),o()};return e.jsxs(N,{isOpen:i,onClose:o,size:"xl",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(F,{children:[e.jsx(U,{children:n("Redeem your subscription")}),e.jsx(xe,{}),e.jsxs(W,{children:[e.jsx(g,{children:n("CDKey could be purchased in the following sites:")}),e.jsx(He,{children:e.jsx(te,{children:e.jsxs(Pe,{color:u,href:"https://afdian.com/item/9c8b220c614311efab2d52540025c377",isExternal:!0,children:["çˆ±å‘ç”µ ",e.jsx(Re,{as:ie})]})})}),e.jsxs(T,{mt:"5",direction:{base:"column",sm:"row"},children:[e.jsx(g,{children:n("Enter your CDKey here:")}),e.jsx(vt,{w:"auto",value:h,onChange:C=>p(C.target.value)}),e.jsx(m,{colorScheme:"teal",onClick:()=>d(h),children:n("Redeem")})]})]}),e.jsx(q,{})]})]})},Ns=()=>{const t=ee(),{t:s}=v(),{isLoggedIn:n,token:i}=R(p=>p.account),o=A(),[r,a]=V.useState([]),[c,l]=V.useState(!1),u=p=>t({title:p,status:"error",duration:9e3,isClosable:!0}),h=async()=>{if(!n)return;const p=await Q(P.SUBSCRIPTION,{},i);if(!p){u(s("Login status expired")),o(B());return}if(p.status!==200){u(await p.text());return}const w=(await p.json()).subscriptions;if(!w.map(C=>C.type).includes("RMP_CLOUD"))return;a([{type:"RMP",expires:w[0].expires}]);const d=structuredClone(Bt);for(const C of w){const M=C.type;M in d&&(d[M]=!0)}o(Nt(d))};return V.useEffect(()=>{h()},[]),e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsx(z,{as:"h4",size:"md",my:1,children:s("All subscriptions")}),e.jsx(m,{size:"sm",ml:"auto",onClick:()=>l(!0),children:s("Redeem")})]}),e.jsxs(T,{px:2,children:[r.length===0&&e.jsxs(ce,{overflow:"hidden",variant:"outline",mb:"3",children:[e.jsx(Ue,{children:e.jsx(z,{size:"md",children:s("Rail Map Painter")})}),e.jsx(T,{direction:{base:"column",sm:"row"},children:e.jsx(de,{children:e.jsxs(T,{children:[e.jsx(g,{children:s("With this subscription, the following features are unlocked:")}),e.jsxs(He,{children:[e.jsx(te,{children:e.jsx(g,{children:s("PRO features")})}),e.jsx(te,{children:e.jsx(g,{children:s("Sync 9 more saves")})}),e.jsx(te,{children:e.jsx(g,{children:s("Unlimited master nodes")})}),e.jsx(te,{children:e.jsx(g,{children:s("Unlimited parallel lines")})})]}),e.jsxs(g,{children:[s("Expires at:")," ",s("Not applicable")]})]})})})]}),r.map(p=>e.jsxs(ce,{overflow:"hidden",variant:"outline",mb:"3",children:[e.jsx(Ue,{children:e.jsx(z,{size:"md",children:s(p.type==="RMP"?"Rail Map Painter":p.type)})}),e.jsxs(T,{direction:{base:"column",sm:"row"},children:[e.jsx(de,{children:e.jsxs(g,{py:"2",children:[s("Expires at:")," ",new Date(p.expires).toLocaleString()]})}),e.jsx(je,{children:e.jsx(m,{variant:"solid",colorScheme:"blue",onClick:()=>l(!0),children:s("Renew")})})]})]},p.type))]}),e.jsx(Bs,{isOpen:c,onClose:()=>l(!1),getSubscriptions:h})]})},Fs=()=>{const{t}=v(),{isLoggedIn:s}=R(o=>o.account),[n,i]=V.useState("login");return e.jsxs(E,{display:"flex",flexDirection:"column",h:"100%",overflow:"hidden",children:[e.jsx(I,{children:e.jsx(z,{as:"h4",size:"md",my:1,children:t("Account")})}),s?e.jsxs(k,{flexDirection:"column",h:"100%",overflow:"hidden",bg:"inherit",children:[e.jsx(As,{}),e.jsx(Ae,{}),e.jsxs(k,{flexDirection:"column",overflowY:"auto",bg:"inherit",children:[e.jsx(Ns,{}),e.jsx(Ae,{}),e.jsx(_s,{})]})]}):n==="login"?e.jsx(Os,{setLoginState:i}):n==="register"?e.jsx(Ps,{setLoginState:i}):e.jsx(Ds,{setLoginState:i})]})},Ye={"& button:first-of-type":{w:"100%",overflow:"hidden",justifyContent:"flex-start",textOverflow:"ellipsis",textAlign:"start","& span.chakra-button__icon":{ml:-1,color:"orange.300",'[data-theme="dark"] &':{color:"orange.200"}}},'&[aria-current="true"] > button':{bg:"primary.50",_hover:{bg:"primary.100"},'[data-theme="dark"] &':{bg:"primary.700",_hover:{bg:"primary.600"}}},"& > div":{zIndex:6}};function Us(t){var f;const{appId:s,onAboutOpen:n}=t,{t:i}=v(),o=A(),r=wt("(min-width: ".concat(bt.breakpoints.sm,")")),{activeTab:a,openedTabs:c}=R(b=>b.app),l=J[s],u=l.name.split(" - ").map(b=>i(b)).join(" - "),h=c.some(b=>b.app===s),p=!l.allowMultiInstances&&((f=c.find(b=>b.id===a))==null?void 0:f.app)===s,w=b=>{h||S.event(_.OPEN_APP,{appId:s,isOpenInNew:b}),o(b?Ft(s):Ut({appId:s})),r[0]||(o(Ie()),S.toggleNavMenu(!1))},d=b=>{o(Wt(b)),r[0]||(o(Ie()),S.toggleNavMenu(!1))},C=b=>{o($t(b)),S.event(_.CLOSE_APP,{app:s})},M=b=>{o(Gt(b)),S.event(_.CLOSE_APP,{app:b})};return e.jsxs(e.Fragment,{children:[e.jsxs(We,{variant:p?"solid":"ghost",size:"md",isAttached:!0,"aria-current":p,sx:Ye,children:[e.jsx(m,{onClick:()=>w(!1),leftIcon:h?e.jsx(js,{title:i("Running")}):e.jsx(pe,{w:4}),children:u}),l.allowMultiInstances&&e.jsx(G,{"aria-label":i("New tab"),title:i("New tab"),icon:e.jsx(ms,{}),onClick:()=>w(!0)}),e.jsxs(St,{children:[e.jsx(Ct,{as:G,icon:e.jsx(ys,{}),"aria-label":i("More"),title:i("More")}),e.jsxs(yt,{children:[h&&e.jsx($e,{icon:e.jsx(Je,{}),onClick:()=>M(s),children:l.allowMultiInstances?i("Close all tabs"):i("Close app")}),e.jsx($e,{icon:e.jsx(us,{}),onClick:n,children:i("About")})]})]})]}),l.allowMultiInstances&&c.filter(b=>b.app===s).map((b,O)=>{var j;const D=b.id===a;return e.jsxs(We,{variant:D?"solid":"ghost",size:"sm",ml:8,mr:1,isAttached:!0,"aria-current":D,sx:Ye,children:[e.jsxs(m,{onClick:()=>d(b.id),children:[e.jsx(nt,{mr:2,children:O+1}),(j=b.title)!=null?j:i("Tab")+" "+(O+1).toString()+" - "+u]}),e.jsx(G,{"aria-label":i("Close tab"),title:i("Close tab"),icon:e.jsx(Je,{}),onClick:()=>C(b.id)})]},b.id)})]})}const Ws=async t=>{const s="/".concat(t,"/info.json");try{return(await(await fetch(s)).json()).version}catch(n){return ue.info("Failed to get version of ".concat(t),n),"unknown"}},$s=async(t,s)=>{const n="/".concat(t,"/legacy-contributor-list.txt");return(await(await fetch(n,{signal:s})).text()).split("\n")};function Gs(t){var c,l,u;const{appId:s,onClose:n}=t,{t:i}=v(),[o,r]=x.useState("Unknown"),a=s?(u=(l=(c=J[s])==null?void 0:c.url)==null?void 0:l.split("/"))==null?void 0:u[1]:void 0;return x.useEffect(()=>{a?Ws(a).then(h=>r(h)):r("Unknown")},[a]),e.jsxs(N,{isOpen:!!s,onClose:n,size:"xl",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(F,{children:[e.jsxs(U,{children:[i("About")+" "+(s?J[s].name.split(" - ").map(h=>i(h)).join(" - "):""),e.jsx(nt,{ml:1,children:o})]}),e.jsx(xe,{}),e.jsx(W,{}),e.jsx(q,{children:e.jsx(m,{colorScheme:"primary",onClick:()=>window.open("https://github.com/railmapgen/"+a,"_blank"),children:i("Visit GitHub")})})]})]})}function Qe({assetType:t}){const{t:s}=v(),[n,i]=x.useState(),o=ct(t,S.getEnv(),S.getInstance());return e.jsxs(E,{children:[e.jsx(I,{children:e.jsx(z,{as:"h4",size:"md",my:1,children:s(t==="devtool"?"Devtools":"Apps")})}),e.jsx(k,{direction:"column",children:o.map(r=>e.jsx(Us,{appId:r,onAboutOpen:()=>i(r)},r))}),e.jsx(Gs,{appId:n,onClose:()=>i(void 0)})]})}const Js={"& button":{w:"100%",overflow:"hidden",justifyContent:"flex-start",textOverflow:"ellipsis",textAlign:"start","& span.chakra-button__icon:last-of-type":{ml:"auto"}}};function qs(){const{t}=v(),s=ct("link",S.getEnv(),S.getInstance()),n=i=>{S.event(_.OPEN_LINK,{id:i}),window.open(J[i].url,"_blank")};return e.jsxs(E,{sx:Js,children:[e.jsx(I,{children:e.jsx(z,{as:"h4",size:"md",my:1,children:t("Useful links")})}),e.jsx(k,{direction:"column",children:s.map(i=>e.jsx(m,{variant:"ghost",size:"md",leftIcon:e.jsx(pe,{w:4}),rightIcon:e.jsx(ie,{}),onClick:()=>n(i),children:t(J[i].name)},i))})]})}const Ks={"& > span":{minW:"75%",borderRadius:"lg",cursor:"pointer","& > span:last-of-type":{display:"block"},"& p":{fontSize:"sm","&:first-of-type":{fontSize:"lg",fontWeight:"bold",mb:1}}},"& .chakra-avatar":{ml:1,mr:3,my:4}};function Xs(){const{t}=v();return e.jsxs(E,{children:[e.jsx(I,{children:e.jsx(z,{as:"h5",size:"sm",children:t("Developer team")})}),e.jsxs(oe,{sx:Ks,children:[e.jsxs(Se,{size:"lg",onClick:()=>window.open("https://github.com/wongchito","_blank"),children:[e.jsx(ne,{src:"https://github.com/wongchito.png",size:"lg"}),e.jsxs(Ce,{children:[e.jsx(g,{children:"Chito Wong"}),e.jsx(g,{children:"Author of Rail Map Toolkit platform"}),e.jsx(g,{children:"Author of Rail Map Generator"})]})]}),e.jsxs(Se,{size:"lg",onClick:()=>window.open("https://github.com/thekingofcity","_blank"),children:[e.jsx(ne,{src:"https://github.com/thekingofcity.png",size:"lg"}),e.jsxs(Ce,{children:[e.jsx(g,{children:"thekingofcity"}),e.jsx(g,{children:"Author of Rail Map Painter"}),e.jsx(g,{children:"Author of RMG (Shanghai Metro style)"})]})]}),e.jsxs(Se,{size:"lg",onClick:()=>window.open("https://github.com/langonginc","_blank"),children:[e.jsx(ne,{src:"https://github.com/langonginc.png",size:"lg"}),e.jsxs(Ce,{children:[e.jsx(g,{children:"langonginc"}),e.jsx(g,{children:"Author of Rail Map Painter"})]})]})]})]})}function Fe(t){const{login:s,urlRepo:n,...i}=t,o=n?"https://github.com/railmapgen/".concat(n,"/issues?q=is:issue+author:").concat(s):"https://github.com/".concat(s);return e.jsx(ne,{name:s,title:s,src:"https://github.com/".concat(s,".png"),loading:"lazy",onClick:()=>window.open(o,"_blank"),cursor:"pointer",...i})}const Ys=["Swiftiecott","linchen1965","28yfang","Windows-Taskmgr"];function Qs(){const{t}=v();return e.jsxs(E,{children:[e.jsx(I,{children:e.jsx(z,{as:"h5",size:"sm",children:t("Resource administrators")})}),e.jsx(Ve,{spacing:1.5,px:2,children:Ys.map(s=>e.jsx(_e,{children:e.jsx(Fe,{login:s,size:"md"})},s))})]})}const ut="https://api.github.com/repos/railmapgen",ze={},pt=async(t,s)=>{if(t in ze)return ze[t];const i=await(await fetch(t,s)).json();return ze[t]=i,i},Zs=async(t,s,n)=>{const i="".concat(ut,"/").concat(t,"/contributors"),o=new URLSearchParams({per_page:"100",page:s.toString()});return(await pt(i+"?"+o.toString(),{signal:n})).map(a=>a.login)},en=async(t,s,n)=>{const i="".concat(ut,"/").concat(t,"/issues"),o=new URLSearchParams({state:"closed",labels:"donation",per_page:"100",page:s.toString()});return(await pt(i+"?"+o.toString(),{signal:n})).filter(a=>a.state_reason==="completed").map(a=>{var c;return(c=a.user)==null?void 0:c.login})};function xt(t){const[s,n]=x.useState([]);return[s,o=>{n(r=>{const a=new Set(r?r.concat(o):o);return Array.from(a)})}]}const tn=["","wongchito","thekingofcity","github-actions[bot]"],Ze=t=>!tn.includes(t);function sn(t){const[s,n]=xt(),[i,o]=x.useState(!0),[r,a]=x.useState(!1),c=x.useRef(),l=async()=>{var h;let u=0;for(;++u;){c.current=new AbortController;const p=await Zs(t,u,(h=c.current)==null?void 0:h.signal);if(n(p.filter(Ze)),p.length<100)break}};return x.useEffect(()=>(l().then(()=>{var u;return J[t].legacyContributors?(c.current=new AbortController,$s(t,(u=c.current)==null?void 0:u.signal)):[]}).then(u=>n(u.filter(Ze))).catch(u=>{ue.error("unable to fetch contributors for:",t,u),a(!0)}).finally(()=>o(!1)),()=>{var u;(u=c.current)==null||u.abort(),o(!0),a(!1)}),[t]),{contributors:s,isLoading:i,isError:r}}const nn={position:"relative",minH:20,"& .chakra-alert":{flexDirection:"column"},"& .chakra-alert__icon":{boxSize:7,mr:0,mb:1}};function on(t){const{appId:s}=t,{t:n}=v(),{contributors:i,isLoading:o,isError:r}=sn(s);return e.jsxs(k,{sx:nn,children:[o&&e.jsx(dt,{isIndeterminate:!0}),r&&e.jsxs(ae,{status:"warning",children:[e.jsx(re,{}),n("Unable to load contributors")]}),!r&&i&&e.jsx(Ve,{spacing:1.5,children:i==null?void 0:i.map(a=>e.jsx(_e,{children:e.jsx(Fe,{login:a,urlRepo:s,size:"sm"})},a))})]})}const an={"& > *:not(.rmg-section__header)":{px:2},"& h6":{my:2}};function rn(){const{t}=v();return e.jsxs(E,{sx:an,children:[e.jsx(I,{children:e.jsx(z,{as:"h5",size:"sm",children:t("Resource contributors")})}),Object.entries(J).filter(([,s])=>s.showContributors).map(([s,n])=>e.jsxs(x.Fragment,{children:[e.jsx(z,{as:"h6",size:"xs",children:t(n.name)}),e.jsx(on,{appId:s},s)]},s)),e.jsx(g,{as:"i",fontSize:"xs",mt:3,children:t("Notes: Contributors are sorted by number of commits and commit time.")})]})}function ln(){const[t,s]=xt(),[n,i]=x.useState(!0),[o,r]=x.useState(!1),a=x.useRef(),c=async()=>{var u;const l=Object.entries(J).filter(([,h])=>h.showDonators).map(([h])=>h);for(const h of l)try{let p=0;for(;++p;){a.current=new AbortController;const w=await en(h,p,(u=a.current)==null?void 0:u.signal);if(s(w),w.length<100)break}}catch(p){throw ue.error("unable to fetch donators for:",h,p),p}};return x.useEffect(()=>(c().catch(()=>r(!0)).finally(()=>i(!1)),()=>{var l;(l=a.current)==null||l.abort(),i(!0),r(!1)}),[]),{donators:t,isLoading:n,isError:o}}const cn={position:"relative",px:2,minH:20,"& .chakra-alert":{flexDirection:"column"},"& .chakra-alert__icon":{boxSize:7,mr:0,mb:1}};function dn(){const{t}=v(),{donators:s,isLoading:n,isError:i}=ln();return e.jsxs(E,{children:[e.jsx(I,{children:e.jsx(z,{as:"h5",size:"sm",children:"â¤ï¸ "+t("Donators")})}),e.jsxs(k,{sx:cn,children:[n&&e.jsx(dt,{isIndeterminate:!0}),i&&e.jsxs(ae,{status:"warning",children:[e.jsx(re,{}),t("Unable to load donators")]}),!i&&s&&e.jsx(Ve,{spacing:1.5,children:s==null?void 0:s.map(o=>e.jsx(_e,{children:e.jsx(Fe,{login:o,size:"sm"})},o))})]})]})}const hn={bg:"inherit",py:0,"& section:not(:last-of-type)":{mb:4}};function un(t){const{isOpen:s,onClose:n}=t,{t:i}=v();return e.jsxs(N,{isOpen:s,onClose:n,size:"xl",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(F,{children:[e.jsx(U,{children:i("Contributors")}),e.jsx(xe,{}),e.jsxs(W,{sx:hn,children:[e.jsx(Xs,{}),e.jsx(dn,{}),e.jsx(Qs,{}),e.jsx(rn,{})]}),e.jsx(q,{children:e.jsx(m,{colorScheme:"primary",onClick:()=>window.open("https://github.com/railmapgen/rmg/wiki/How-to-add-color-palette-and-line-templates","_blank"),children:i("Contribution Wiki")})})]})]})}function pn(){const{t}=v(),s=A(),{isShowMenu:n,showFontAdvice:i}=R(a=>a.app),[o,r]=x.useState(n&&i==="show");return x.useEffect(()=>{let a;return n&&i==="show"?a=window.setTimeout(()=>{r(!0)},5e3):r(!1),()=>{window.clearTimeout(a)}},[n,i]),e.jsxs(Mt,{isOpen:o,onClose:()=>s(Me()),children:[e.jsx(kt,{children:e.jsx(m,{variant:"ghost",size:"sm",w:"100%",leftIcon:e.jsx(hs,{}),onClick:()=>{s(ge("support")),s(Me())},children:t("Help & support")})}),e.jsxs(zt,{children:[e.jsx(Lt,{}),e.jsx(Rt,{}),e.jsxs(At,{children:["ðŸ’¡ ",t("Pro tip")]}),e.jsx(Et,{children:t("Fonts are slow to load? Learn how to speed it up!")}),e.jsxs(It,{display:"flex",children:[e.jsx(m,{variant:"ghost",size:"sm",ml:"auto",onClick:()=>{s(Jt()),S.storage.set(qt.SHOW_FONT_ADVICE,Kt)},children:t("Don't show again")}),e.jsx(m,{variant:"solid",colorScheme:"primary",size:"sm",ml:2,onClick:()=>s(Me()),children:t("OK")})]})]})]})}function xn(){const{t}=v(),s=A(),{menuView:n,refreshRequired:i}=R(a=>a.app),[o,r]=x.useState(!1);return e.jsxs(k,{direction:"column",children:[e.jsx(Ae,{}),n==="main"?e.jsxs(Dt,{templateColumns:"repeat(3, auto)",children:[e.jsx(ye,{children:e.jsx(m,{variant:"ghost",size:"sm",w:"100%",leftIcon:e.jsx(Ms,{}),onClick:()=>r(!0),children:t("Contributors")})}),e.jsx(ye,{children:e.jsx(pn,{})}),e.jsx(ye,{children:e.jsx(m,{variant:"ghost",size:"sm",w:"100%",leftIcon:e.jsx(xs,{}),onClick:()=>s(ge("settings")),children:t("Settings")})})]}):e.jsx(m,{variant:"ghost",size:"sm",w:"100%",leftIcon:e.jsx(Ss,{}),onClick:()=>s(ge("main")),isDisabled:i,children:t("Go back")}),e.jsx(un,{isOpen:o,onClose:()=>r(!1)})]})}function mt(){const{t}=v();return{type:"select",label:t("Language"),value:S.getLanguage(),options:{[t("Main languages")]:Yt.reduce((s,n)=>({...s,[n]:Ge[n][n]}),{}),[t("Other languages")]:Xt.reduce((s,n)=>({...s,[n]:Ge[n][n]}),{})},onChange:s=>{const n=s;S.setLanguage(n),S.getI18nInstance().changeLanguage(n),S.event(_.CHANGE_LANGUAGE,{language:n})}}}function mn(t){const{isOpen:s,onClose:n}=t,{t:i}=v(),o=Object.entries(localStorage),r=a=>{localStorage.removeItem(a),window.location.reload()};return e.jsxs(N,{isOpen:s,onClose:n,size:"xl",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(F,{children:[e.jsx(U,{children:i("Local Storage")}),e.jsx(xe,{}),e.jsx(W,{children:e.jsx(oe,{p:1,children:o.map(a=>e.jsxs(pe,{width:"100%",children:[e.jsxs(k,{children:[e.jsx(g,{children:a[0]}),e.jsx(k,{style:{flex:1}}),e.jsx(G,{icon:e.jsx(ds,{}),variant:"ghost","aria-label":"Clear",size:"xs",onClick:()=>r(a[0])})]}),e.jsx(Tt,{value:a[1],readOnly:!0,fontFamily:"monospace",fontSize:"xs"})]},a[0]))})}),e.jsx(q,{children:e.jsx(m,{onClick:n,children:i("Go back")})})]})]})}function jn(){const{t}=v(),{setColourMode:s}=ss(),n=A(),{lastShowDevtools:i,refreshRequired:o}=R(d=>d.app),[r,a]=x.useState(S.isAllowAnalytics()),[c,l]=x.useState(!1),u=mt(),h=d=>{a(d),S.allowAnalytics(d).refreshRequired&&n(es())},p={light:t("Light"),dark:t("Dark"),system:t("System")},w=[u,{type:"select",label:t("Appearance"),value:S.getColourMode(),options:p,onChange:d=>s(d)},{type:"switch",label:t("Allow cookies to help improve our website"),isChecked:r,onChange:h,oneLine:!0,isDisabled:o},{type:"switch",label:t("Show dev tools for 1 day"),isChecked:De(i),onChange:d=>{d?(n(Qt()),S.event(_.SHOW_DEVTOOLS)):n(Zt())},oneLine:!0}];return e.jsxs(E,{children:[o&&e.jsxs(ae,{status:"info",variant:"solid",size:"xs",children:[e.jsx(re,{}),t("Refreshing is required for changes to take effect.")]}),e.jsx(I,{children:e.jsx(z,{as:"h4",size:"md",my:1,children:t("Settings")})}),e.jsxs(pe,{px:2,children:[e.jsx(me,{fields:w,minW:"full"}),De(i)&&e.jsxs(e.Fragment,{children:[e.jsx(m,{width:"100%",onClick:()=>l(!0),children:t("Export Local Storage")}),e.jsx(mn,{isOpen:c,onClose:()=>l(!1)})]})]})]})}const gn={px:2,"& button":{w:"100%"}};function fn(){const{t}=v(),{remoteFonts:s}=R(n=>n.app);return e.jsxs(E,{children:[e.jsx(I,{children:e.jsx(z,{as:"h4",size:"md",my:1,children:t("Web fonts")})}),e.jsxs(oe,{sx:gn,children:[e.jsxs(g,{as:"i",fontSize:"sm",children:[t("FontsSection.text1")," ",t("FontsSection.text2")," ",t("FontsSection.text3")," (",t("FontsSection.safari"),")"]}),Object.entries(s).map(([n,i])=>e.jsx(m,{size:"sm",rightIcon:i.url?e.jsx(ie,{}):void 0,isDisabled:!i.url,onClick:()=>{window.open(i.url,"_blank"),S.event(_.DOWNLOAD_FONT,{family:n})},children:i.displayName?"".concat(i.displayName," (").concat(n,")"):n},n))]})]})}function vn(t){return y({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 32C132.3 32 32 134.9 32 261.7c0 101.5 64.2 187.5 153.2 217.9a17.56 17.56 0 0 0 3.8.4c8.3 0 11.5-6.1 11.5-11.4 0-5.5-.2-19.9-.3-39.1a102.4 102.4 0 0 1-22.6 2.7c-43.1 0-52.9-33.5-52.9-33.5-10.2-26.5-24.9-33.6-24.9-33.6-19.5-13.7-.1-14.1 1.4-14.1h.1c22.5 2 34.3 23.8 34.3 23.8 11.2 19.6 26.2 25.1 39.6 25.1a63 63 0 0 0 25.6-6c2-14.8 7.8-24.9 14.2-30.7-49.7-5.8-102-25.5-102-113.5 0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8a18.64 18.64 0 0 1 5-.5c8.1 0 26.4 3.1 56.6 24.1a208.21 208.21 0 0 1 112.2 0c30.2-21 48.5-24.1 56.6-24.1a18.64 18.64 0 0 1 5 .5c12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6 0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5 0 30.7-.3 55.5-.3 63 0 5.4 3.1 11.5 11.4 11.5a19.35 19.35 0 0 0 4-.4C415.9 449.2 480 363.1 480 261.7 480 134.9 379.7 32 256 32z"},child:[]}]})(t)}function wn(t){return y({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M126.12 315.1A47.06 47.06 0 1 1 79.06 268h47.06zm23.72 0a47.06 47.06 0 0 1 94.12 0v117.84a47.06 47.06 0 1 1-94.12 0zm47.06-188.98A47.06 47.06 0 1 1 244 79.06v47.06zm0 23.72a47.06 47.06 0 0 1 0 94.12H79.06a47.06 47.06 0 0 1 0-94.12zm188.98 47.06a47.06 47.06 0 1 1 47.06 47.1h-47.06zm-23.72 0a47.06 47.06 0 0 1-94.12 0V79.06a47.06 47.06 0 1 1 94.12 0zM315.1 385.88a47.06 47.06 0 1 1-47.1 47.06v-47.06zm0-23.72a47.06 47.06 0 0 1 0-94.12h117.84a47.06 47.06 0 1 1 0 94.12z"},child:[]}]})(t)}const bn={px:2,"& button":{w:"100%"}};function Sn(){const{t}=v();return e.jsxs(E,{children:[e.jsx(I,{children:e.jsx(z,{as:"h4",size:"md",my:1,children:t("Help & support")})}),e.jsxs(oe,{sx:bn,children:[e.jsx(m,{size:"md",leftIcon:e.jsx(vn,{}),rightIcon:e.jsx(ie,{}),onClick:()=>{window.open("https://github.com/railmapgen/railmapgen.github.io/issues","_blank"),S.event(_.RAISE_ISSUE)},children:t("Raise an Issue on GitHub")}),e.jsx(m,{size:"md",leftIcon:e.jsx(wn,{}),rightIcon:e.jsx(ie,{}),onClick:()=>{window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),S.event(_.JOIN_SLACK)},children:t("Join us on Slack")}),e.jsx(m,{size:"md",leftIcon:e.jsx(Le,{src:"images/bilibili.svg",boxSize:"20px"}),rightIcon:e.jsx(ie,{}),onClick:()=>{window.open("https://space.bilibili.com/10124055","_blank"),S.event(_.FOLLOW_BILIBILI)},children:t("Follow us on Bilibili")})]})]})}const et=420,Cn={flexShrink:0,flexDirection:"column",overflow:"hidden",alignItems:"flex-end",background:"inherit",transition:"0.3s ease-in-out",maxW:0,visibility:"hidden",boxShadow:"lg",zIndex:100,".show-menu &":{maxW:{base:"100%",md:et},w:{base:"100%",md:"unset"},visibility:"initial"},"& > div":{flexDirection:"column",h:"100%",w:{base:"100vw",md:et},background:"inherit","& .nav-menu__header":{flex:0,flexDirection:"row",alignItems:"center",minHeight:10,pl:12},"& .nav-menu__body":{flexDirection:"column",flex:1,overflowX:"hidden",overflowY:"auto",background:"inherit"}},"& .chakra-alert":{flexGrow:0,pl:3,pr:2,py:2,"& a":{fontWeight:"bold",textDecoration:"underline","&:hover, &:focus":{textDecoration:"none"}}}};function yn(){const{t}=v(),{menuView:s,lastShowDevtools:n}=R(r=>r.app),[i]=it(),o=(S.getInstance()==="GitLab"?"https://railmapgen.gitlab.io/":"https://railmapgen.github.io/")+"?"+i.toString();return e.jsx(k,{sx:Cn,children:e.jsxs(k,{children:[e.jsxs(k,{className:"nav-menu__header",children:[e.jsx(z,{as:"h4",size:"md",children:t("Rail Map Toolkit")}),e.jsx(ns,{environment:S.getEnv(),version:S.getAppVersion()})]}),S.getEnv()!=="PRD"&&e.jsxs(ae,{status:"warning",children:[e.jsx(re,{}),e.jsxs(Oe,{children:[t("You're currently viewing a testing environment.")," ",e.jsx(Pe,{href:o,isExternal:!0,children:t("Back to production environment")})]})]}),s==="main"&&e.jsx(Ls,{}),e.jsx(k,{className:"nav-menu__body",children:s==="main"?e.jsxs(e.Fragment,{children:[e.jsx(Qe,{assetType:"app"}),De(n)&&e.jsx(Qe,{assetType:"devtool"}),e.jsx(qs,{})]}):s==="settings"?e.jsx(jn,{}):s==="support"?e.jsxs(e.Fragment,{children:[e.jsx(Sn,{}),e.jsx(fn,{})]}):s==="account"?e.jsx(Fs,{}):e.jsx(e.Fragment,{})}),e.jsx(xn,{}),e.jsx(zs,{})]})})}function Mn(t){const{isOpen:s,onClose:n}=t,{t:i}=v(),o=x.useRef(null),r=mt(),a=()=>{S.allowAnalytics(!0),n()},c=()=>{S.allowAnalytics(!1).refreshRequired?window.location.reload():n()};return e.jsxs(N,{initialFocusRef:o,isOpen:s,onClose:()=>{},children:[e.jsx(Z,{}),e.jsxs(F,{children:[e.jsx(U,{children:i("CookiesModal.header")}),e.jsxs(W,{children:[e.jsx(k,{justifyContent:"flex-end",mt:-5,children:e.jsx(me,{fields:[r]})}),e.jsx(g,{children:i("CookiesModal.text1")}),e.jsx(g,{mt:2,children:i("CookiesModal.text2")}),e.jsx(He,{children:e.jsxs(te,{children:[" ",i("CookiesModal.item1")]})}),e.jsx(g,{mt:2,children:i("CookiesModal.text3")})]}),e.jsx(q,{children:e.jsxs(Te,{children:[e.jsx(m,{variant:"ghost",onClick:c,children:i("CookiesModal.reject")}),e.jsx(m,{ref:o,colorScheme:"primary",onClick:a,children:i("CookiesModal.accept")})]})})]})]})}const kn=()=>{};function zn(){const{t}=v(),[s,n]=x.useState(!1),i=()=>{n(!0),ts(),setTimeout(()=>{window.location.reload()},1e3)};return e.jsx(N,{isOpen:!0,onClose:kn,children:e.jsxs(F,{children:[e.jsx(U,{children:t("Rail Map Toolkit is opened in another window")}),e.jsx(W,{children:t("You cannot open multiple Rail Map Toolkit at the same time. Please close this window.")}),e.jsx(q,{children:e.jsx(m,{colorScheme:"primary",onClick:i,isLoading:s,children:t("Restart RMT in this window")})})]})})}const Ln=()=>{};function Rn(){const{t}=v();return e.jsx(N,{isOpen:!0,onClose:Ln,children:e.jsxs(F,{children:[e.jsx(U,{children:t("Rail Map Toolkit is opened in another window")}),e.jsx(W,{children:t("Current session has been terminated. Please close this window.")})]})})}function On(){const{t}=v(),s=A(),{isPrimary:n,isTerminated:i,isShowMenu:o}=R(l=>l.app),[r,a]=x.useState(!1);x.useEffect(()=>{S.isAnalyticsQADone()||a(!0)},[]);const c=()=>{S.toggleNavMenu(!o),s(Ie()),S.event(_.TOGGLE_NAV_MENU)};return i?e.jsx(ke,{children:e.jsx(Rn,{})}):n===!1?e.jsx(ke,{children:e.jsx(zn,{})}):e.jsx(Ot,{basename:"/",children:e.jsxs(ke,{className:o?"show-menu":"",children:[e.jsx(G,{variant:o?"ghost":"solid",colorScheme:o?void 0:"primary",size:"md","aria-label":t("Toggle menu"),title:t("Toggle menu"),icon:e.jsx(Cs,{}),position:"absolute",zIndex:110,borderRadius:0,onClick:c}),e.jsxs(is,{sx:{flexDirection:"row"},children:[e.jsx(yn,{}),e.jsx(cs,{})]}),e.jsx(Mn,{isOpen:r,onClose:()=>a(!1)})]})})}export{On as default};

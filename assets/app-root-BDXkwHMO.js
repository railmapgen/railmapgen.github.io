import{j as e,S as B,G as A,I as je,T as _,e as y,n as ve,u as pt,o as W,C as X,F as re,p as gt,B as w,q as xt,s as mt,t as Y,v as D,w as jt,P as xe,x as We,y as St,z as ke,D as Se,E as ft,A as Fe,H as wt,J as bt,b as H,c as G,d as oe,g as F,K as $e,O as Me,Q as le,U as yt,V as Je,W as Re,X as Te,M as de,Y as Ct,Z as vt,_ as kt,$ as Mt,l as fe,a0 as P,a1 as te,a2 as ue,a3 as we,a4 as qe,a5 as At,a6 as ie,a7 as Lt,a8 as Et,a9 as Rt,r as f,aa as Tt,ab as Ot,ac as It,N as Pt,ad as _t,ae as Nt,af as Oe,ag as zt,ah as Ke,ai as Dt,aj as Bt,ak as Vt,al as Ut,am as Ht,an as Gt,k as Wt,ao as Ft,ap as $t,aq as Jt,ar as qt,i as Kt,as as Yt,m as Qt}from"./mantine-DGOyxB5N.js";import{l as C,r as x,p as Ye,R as K,B as Zt}from"./react-Tbv_pmSw.js";import{u as N,o as be,F as Xt,a as T,b as es,S as ee,l as z,s as Qe,f as q,g as ye,c as Ze,n as Xe,d as et,e as ts,h as O,A as I,i as ss,j as R,k as Ae,m as as,E as U,p as ns,t as he,q as os,r as is,v as rs,w as tt,x as ls,y as cs,z as ds,B as us,C as hs,D as ps,G as gs}from"./main-C6dbnT-8.js";import{a as Q,b as st,S as xs,O as ms,L as me}from"./asset-enablements-B2QE_TNU.js";import"./index-DJ7VzeDB.js";const js="_root_uo1gg_1",Ss="_burger_uo1gg_4",Ie={root:js,burger:Ss},fs="_workspace_1oasi_1",ws="_show_1oasi_13",bs="_welcome_1oasi_28",ys="_icons_1oasi_43",ne={workspace:fs,"app-container":"_app-container_1oasi_8",show:ws,"pb-safe-area-inset":"_pb-safe-area-inset_1oasi_17",welcome:bs,icons:ys},Cs="/assets/rmp-logo512-eHekupnf.png";function vs(){const{t}=C(),a=N();return e.jsxs(B,{className:ne.welcome,children:[e.jsxs(A,{className:ne.icons,grow:!0,children:[e.jsx(je,{src:"/logo512.png",title:t("Open")+" "+t("Rail Map Generator"),onClick:()=>a(be({appId:"rmg"}))}),e.jsx(je,{src:Cs,title:t("Open")+" "+t("Rail Map Painter"),onClick:()=>a(be({appId:"rmp"}))})]}),e.jsx(_,{children:t("Welcome to Rail Map Toolkit")}),e.jsx(y,{children:t("Select an app to start your own rail map design!")})]})}function ks(t){const{tab:a,isActive:n}=t,s=x.useMemo(()=>a.url??"/"+a.app+"/",[a.app]);return e.jsx("div",{className:ve(ne["app-container"],n&&ne.show,Q[a.app]&&!Q[a.app].supportSafeAreaInset&&ne["pb-safe-area-inset"]),children:e.jsx("iframe",{id:Xt+a.id,src:s,loading:"lazy",title:a.app,"data-persisted-url":a.url,"data-testid":"app-container-iframe"})})}function Ms({alwaysShowWelcome:t}){const{openedTabs:a,activeTab:n}=T(i=>i.app),[,s]=Ye();return x.useEffect(()=>{if(n){const i=a.find(o=>o.id===n)?.app;s(i?{app:i}:{})}else s({})},[n]),e.jsx("div",{className:ne.workspace,children:t||a.length===0?e.jsx(vs,{}):a.map(i=>e.jsx(ks,{tab:i,isActive:n===i.id},i.id))})}function at(){return pt("(min-width: 36em)")}const As="_card_15zs0_1",Pe={card:As},_e=(t,a,n)=>{const s=new Blob([n],{type:a});Ls(t,s)},Ls=(t,a)=>{const n=window.URL.createObjectURL(a),s=document.createElement("a");s.href=n,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(n)},Es=()=>{const{t}=C(),{token:a,refreshToken:n,currentSaveId:s}=T(r=>r.account),{resolveConflictModal:{isOpen:i,lastChangedAtTimeStamp:o,lastUpdatedAtTimeStamp:l,cloudData:d}}=T(r=>r.rmpSave),u=N(),[h,m]=K.useState(!1),p=()=>u(ts()),c=()=>{Ze(ee.RMP,d),Xe(),u(et(l)),p()},S=()=>{_e(`RMP_${l}.json`,"application/json",d)},b=async()=>{if(!s||!a||!n)return;m(!0);const r=await es(s,a,n,ee.RMP);if(!r){u(z()),m(!1);return}if(r.status===409){u(Qe()),m(!1);return}r.status===200&&(u(q()),m(!1),p())},j=async()=>{const{data:r}=await ye(ee.RMP);_e(`RMP_${o}.json`,"application/json",r)};return e.jsxs(W,{opened:i,onClose:()=>{},size:"lg",title:t("Oops! It seems there's a conflict"),withCloseButton:!1,closeOnClickOutside:!1,closeOnEscape:!1,centered:!0,children:[e.jsx(y,{children:t("The local save is newer than the cloud one. Which one would you like to keep?")}),e.jsxs(A,{my:"xs",children:[e.jsx(X,{withBorder:!0,className:Pe.card,children:e.jsxs(B,{children:[e.jsxs(re,{children:[e.jsx(gt,{}),e.jsx(y,{span:!0,children:t("Local save")})]}),e.jsxs(y,{span:!0,children:[t("Update at:")," ",new Date(o).toLocaleString()]}),e.jsx(w,{color:"red",loading:h,onClick:()=>b(),children:t("Replace cloud with local")}),e.jsx(w,{onClick:()=>j(),children:t("Download Local save")})]})}),e.jsx(X,{withBorder:!0,className:Pe.card,children:e.jsxs(B,{children:[e.jsxs(re,{children:[e.jsx(xt,{}),e.jsx(y,{span:!0,children:t("Cloud save")})]}),e.jsxs(y,{span:!0,children:[t("Update at:")," ",new Date(l).toLocaleString()]}),e.jsx(w,{color:"red",onClick:()=>c(),children:t("Replace local with cloud")}),e.jsx(w,{onClick:()=>S(),children:t("Download Cloud save")})]})})]})]})},Rs="_body_yczk0_1",Ts={body:Rs};function nt(t){const{initialValue:a,onSave:n,fontWeight:s="bold",iconVariant:i,textInputWidth:o,placeholder:l="...",emptyPlaceholder:d="(empty)"}=t,u=mt(),[h,m]=x.useState(!1),[p,c]=x.useState(a),S=x.useRef(null),[b,j]=x.useState("");x.useEffect(()=>{h&&S.current&&(S.current.focus(),S.current.select())},[h]);const r=()=>{j(p),m(!0)},M=()=>{p!==b&&n(p),m(!1)},L=()=>{c(b),m(!1)},v=V=>{c(V.currentTarget.value)},k=V=>{V.key==="Enter"?M():V.key==="Escape"&&L()},$=()=>{M()};return h?e.jsx(A,{gap:"xs",wrap:"nowrap",style:{width:o},children:e.jsx(Y,{ref:S,value:p,onChange:v,onKeyDown:k,onBlur:$,placeholder:l,styles:{input:{fontWeight:s}}})}):e.jsxs(A,{gap:"xs",wrap:"nowrap",flex:"1",p:"0",onClick:r,style:{cursor:"pointer",padding:`calc(${u.spacing.xs} / 2) ${u.spacing.xs}`,minHeight:"36px",display:"flex",alignItems:"center",borderRadius:u.radius.sm,"&:hover":{backgroundColor:u.colors.gray[0]}},children:[e.jsx(y,{fw:s,style:{flexGrow:1,whiteSpace:"pre-wrap",wordBreak:"break-word"},children:p||d}),e.jsx(D,{variant:i,color:i=="subtle"?"gray":void 0,onClick:V=>{V.stopPropagation(),r()},title:"Edit",children:e.jsx(jt,{size:16})})]})}function Ne({meets:t,label:a}){return e.jsxs(y,{c:t?"teal":"red",style:{display:"flex",alignItems:"center"},mt:7,size:"sm",children:[t?e.jsx(ke,{size:14}):e.jsx(Se,{size:14}),e.jsx(ft,{ml:10,children:a})]})}const Ce=[{re:/[0-9]/,label:"Includes number"},{re:/[a-zA-Z]/,label:"Includes letter"}];function Os(t){let a=t.length>=8?0:1;return Ce.forEach(n=>{n.re.test(t)||(a+=1)}),Math.max(100-100/(Ce.length+1)*a,10)}function Le({value:t,onChange:a}){const{t:n}=C(),[s,i]=x.useState(!1),o=Ce.map((u,h)=>e.jsx(Ne,{label:u.label,meets:u.re.test(t)},h)),l=Os(t),d=l===100?"teal":l>50?"yellow":"red";return e.jsxs(xe,{opened:s,position:"bottom",width:"target",transitionProps:{transition:"pop"},children:[e.jsx(xe.Target,{children:e.jsx("div",{onFocusCapture:()=>i(!0),onBlurCapture:()=>i(!1),children:e.jsx(We,{label:n("Password"),value:t,onChange:u=>a(u.currentTarget.value)})})}),e.jsxs(xe.Dropdown,{children:[e.jsx(St,{color:d,value:l,size:5,mb:"xs"}),e.jsx(Ne,{label:n("Includes at least 8 characters"),meets:t.length>=8}),o]})]})}const Is=()=>{const{t}=C(),a=N(),{isLoggedIn:n,id:s,email:i,name:o,token:l,refreshToken:d}=T(r=>r.account),[u,h]=K.useState(void 0),[m,p]=K.useState(""),c=async()=>{n&&(await O(I.AUTH_LOGOUT,{method:"POST",body:JSON.stringify({refreshToken:d})}),a(z()))},S=r=>a(R({title:t("Unable to update account info"),message:r,type:"error",duration:9e3})),b=async r=>{if(n)try{const M=await O(I.USER+"/"+s,{method:"PATCH",body:JSON.stringify({name:r})},l);if(M.status===401){S(t("Login status expired.")),a(z());return}if(M.status!==200){S(await M.text());return}a(ss(r))}catch(M){S(M.message)}},j=async()=>{if(n)try{const r=await O(I.USER+"/"+s,{method:"PATCH",body:JSON.stringify({password:m})},l);if(r.status===401){S(t("Login status expired.")),a(z());return}if(r.status!==200){S(await r.text());return}a(z()),h(void 0)}catch(r){S(r.message)}};return e.jsxs(e.Fragment,{children:[e.jsxs(re,{py:"xs",align:"center",wrap:"wrap",children:[e.jsx(Fe,{size:"lg",name:o,color:"initials"}),e.jsxs(B,{justify:"center",ml:"md",gap:"0",flex:"1",children:[e.jsxs(A,{children:[e.jsx(nt,{initialValue:o??"",onSave:r=>b(r),iconVariant:"subtle",textInputWidth:"181px"}),e.jsx(D,{variant:"subtle",color:"gray",size:"sm",onClick:()=>h("password"),"aria-label":t("Change password"),title:t("Change password"),children:e.jsx(wt,{})}),e.jsx(D,{variant:"subtle",color:"gray",size:"sm",onClick:c,"aria-label":t("Log out"),title:t("Log out"),children:e.jsx(bt,{})})]}),e.jsx(y,{span:!0,size:"sm",children:i})]})]}),e.jsxs(W,{opened:!!u,onClose:()=>h(void 0),title:t("Update account info"),closeOnEscape:!1,children:[e.jsx(Le,{value:m,onChange:r=>p(r)}),e.jsx(A,{mt:"xs",children:e.jsx(w,{ml:"auto",onClick:j,children:t("Change")})})]})]})},Ps=/^\S+@\S+\.\S+$/,pe=t=>!!t.match(Ps),ot=t=>t.length>=8&&!!t.match(/\d/)&&!!t.match(/[a-zA-Z]/),ze=60;function it({value:t,onChange:a,onVerify:n,otpSent:s,allowResendOtp:i,...o}){const{t:l}=C(),[d,u]=x.useState(!1),[h,m]=x.useState(ze),p=!!t&&pe(t),c=()=>{i&&(u(!0),m(ze)),n()};return x.useEffect(()=>{let S;return d&&h>0?S=window.setTimeout(()=>{m(h-1)},1e3):h===0&&u(!1),()=>clearTimeout(S)},[d,h]),e.jsx(Y,{type:"email",label:l("Email"),value:t,onChange:({currentTarget:{value:S}})=>a(S),error:t&&!pe(t),rightSection:s?e.jsx(w,{variant:"transparent",size:"xs",leftSection:e.jsx(ke,{}),disabled:!0,children:l("Verification code sent")}):e.jsx(w,{variant:"subtle",size:"xs",onClick:c,disabled:!p||d,children:d?`${h}s`:l("Send verification code")}),rightSectionWidth:"fit-content",...o})}const _s=t=>{const{t:a}=C(),n=N(),[s,i]=x.useState(""),[o,l]=x.useState(""),[d,u]=x.useState(""),[h,m]=x.useState(""),[p,c]=x.useState(!1),b=!!s&&pe(s)&&!!d&&!!o&&ot(o),j=L=>n(R({title:a("Unable to reset your password"),message:L,type:"error",duration:9e3})),r=async()=>{try{const L=await O(I.AUTH_SEND_RESET_PASSWORD_EMAIL,{method:"POST",body:JSON.stringify({email:s})});L.status===204?m(s):L.status>400&&m("error")}catch{m("error")}},M=async()=>{c(!0);const L=new URLSearchParams({token:d}),v=`${I.AUTH_RESET_PASSWORD}?${L.toString()}`;try{const k=await O(v,{method:"POST",body:JSON.stringify({password:o})});if(k.status!==204){j(await k.text());return}const{error:$,username:V}=(await n(Ae({email:s,password:o}))).payload;$?j($):n(R({title:a("Welcome ")+V,message:a("Your password has been reset successfully."),type:"success",duration:5e3}))}catch(k){j(k.message)}finally{c(!1)}};return e.jsxs(H,{children:[e.jsx(G,{children:e.jsx(_,{order:3,size:"h5",children:a("Forgot password")})}),e.jsxs(oe,{direction:"column",gap:"xs",children:[h==="error"&&e.jsx(F,{color:"red",icon:e.jsx($e,{}),title:a("Check your email again!")}),h&&h!=="error"&&e.jsx(F,{color:"blue",icon:e.jsx(Me,{}),title:a("Email with reset link is sent to")+" "+h}),e.jsx(it,{value:s,onChange:i,onVerify:r,otpSent:h}),e.jsx(Y,{label:a("Reset password token"),value:d,onChange:({currentTarget:{value:L}})=>u(L)}),e.jsx(Le,{value:o,onChange:l}),e.jsx(w,{onClick:M,loading:p,disabled:!b||p,children:a("Reset password")}),e.jsx(w,{variant:"default",onClick:()=>t.setLoginState("login"),disabled:p,children:a("Back to log in")})]})]})},Ns=/^\S+@\S+\.\S+$/,De=t=>!!t.match(Ns),zs=t=>{const{t:a}=C(),n=N(),[s,i]=x.useState(""),[o,l]=x.useState(""),[d,u]=x.useState(!1),h=!!s&&De(s)&&!!o,m=async()=>{u(!0);try{const{error:p,username:c}=(await n(Ae({email:s,password:o}))).payload;n(p?R({title:a("Unable to login"),message:p,type:"error",duration:9e3}):R({title:a("Welcome ")+c,message:a("Login success"),type:"success",duration:5e3}))}finally{u(!1)}};return e.jsxs(H,{children:[e.jsx(G,{children:e.jsx(_,{order:3,size:"h5",children:a("Log in")})}),e.jsxs(oe,{direction:"column",gap:"xs",children:[e.jsx(Y,{type:"email",label:a("Email"),value:s,onChange:({currentTarget:{value:p}})=>i(p),error:s&&!De(s)}),e.jsx(We,{label:a("Password"),value:o,onChange:({currentTarget:{value:p}})=>l(p)}),e.jsx(le,{component:"button",ml:"auto",onClick:()=>t.setLoginState("forgot-password"),children:a("Forgot password")+"?"}),e.jsx(w,{onClick:m,loading:d,disabled:!h||d,children:a("Log in")}),e.jsx(w,{variant:"default",onClick:()=>t.setLoginState("register"),disabled:d,children:a("Create an account")})]})]})},Ds=t=>{const{t:a}=C(),n=N(),[s,i]=x.useState(""),[o,l]=x.useState(""),[d,u]=x.useState(""),[h,m]=x.useState(""),[p,c]=x.useState(""),[S,b]=x.useState(!1),j=!!o&&pe(o),r=!!s&&j&&!!h&&!!d&&ot(d),M=k=>n(R({title:a("Unable to create your account"),message:k,type:"error",duration:9e3})),L=async()=>{try{const k=await O(I.AUTH_SEND_VERIFICATION_EMAIL,{method:"POST",body:JSON.stringify({email:o})});k.status===204?c(o):k.status>400&&c("error")}catch{c("error")}},v=async()=>{b(!0);try{const k=await O(I.AUTH_REGISTER,{method:"POST",body:JSON.stringify({name:s,email:o,password:d,emailVerificationToken:Number(h)})});if(k.status!==201){M(await k.text());return}const{error:$,username:V}=(await n(Ae({email:o,password:d}))).payload;$?M($):n(R({title:a("Welcome ")+V,message:a("Your account is created successfully."),type:"success",duration:5e3}))}catch(k){M(k.message)}finally{b(!1)}};return e.jsxs(H,{children:[e.jsx(G,{children:e.jsx(_,{order:3,size:"h5",children:a("Create an account")})}),e.jsxs(oe,{direction:"column",gap:"xs",children:[p==="error"&&e.jsx(F,{color:"red",icon:e.jsx($e,{}),title:a("The email is not valid!")}),p&&p!=="error"&&e.jsx(F,{color:"blue",icon:e.jsx(Me,{}),title:a("Verification email is sent to")+" "+p}),e.jsx(Y,{label:a("Name"),description:a("You may always change it later."),value:s,onChange:({currentTarget:{value:k}})=>i(k)}),e.jsx(it,{description:a("We'll never share your email."),value:o,onChange:l,onVerify:L,otpSent:p,allowResendOtp:!0}),e.jsx(Y,{label:a("Verification code"),value:h,onChange:({currentTarget:{value:k}})=>m(k)}),e.jsx(Le,{value:d,onChange:u}),e.jsx(w,{onClick:v,loading:S,disabled:!r||S,children:a("Sign up")}),e.jsx(w,{variant:"default",onClick:()=>t.setLoginState("login"),disabled:S,children:a("Back to log in")})]})]})},Be=["Tokyo","Paris","London","New York","Shanghai","Dubai","Sydney","Rio de Janeiro","Cairo","Moscow","Rome","Berlin","Madrid","Seoul","Singapore","Hong Kong","Beijing","Mexico City","Buenos Aires","Istanbul","Lagos","Jakarta","Osaka","Manila","Chongqing","Karachi","Dhaka","Lima","Bangkok","Lahore","Ho Chi Minh City","Shenzhen","Tianjin","Taipei","Bogota","Baghdad","Riyadh","Santiago","Guangzhou","Yangon","Johannesburg","Toronto","Montreal","Vancouver","Sao Paulo","Kuala Lumpur","Athens","Lisbon","Dublin","Amsterdam","Vienna","Prague","Budapest","Warsaw","Stockholm","Oslo","Helsinki","Copenhagen","Brussels","Geneva","Zurich","Barcelona","Milan","Florence","Venice","Munich","Hamburg","Frankfurt","Kyoto","Nairobi","Cape Town","Casablanca","Marrakesh","Accra","Addis Ababa","Alexandria","Ankara","Jerusalem","Tel Aviv","Beirut","Abu Dhabi","Doha","Kuwait City","Muscat","Amman","Baku","Tbilisi","Yerevan","Almaty","Tashkent","Kabul","Tehran","Damascus","Sana'a","Aden","Manama","Jeddah","Mecca","Medina","Salalah","Nicosia","Thessaloniki","Sofia","Bucharest","Belgrade","Zagreb","Sarajevo","Skopje","Tirana","Pristina","Podgorica","Ljubljana","Bratislava","Krakow","Gdansk","Wroclaw","Poznan","Vilnius","Riga","Tallinn","Reykjavik","Manchester","Birmingham","Glasgow","Edinburgh","Cardiff","Belfast","Marseille","Lyon","Toulouse","Nice","Nantes","Strasbourg","Bordeaux","Lille","Cologne","Stuttgart","Dusseldorf","Dortmund","Essen","Leipzig","Dresden","Hanover","Nuremberg","Bremen","Rotterdam","The Hague","Utrecht","Eindhoven","Porto","Valencia","Seville","Zaragoza","Malaga","Murcia","Palma de Mallorca","Las Palmas de Gran Canaria","Antwerp","Ghent","Charleroi","LiÃ¨ge","Bern","Basel","Lausanne","Graz","Linz","Salzburg","Innsbruck","Naples","Turin","Palermo","Genoa","Bologna","Bari","Catania","Verona","Melbourne","Brisbane","Perth","Adelaide","Gold Coast","Canberra","Auckland","Wellington","Christchurch","Dunedin","Suva","Port Moresby","Noumea","Papeete","Honolulu","Quezon City","Davao City","Cebu City","Chiang Mai","Phuket","George Town","Ipoh","Johor Bahru","Surabaya","Bandung","Medan","Semarang","Lima","Bogota","Caracas","Quito","La Paz","Sucre","Buenos Aires","Cordoba","Rosario","Mendoza","Valparaiso","Concepcion","Arequipa","Trujillo","Chiclayo","Piura","Medellin","Cali","Barranquilla","Cartagena","Maracaibo","Valencia","Barquisimeto","Ciudad Guayana","Guayaquil","Cuenca","Santo Domingo","Santa Cruz de la Sierra","Cochabamba","Guadalajara","Monterrey","Puebla","Tijuana","Leon","Juarez","Ecatepec","Zapopan","Nezahualcoyotl","Chihuahua","Naucalpan","Merida","Aguascalientes","San Luis Potosi","Hermosillo","Saltillo","Mexicali","Culiacan","Acapulco","Guadalupe","Cancun","Torreon","El Paso","Tucson","Phoenix","Los Angeles","San Diego","San Jose","San Francisco","Seattle","Portland","Las Vegas","Denver","Chicago","Houston","Dallas","San Antonio","Austin","Philadelphia","Washington D.C.","Boston","Miami","Atlanta","Orlando","Tampa","Detroit","Cleveland","Minneapolis","St. Louis","Kansas City","New Orleans","Charlotte","Nashville","Indianapolis","Columbus","Cincinnati","Pittsburgh","Milwaukee","Calgary","Edmonton","Winnipeg","Ottawa","Quebec City","Halifax","Chengdu","Wuhan","Hangzhou","Suzhou","Xian","Nanjing","Zhengzhou","Jinan","Qingdao","Hefei","Fuzhou","Xiamen","Ningbo","Wuxi","Kunming","Changsha","Nanchang","Shijiazhuang","Harbin","Changchun","Taiyuan","Urumqi","Lanzhou","Yinchuan","Xining","Guiyang","Lhasa","Hohhot","Nanning","Haikou","Sanya","Zhuhai","Foshan","Dongguan","Zhongshan","Shantou","Wenzhou","Jiaxing","Shaoxing","Taizhou","Jinhua","Quanzhou","Putian","Zhangzhou","Longyan","Sanming","Nanping","Yingtan","Shangrao","Jiujiang","Jingdezhen","Pingxiang","Xinyu","Yichun","Ganzhou","Qingyuan","Shaoguan","Heyuan","Meizhou","Shanwei","Yangjiang","Zhanjiang","Maoming","Zhaoqing","Yunfu","Laibin","Chongzuo","Hechi","Baise","Wuzhou","Fangchenggang","Qinzhou","Beihai","Guigang","Yulin","Cenxi","Dongxing","Anshan","Fushun","Jilin City","Qiqihar","Daqing","Mudanjiang","Jixi"],Bs=()=>{const t=Math.floor(Math.random()*Be.length);return Be[t]},Vs={index:"0",id:0},Us=({opened:t,onClose:a,shareSaveInfo:n})=>{const{t:s}=C(),[i,o]=x.useState(!1),l=N(),{id:d,index:u,share:h}=n??Vs,{token:m,activeSubscriptions:p}=T(j=>j.account),c=()=>{o(!0),setTimeout(()=>o(!1),2e3)},S=async()=>{try{const j=await O(I.SHARE+`/${d}`,{method:"POST"},m);if(j.status===401){l(R({type:"error",title:s("Session expired."),message:s("Please log in again."),duration:5e3})),l(z());return}if(j.status!==201){l(R({type:"error",title:s("Error"),message:await j.text(),duration:5e3}));return}l(q()),l(R({type:"success",title:s("Success"),message:s("Share link created successfully."),duration:3e3}))}catch(j){l(R({type:"error",title:s("Error"),message:j.message,duration:5e3}))}},b=async()=>{try{const j=await O(I.SHARE+`/${d}`,{method:"DELETE"},m);if(j.status===401){l(R({type:"error",title:s("Session expired."),message:s("Please log in again."),duration:5e3})),l(z());return}if(j.status!==204){l(R({type:"error",title:s("Error"),message:await j.text(),duration:5e3}));return}l(q()),l(R({type:"success",title:s("Success"),message:s("Share link deleted successfully."),duration:3e3}))}catch(j){l(R({type:"error",title:s("Error"),message:j.message,duration:5e3}))}};return e.jsxs(W,{opened:t,onClose:a,title:e.jsx(_,{size:"h3",children:`${s("Share work {{index}}",{index:u})}`}),size:"lg",children:[e.jsx(y,{mb:"sm",children:s("Share this link with others to allow them to view this work.")}),h?e.jsxs(B,{children:[e.jsx(Y,{value:`${window.origin}?app=rmp&s=${h.s}.org`,readOnly:!0,style:{flexGrow:1},rightSection:e.jsx(yt,{value:`${window.origin}?app=rmp&s=${h.s}.org`,timeout:2e3,children:({copied:j,copy:r})=>e.jsx(Je,{label:s(j?"Copied":"Copy"),withArrow:!0,position:"right",children:e.jsx(D,{color:j?"teal":"gray",onClick:()=>{r(),c()},children:j||i?e.jsx(ke,{}):e.jsx(Re,{})})})})}),e.jsxs(A,{justify:"space-between",children:[e.jsxs(y,{children:[s("This link is valid until:")," ",new Date(h.validUntil??p.RMP_EXPORT??Date.now().toLocaleString()).toLocaleString()]}),e.jsx(w,{color:"red",onClick:b,ml:"xs",size:"sm",variant:"light",children:s("Delete Share")})]})]}):e.jsx(A,{children:e.jsx(w,{onClick:S,leftSection:e.jsx(Re,{}),children:s("Create Share Link")})}),e.jsx(Te,{h:"md"}),e.jsx(F,{color:"yellow",icon:e.jsx(de,{}),title:s("Please be aware that sharing this link does not create a separate copy of your work. Instead, everyone who opens the link will always see the most up-to-date version. So, if you make changes after sharing the link, those changes will be visible to everyone who has the link.")}),e.jsx(Te,{h:"md"}),e.jsx(F,{color:"yellow",icon:e.jsx(de,{}),title:s("Link will be valid as long as you have an active subscription. Otherwise, the link will be invalid after 1 day.")}),e.jsx(A,{mt:"md",children:e.jsx(w,{onClick:a,variant:"light",style:{marginLeft:"auto"},children:s("Close")})})]})},Hs=1,Gs=10,Ws=()=>{const{t}=C(),a=N(),{isLoggedIn:n,token:s,activeSubscriptions:i,currentSaveId:o,saves:l}=T(g=>g.account),{lastChangedAtTimeStamp:d}=T(g=>g.rmpSave),u=n&&l&&(i.RMP_CLOUD?l.length<Gs:l.length<Hs),h=Math.min(...(l??[]).map(g=>g.id)),m=g=>!i.RMP_CLOUD&&g!==h,[p,c]=K.useState(void 0),[S,b]=K.useState(void 0),[j,r]=K.useState(!1),[M,L]=K.useState(void 0),v=g=>a(R({title:t("Unable to sync your save"),message:g,type:"error",duration:9e3})),k=async()=>{const g=await ye(ee.RMP);if(!n||!g||!s){v(t("Failed to get the RMP save!"));return}const{data:E,hash:se}=g,ce=Bs();try{const Z=await O(I.SAVES,{method:"POST",body:JSON.stringify({index:ce,data:E,hash:se})},s);if(Z.status===401){v(t("Login status expired.")),a(z());return}if(Z.status!==200){v(await Z.text());return}a(q())}catch(Z){v(Z.message)}},$=async g=>{if(!(!n||!s)){if(g===o){if(c(o),!o||m(o)){v(t("Can not sync this save!")),c(void 0);return}const E=await a(q());if(E.meta.requestStatus!=="fulfilled"){v(t("Login status expired.")),c(void 0);return}const ce=E.payload.saves.filter(ht=>ht.id===o).at(0);if(!ce){v(t("Current save id is not in saveList!")),c(void 0);return}const Z=new Date(ce.lastUpdateAt);if(new Date(d)<Z){fe.warn(`Save id: ${o} is newer in the cloud via local compare.`),a(Qe()),c(void 0);return}const Ee=await ye(ee.RMP);if(!Ee){v(t("Failed to get the RMP save!")),c(void 0);return}const{data:dt,hash:ut}=Ee,ge=await O(I.SAVES+"/"+o,{method:"PATCH",body:JSON.stringify({data:dt,hash:ut})},s);if(ge.status===401){v(t("Login status expired.")),c(void 0),a(z());return}if(ge.status!==200){v(await ge.text()),c(void 0);return}c(void 0)}else{c(g);const E=await O(I.SAVES+"/"+g,{},s);if(E.status===401){v(t("Login status expired.")),c(void 0),a(z());return}if(E.status!==200){v(await E.text()),c(void 0);return}fe.info(`Set ${ee.RMP} with save id: ${g}`),Ze(ee.RMP,await E.text()),a(et(new Date().valueOf())),Xe(),c(void 0)}a(q())}},V=async g=>{if(!n||!g||!s)return;b(g);const E=await O(I.SAVES+"/"+o,{method:"DELETE"},s);if(E.status===401){v(t("Login status expired.")),b(void 0),a(z());return}if(E.status!==200){v(await E.text()),b(void 0);return}a(q()),b(void 0)},lt=async(g,E)=>{if(!n||!g||!s)return;const se=await O(`${I.SAVES}/${g}/metadata`,{method:"PATCH",body:JSON.stringify({index:E})},s);if(se.status===401){v(t("Login status expired.")),a(z());return}if(se.status!==200){v(await se.text());return}a(q())},ct=g=>{L(g),r(!0)};return e.jsxs(H,{children:[e.jsxs(G,{align:"center",children:[e.jsx(_,{order:3,size:"h5",flex:"1",children:t("Synced saves")}),e.jsx(w,{variant:"subtle",size:"xs",ml:"xs",disabled:!u,onClick:k,children:t(u?"Create":"Subscribe to sync more")})]}),e.jsx(oe,{direction:"column",gap:"xs",children:l?.map(g=>e.jsxs(X,{withBorder:!0,shadow:"sm",children:[e.jsxs(A,{children:[e.jsx(nt,{initialValue:g.index,onSave:E=>lt(g.id,E),textInputWidth:"177px"}),e.jsx(D,{disabled:m(g.id),loading:p===g.id,onClick:()=>$(g.id),title:g.id===o?t("Sync now"):t("Sync this slot"),children:g.id===o?e.jsx(Ct,{}):e.jsx(vt,{})}),e.jsx(D,{onClick:()=>ct(g.id),title:t("Share"),children:e.jsx(kt,{})}),e.jsx(D,{color:"red",loading:S===g.id,onClick:()=>V(g.id),title:t("Delete"),children:e.jsx(Mt,{})})]}),e.jsxs(A,{justify:"space-between",mt:"md",mb:"md",children:[e.jsxs(y,{children:[t("ID"),": ",g.id]}),e.jsxs(y,{children:[t("Status"),": ",g.id===o?t("Current save"):t("Cloud save")]})]}),e.jsxs(y,{children:[t("Last update at"),": ",new Date(g.lastUpdateAt).toLocaleString()]})]},g.id))}),e.jsx(Us,{opened:j,onClose:()=>r(!1),shareSaveInfo:l?.find(g=>g.id===M)})]})},Fs=t=>{const{t:a}=C(),{opened:n,onClose:s}=t,{isLoggedIn:i,token:o}=T(p=>p.account),l=N(),[d,u]=K.useState(""),h=p=>l(R({title:a("Unable to redeem"),message:p,type:"error",duration:9e3})),m=async p=>{if(!i)return;const c=await O(I.SUBSCRIPTION_REDEEM,{method:"POST",body:JSON.stringify({cdkey:p.trim()})},o);if(c.status===401){h(a("Login status expired.")),l(z());return}if(c.status!==202){const S=(await c.json()).message;h(a(S));return}l(as()),s()};return e.jsxs(W,{opened:n,onClose:s,title:a("Redeem your subscription"),size:"md",children:[e.jsx(y,{children:a("CDKeys could be obtained through the following ways:")}),e.jsxs(P,{withPadding:!0,mt:"xs",children:[e.jsx(P.Item,{children:e.jsxs(le,{href:"https://afdian.com/item/9c8b220c614311efab2d52540025c377",target:"_blank",children:["çˆ±å‘ç”µ ",e.jsx(te,{})]})}),e.jsx(P.Item,{children:e.jsxs(le,{href:"https://github.com/railmapgen/railmapgen.github.io/wiki/Earn-Subscriptions-Through-Community-Reviews",target:"_blank",children:[a("Community Reviews")," ",e.jsx(te,{})]})})]}),e.jsx(ue,{my:"md"}),e.jsxs(A,{align:"flex-end",gap:"sm",mt:"xs",mb:"md",children:[e.jsx(Y,{label:a("CDKey"),placeholder:a("Enter your CDKey here"),value:d,onChange:({currentTarget:{value:p}})=>u(p),style:{minWidth:240,flex:1}}),e.jsx(w,{onClick:()=>m(d),children:a("Redeem")})]})]})},$s=90,Js=$s*24*60*60*1e3,qs=()=>{const{t}=C(),{activeSubscriptions:a}=T(o=>o.account),[n,s]=K.useState(!1),i=!a.RMP_CLOUD&&!a.RMP_EXPORT;return e.jsxs(H,{children:[e.jsxs(G,{align:"center",children:[e.jsx(_,{order:3,size:"h5",children:t("All subscriptions")}),e.jsx(w,{variant:"subtle",size:"xs",ml:"auto",onClick:()=>s(!0),children:t("Redeem")})]}),e.jsxs(oe,{direction:"column",gap:"xs",children:[i&&e.jsxs(X,{withBorder:!0,shadow:"sm",children:[e.jsx(X.Section,{p:"xs",children:e.jsx(y,{fw:"bold",children:t("Rail Map Painter")})}),e.jsxs(B,{gap:"xs",children:[e.jsx(y,{children:t("With this subscription, the following features are unlocked:")}),e.jsxs(P,{withPadding:!0,children:[e.jsx(P.Item,{children:t("PRO features")}),e.jsx(P.Item,{children:t("Sync 9 more saves")}),e.jsx(P.Item,{children:t("Unlimited master nodes")}),e.jsx(P.Item,{children:t("Unlimited parallel lines")}),e.jsx(P.Item,{children:t("Random station names")}),e.jsx(P.Item,{children:t("Export super large images")}),e.jsx(P.Item,{children:t("Share saves with others")}),e.jsx(P.Item,{children:t("Sync 50 images")})]}),e.jsxs(y,{children:[t("Expires at:")," ",t("Not applicable")]})]})]}),Object.entries(a).filter(([o,l])=>l).map(([o,l])=>e.jsxs(X,{withBorder:!0,shadow:"sm",children:[e.jsx(X.Section,{p:"xs",children:e.jsx(y,{fw:"bold",children:t(o)})}),e.jsxs(B,{gap:"xs",children:[e.jsxs(y,{children:[t("Expires at:")," ",new Date(l).toLocaleString()]}),e.jsx(w,{color:"blue",onClick:()=>s(!0),children:t("Renew")}),new Date(l).getTime()-new Date().getTime()<Js&&e.jsx(F,{title:t("Renew now and get an extra 45 days!"),color:"yellow",icon:e.jsx(de,{})})]})]},o))]}),e.jsx(Fs,{opened:n,onClose:()=>s(!1)})]})},Ks=()=>{const{t}=C(),{isLoggedIn:a}=T(i=>i.account),[n,s]=x.useState("login");return e.jsxs(H,{children:[e.jsx(G,{children:e.jsx(_,{order:2,size:"h4",children:t("Account")})}),a?e.jsxs(oe,{className:Ts.body,children:[e.jsx(Is,{}),e.jsx(ue,{}),e.jsx(qs,{}),e.jsx(Ws,{})]}):n==="login"?e.jsx(zs,{setLoginState:s}):n==="register"?e.jsx(Ds,{setLoginState:s}):e.jsx(_s,{setLoginState:s})]})},Ys="_button_1hzui_1",Qs="_label_1hzui_11",ae={button:Ys,label:Qs,"sub-label":"_sub-label_1hzui_17"};function Zs(t){const{appId:a,onAboutOpen:n}=t,{t:s}=C(),i=N(),o=at(),{activeTab:l,openedTabs:d}=T(r=>r.app),u=Q[a],h=u.name.split(" - ").map(r=>s(r)).join(" - "),m=d.some(r=>r.app===a),p=!u.allowMultiInstances&&d.find(r=>r.id===l)?.app===a,c=r=>{m||f.event(U.OPEN_APP,{appId:a,isOpenInNew:r}),i(r?ns(a):be({appId:a})),o||(i(he()),f.toggleNavMenu(!1))},S=r=>{i(os(r)),o||(i(he()),f.toggleNavMenu(!1))},b=r=>{i(is(r)),f.event(U.CLOSE_APP,{app:a})},j=r=>{i(rs(r)),f.event(U.CLOSE_APP,{app:r})};return e.jsx(we,{component:"div",role:"button",variant:"filled",label:h,active:p,classNames:{root:ae.button,label:ae.label},leftSection:m?e.jsx(Rt,{title:s("Running")}):void 0,rightSection:e.jsxs(e.Fragment,{children:[u.allowMultiInstances&&e.jsx(D,{"aria-label":s("New tab"),title:s("New tab"),variant:"subtle",color:p?"white":"gray",mr:4,onClick:r=>{r.stopPropagation(),c(!0)},children:e.jsx(At,{})}),e.jsxs(ie,{children:[e.jsx(ie.Target,{children:e.jsx(D,{variant:"subtle",color:p?"white":"gray",onClick:r=>r.stopPropagation(),children:e.jsx(Lt,{})})}),e.jsxs(ie.Dropdown,{children:[m&&e.jsx(ie.Item,{leftSection:e.jsx(Se,{}),onClick:r=>{r.stopPropagation(),j(a)},children:u.allowMultiInstances?s("Close all tabs"):s("Close app")}),e.jsx(ie.Item,{leftSection:e.jsx(Et,{}),onClick:r=>{r.stopPropagation(),n()},children:s("About")})]})]})]}),disableRightSectionRotation:!0,opened:!0,onClick:()=>c(!1),children:u.allowMultiInstances&&d.filter(r=>r.app===a).map((r,M)=>{const L=r.id===l;return e.jsx(we,{component:"div",role:"button",variant:"filled",active:L,label:e.jsxs(e.Fragment,{children:[e.jsx(qe,{color:"lightgray",c:"black",mr:"xs",circle:!0,display:"inline-flex",children:M+1}),r.title??s("Tab")+" "+(M+1).toString()+" - "+h]}),classNames:{root:ae.button,label:ae["sub-label"]},rightSection:e.jsx(D,{variant:"subtle",color:L?"white":"gray","aria-label":s("Close tab"),title:s("Close tab"),onClick:v=>{v.stopPropagation(),b(r.id)},children:e.jsx(Se,{})}),onClick:()=>S(r.id)},r.id)})})}const Xs=async t=>{const a=`/${t}/info.json`;try{return(await(await fetch(a)).json()).version}catch(n){return fe.info(`Failed to get version of ${t}`,n),"unknown"}};function ea(t){const{appId:a,onClose:n}=t,{t:s}=C(),[i,o]=x.useState("Unknown"),l=a?Q[a]?.url?.split("/")?.[1]:void 0;return x.useEffect(()=>{l?Xs(l).then(d=>o(d)):o("Unknown")},[l]),e.jsx(W,{opened:!!a,onClose:n,size:"xl",title:e.jsxs(e.Fragment,{children:[s("About")+" "+(a?Q[a].name.split(" - ").map(d=>s(d)).join(" - "):""),e.jsx(qe,{color:"gray",radius:"sm",ml:"xs",children:i})]}),children:e.jsx(w,{component:"a",href:"https://github.com/railmapgen/"+l,target:"_blank",children:s("Visit GitHub")})})}function Ve({assetType:t}){const{t:a}=C(),[n,s]=x.useState(),i=st(t,f.getEnv(),f.getInstance());return e.jsxs(H,{children:[e.jsx(G,{children:e.jsx(_,{order:2,size:"h4",children:a(t==="devtool"?"Devtools":"Apps")})}),e.jsx(re,{direction:"column",children:i.map(o=>e.jsx(Zs,{appId:o,onAboutOpen:()=>s(o)},o))}),e.jsx(ea,{appId:n,onClose:()=>s(void 0)})]})}function ta(){const{t}=C(),a=st("link",f.getEnv(),f.getInstance()),n=s=>{f.event(U.OPEN_LINK,{id:s})};return e.jsxs(H,{children:[e.jsx(G,{children:e.jsx(_,{order:2,size:"h4",children:t("Useful links")})}),e.jsx(re,{direction:"column",children:a.map(s=>e.jsx(we,{variant:"filled",label:t(Q[s].name),classNames:{root:ae.button,label:ae.label},rightSection:e.jsx(te,{}),href:Q[s].url,target:"_blank",onClick:()=>n(s)},s))})]})}const sa="_root_zgz2q_5",aa="_wrapper_zgz2q_31",na="_alert_zgz2q_42",oa="_header_zgz2q_49",ia="_body_zgz2q_55",ra="_aside_zgz2q_62",la="_main_zgz2q_75",J={root:sa,"show-menu":"_show-menu_zgz2q_15",wrapper:aa,alert:na,header:oa,body:ia,aside:ra,main:la},Ue={"textarea-label":"_textarea-label_kau51_1","textarea-input":"_textarea-input_kau51_5"};function ca(t){const{opened:a,onClose:n}=t,{t:s}=C(),[i,o]=x.useState(),l=Object.entries(localStorage),d=()=>{i&&(window.localStorage.removeItem(i),window.location.reload())};return e.jsxs(W,{opened:a,onClose:n,size:"xl",title:s("Local Storage"),children:[e.jsx(B,{gap:"xs",children:l.map(u=>e.jsx(Tt,{label:e.jsxs(A,{align:"center",gap:"xs",children:[u[0],e.jsx(D,{variant:"default",size:"xs",title:s("Remove this item"),"aria-label":s("Remove this item"),onClick:()=>o(u[0]),children:e.jsx(Ot,{})})]}),value:u[1],readOnly:!0,rows:4,classNames:{label:Ue["textarea-label"],input:Ue["textarea-input"]}},u[0]))}),e.jsx(A,{pt:"xs",children:e.jsx(w,{ml:"auto",onClick:n,children:s("Go back")})}),i&&e.jsxs(W,{opened:!0,onClose:()=>o(void 0),centered:!0,title:s("Warning"),children:[e.jsxs(y,{children:[s("LocalStorageModal.text1"),e.jsx(It,{children:i}),s("LocalStorageModal.text2"),e.jsx(y,{span:!0,fw:500,children:s(Q[i.split("__")[0]]?.name??"Unknown app")}),s("LocalStorageModal.text3"),e.jsx("br",{}),s("LocalStorageModal.text4")]}),e.jsxs(A,{gap:"xs",mt:"xs",children:[e.jsx(w,{variant:"default",ml:"auto",onClick:()=>o(void 0),children:s("Back")}),e.jsx(w,{color:"red",onClick:d,children:s("Delete and reload")})]})]})]})}function rt(t){const{t:a}=C(),n=[{group:a("Main languages"),items:xs.map(s=>({value:s,label:me[s][s]}))},{group:a("Other languages"),items:ms.map(s=>({value:s,label:me[s][s]??me[s].en}))}];return e.jsx(Pt,{label:a("Language"),defaultValue:f.getLanguage(),onChange:({currentTarget:{value:s}})=>{const i=s;f.setLanguage(i),f.getI18nInstance().changeLanguage(i),f.event(U.CHANGE_LANGUAGE,{language:i})},data:n,...t})}function da(){const{t}=C(),{setColorScheme:a}=_t(),n=N(),{lastShowDevtools:s,refreshRequired:i}=T(c=>c.app),[o,l]=x.useState(f.isAllowAnalytics()),[d,u]=x.useState(!1),h=tt(s),m=c=>{l(c),f.allowAnalytics(c).refreshRequired&&n(ds())},p=[{value:"light",label:t("Light")},{value:"dark",label:t("Dark")},{value:"system",label:t("System")}];return e.jsxs(H,{children:[i&&e.jsx(F,{color:"blue",icon:e.jsx(Me,{}),mb:"xs",children:t("Refreshing is required for changes to take effect.")}),e.jsx(G,{children:e.jsx(_,{order:2,size:"h4",children:t("Settings")})}),e.jsxs(B,{gap:"xs",py:"xs",children:[e.jsx(rt,{}),e.jsx(Nt,{size:"sm",label:t("Appearance"),defaultValue:f.getColourMode(),onChange:c=>{a(c==="system"?"auto":c),f.setColourMode(c)},data:p}),e.jsx(Oe,{label:t("Allow cookies to help improve our website"),labelPosition:"left",checked:o,onChange:({currentTarget:{checked:c}})=>m(c),disabled:i,styles:{labelWrapper:{flex:1}}}),e.jsx(Oe,{label:t("Show dev tools for 1 day"),labelPosition:"left",checked:h,onChange:({currentTarget:{checked:c}})=>{c?(n(ls()),f.event(U.SHOW_DEVTOOLS)):n(cs())},styles:{labelWrapper:{flex:1}}}),h&&e.jsx(w,{variant:"default",leftSection:e.jsx(zt,{}),onClick:()=>u(!0),children:t("Export Local Storage")})]}),h&&e.jsx(ca,{opened:d,onClose:()=>u(!1)})]})}function ua(){const{t}=C(),{remoteFonts:a}=T(n=>n.app);return e.jsxs(H,{children:[e.jsx(G,{children:e.jsx(_,{order:2,size:"h4",children:t("Web fonts")})}),e.jsxs(B,{gap:"xs",children:[e.jsxs(y,{fs:"italic",children:[t("FontsSection.text1")," ",t("FontsSection.text2")," ",t("FontsSection.text3")," (",t("FontsSection.safari"),")"]}),Object.entries(a).map(([n,s])=>e.jsx(w,{variant:"default",rightSection:s.url?e.jsx(te,{}):void 0,disabled:!s.url,onClick:()=>{window.open(s.url,"_blank"),f.event(U.DOWNLOAD_FONT,{family:n})},children:s.displayName?`${s.displayName} (${n})`:n},n))]})]})}const ha="_bilibili_5ep1h_1",pa={bilibili:ha};function ga(t){return Ke({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 32C132.3 32 32 134.9 32 261.7c0 101.5 64.2 187.5 153.2 217.9a17.56 17.56 0 0 0 3.8.4c8.3 0 11.5-6.1 11.5-11.4 0-5.5-.2-19.9-.3-39.1a102.4 102.4 0 0 1-22.6 2.7c-43.1 0-52.9-33.5-52.9-33.5-10.2-26.5-24.9-33.6-24.9-33.6-19.5-13.7-.1-14.1 1.4-14.1h.1c22.5 2 34.3 23.8 34.3 23.8 11.2 19.6 26.2 25.1 39.6 25.1a63 63 0 0 0 25.6-6c2-14.8 7.8-24.9 14.2-30.7-49.7-5.8-102-25.5-102-113.5 0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8a18.64 18.64 0 0 1 5-.5c8.1 0 26.4 3.1 56.6 24.1a208.21 208.21 0 0 1 112.2 0c30.2-21 48.5-24.1 56.6-24.1a18.64 18.64 0 0 1 5 .5c12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6 0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5 0 30.7-.3 55.5-.3 63 0 5.4 3.1 11.5 11.4 11.5a19.35 19.35 0 0 0 4-.4C415.9 449.2 480 363.1 480 261.7 480 134.9 379.7 32 256 32z"},child:[]}]})(t)}function xa(t){return Ke({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M126.12 315.1A47.06 47.06 0 1 1 79.06 268h47.06zm23.72 0a47.06 47.06 0 0 1 94.12 0v117.84a47.06 47.06 0 1 1-94.12 0zm47.06-188.98A47.06 47.06 0 1 1 244 79.06v47.06zm0 23.72a47.06 47.06 0 0 1 0 94.12H79.06a47.06 47.06 0 0 1 0-94.12zm188.98 47.06a47.06 47.06 0 1 1 47.06 47.1h-47.06zm-23.72 0a47.06 47.06 0 0 1-94.12 0V79.06a47.06 47.06 0 1 1 94.12 0zM315.1 385.88a47.06 47.06 0 1 1-47.1 47.06v-47.06zm0-23.72a47.06 47.06 0 0 1 0-94.12h117.84a47.06 47.06 0 1 1 0 94.12z"},child:[]}]})(t)}function ma(){const{t}=C();return e.jsxs(H,{children:[e.jsx(G,{children:e.jsx(_,{order:2,size:"h4",children:t("Help & support")})}),e.jsxs(B,{gap:"xs",children:[e.jsx(w,{variant:"default",leftSection:e.jsx(ga,{}),rightSection:e.jsx(te,{}),onClick:()=>{window.open("https://github.com/railmapgen/railmapgen.github.io/issues","_blank"),f.event(U.RAISE_ISSUE)},children:t("Raise an Issue on GitHub")}),e.jsx(w,{variant:"default",leftSection:e.jsx(xa,{}),rightSection:e.jsx(te,{}),onClick:()=>{window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),f.event(U.JOIN_SLACK)},children:t("Join us on Slack")}),e.jsx(w,{variant:"default",leftSection:e.jsx(je,{className:pa.bilibili,src:"images/bilibili.svg"}),rightSection:e.jsx(te,{}),onClick:()=>{window.open("https://space.bilibili.com/10124055","_blank"),f.event(U.FOLLOW_BILIBILI)},children:t("Follow us on Bilibili")})]})]})}function ja(){const{t,i18n:{language:a}}=C(),{isShowMenu:n,menuView:s,lastShowDevtools:i}=T(b=>b.app),{isLoggedIn:o,name:l}=T(b=>b.account),d=N(),u=at(),[h]=Ye(),m=(f.getInstance()==="GitLab"?"https://railmapgen.gitlab.io/":"https://railmapgen.github.io/")+"?"+h.toString(),c=`https://railmapgen.org/rmt-blog/${{"zh-Hans":"zh-CN","zh-Hant":"zh-HK",ja:"ja-JP",ko:"ko-KR",en:"en-US"}[a]||"zh-CN"}/rmg-7th-newyear/`;x.useEffect(()=>{o&&d(q())},[o]);const S=[{key:"apps",label:t("Apps"),Icon:e.jsx(Dt,{size:22})},{key:"links",label:t("Useful links"),Icon:e.jsx(Bt,{size:22})},{key:"devtools",label:t("Devtools"),Icon:e.jsx(Vt,{size:22}),ActionIconProps:{style:{display:tt(i)?"inline-flex":"none"}}},{key:"account",label:t("Account"),Icon:e.jsx(Fe,{variant:"light",name:o?l:void 0,size:"sm",color:"initials"}),ActionIconProps:{mt:"auto"}},{key:"contributors",label:t("Contributors"),Icon:e.jsx(Ut,{size:22}),ActionIconProps:{onClick:()=>{d(us("contributors")),u||(d(he()),f.toggleNavMenu(!1))}}},{key:"support",label:t("Help & support"),Icon:e.jsx(Ht,{size:22})},{key:"settings",label:t("Settings"),Icon:e.jsx(Gt,{size:22})}];return e.jsx("nav",{className:ve(J.root,n&&J["show-menu"]),children:e.jsxs("div",{className:J.wrapper,children:[e.jsxs(Wt,{className:J.header,children:[e.jsx(_,{children:t("Rail Map Toolkit")}),e.jsx(Ft,{env:f.getEnv(),ver:f.getAppVersion()})]}),e.jsx(ue,{}),f.getEnv()!=="PRD"&&e.jsxs(F,{color:"yellow",icon:e.jsx(de,{}),className:J.alert,children:[t("You're currently viewing a testing environment.")," ",e.jsx(le,{size:"sm",href:m,target:"_blank",children:t("Back to production environment")})]}),e.jsxs(F,{color:"red",icon:"ðŸŽ‡",className:J.alert,children:[t("happyChineseNewYear")," ",e.jsx(le,{size:"sm",href:c,target:"_blank",children:t("happyChineseNewYearClickHere")})]}),e.jsxs("div",{className:J.body,children:[e.jsx("div",{className:J.aside,children:S.map(({key:b,label:j,Icon:r,ActionIconProps:M})=>e.jsx(Je,{label:j,position:"right",withArrow:!0,children:e.jsx(D,{variant:s===b?"light":"subtle",color:s===b?void 0:"gray",size:"lg",onClick:()=>d(hs(b)),...M,children:r})},b))}),e.jsx(ue,{orientation:"vertical"}),e.jsxs("div",{className:J.main,children:[s==="apps"?e.jsx(Ve,{assetType:"app"}):s==="links"?e.jsx(ta,{}):s==="devtools"?e.jsx(Ve,{assetType:"devtool"}):s==="settings"?e.jsx(da,{}):s==="support"?e.jsxs(e.Fragment,{children:[e.jsx(ma,{}),e.jsx(ua,{})]}):s==="account"?e.jsx(Ks,{}):e.jsx(e.Fragment,{}),e.jsx(Es,{})]})]})]})})}function Sa(t){const{opened:a,onClose:n}=t,{t:s}=C(),i=()=>{f.allowAnalytics(!0),n()},o=()=>{f.allowAnalytics(!1).refreshRequired?window.location.reload():n()};return e.jsxs(W,{opened:a,onClose:()=>{},title:s("CookiesModal.header"),withCloseButton:!1,closeOnEscape:!1,closeOnClickOutside:!1,centered:!0,children:[e.jsx(A,{children:e.jsx(rt,{ml:"auto"})}),e.jsxs(B,{gap:"xs",py:"xs",children:[e.jsx(y,{children:s("CookiesModal.text1")}),e.jsx(y,{mt:2,children:s("CookiesModal.text2")}),e.jsx(P,{withPadding:!0,children:e.jsxs(P.Item,{children:[" ",s("CookiesModal.item1")]})}),e.jsx(y,{mt:2,children:s("CookiesModal.text3")})]}),e.jsxs(A,{gap:"sm",children:[e.jsx(w,{variant:"default",ml:"auto",onClick:o,children:s("CookiesModal.reject")}),e.jsx(w,{onClick:i,children:s("CookiesModal.accept")})]})]})}const fa=()=>{};function wa(){const{t}=C(),[a,n]=x.useState(!1),s=()=>{n(!0),ps(),setTimeout(()=>{window.location.reload()},1e3)};return e.jsxs(W,{opened:!0,onClose:fa,title:t("Rail Map Toolkit is opened in another window"),withCloseButton:!1,closeOnEscape:!1,closeOnClickOutside:!1,centered:!0,children:[e.jsx(y,{children:t("You cannot open multiple Rail Map Toolkit at the same time. Please close this window.")}),e.jsx(A,{mt:"xs",children:e.jsx(w,{variant:"default",onClick:s,loading:a,disabled:a,children:t("Restart RMT in this window")})})]})}const ba=()=>{};function ya(){const{t}=C();return e.jsx(W,{opened:!0,onClose:ba,title:t("Rail Map Toolkit is opened in another window"),withCloseButton:!1,closeOnEscape:!1,closeOnClickOutside:!1,centered:!0,children:e.jsx(y,{children:t("Current session has been terminated. Please close this window.")})})}const Ca="_root_1vn0k_1",va={root:Ca},ka={info:void 0,success:"green",warning:"yellow",error:"red"},He=200,Ge=400;function Ma({notification:t}){const a=N(),[n,s]=x.useState(!1);return x.useEffect(()=>{setTimeout(()=>{s(!0)},He);const i=setTimeout(()=>{s(!1),setTimeout(()=>{a(gs(t.id))},Ge)},He+t.duration);return()=>{clearTimeout(i)}},[]),e.jsx($t,{mounted:n,transition:"slide-left",duration:Ge,timingFunction:"ease",children:i=>e.jsx(Jt,{color:ka[t.type],title:t.title,onClose:()=>s(!1),withBorder:!0,style:i,children:t.message})})}function Aa(){const{notifications:t}=T(a=>a.notification);return e.jsx(qt,{children:e.jsx(B,{className:va.root,children:t.map(a=>e.jsx(Ma,{notification:a},a.id))})})}function Pa(){const{t}=C(),a=N(),{isPrimary:n,isTerminated:s,isShowMenu:i}=T(u=>u.app),[o,l]=x.useState(!1);x.useEffect(()=>{f.isAnalyticsQADone()||l(!0)},[]);const d=()=>{f.toggleNavMenu(!i),a(he()),f.event(U.TOGGLE_NAV_MENU)};return e.jsx(Zt,{basename:"/",children:e.jsxs(Kt,{className:ve(Ie.root,i&&"show-menu"),children:[e.jsx(D,{className:Ie.burger,variant:i?"subtle":"filled",color:i?"gray":void 0,"aria-label":t("Toggle menu"),title:t("Toggle menu"),onClick:d,children:e.jsx(Yt,{})}),e.jsxs(Qt,{direction:"row",children:[e.jsx(ja,{}),e.jsx(Ms,{alwaysShowWelcome:s||n===!1})]}),e.jsx(Aa,{}),s&&e.jsx(ya,{}),n===!1&&e.jsx(wa,{}),e.jsx(Sa,{opened:o,onClose:()=>l(!1)})]})})}export{Pa as default};

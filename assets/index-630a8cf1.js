import{r as p,i as _,d as x,R as i,a as D,c as L,b as N,e as $,u as G,f as U,g as j,h as C,j as V,k as m,P as H,I as B,l as W,m as F,n as q}from"./vendor-777a2cc7.js";function Ke(){import.meta.url,import("_").catch(()=>1);async function*e(){}}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function o(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(a){if(a.ep)return;a.ep=!0;const s=o(a);fetch(a.href,s)}})();const z="modulepreload",J=function(e){return"/"+e},R={},Y=function(t,o,n){if(!o||o.length===0)return t();const a=document.getElementsByTagName("link");return Promise.all(o.map(s=>{if(s=J(s),s in R)return;R[s]=!0;const r=s.endsWith(".css"),u=r?'[rel="stylesheet"]':"";if(!!n)for(let b=a.length-1;b>=0;b--){const T=a[b];if(T.href===s&&(!r||T.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${u}`))return;const c=document.createElement("link");if(c.rel=r?"stylesheet":z,r||(c.as="script",c.crossOrigin=""),c.href=s,document.head.appendChild(c),r)return new Promise((b,T)=>{c.addEventListener("load",b),c.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>t())};const X={header:"Cookies on this website",text1:"At RMG we use cookies to help ensure that our website and services are able to function properly. These cookies are necessary and so are set automatically.",text2:"We would also like to use some cookies to:",item1:"improve our website based on how you use it",text3:"These cookies are optional. If you'd like to accept all optional cookies, select 'Accept all cookies'. If you'd like to reject them, select 'Reject'.",accept:"Accept all cookies",reject:"Reject"},K={CookiesModal:X},Q={header:"本网站的 Cookies",text1:"在 RMG，我们使用 Cookies 来确保本网站及服务可以正常运作。这些 Cookies 是必需的，因此已默认启动。",text2:"我们也会以 Cookies 的方式：",item1:"分析您的使用模式，用来改进本网站",text3:"这些 Cookies 是可选的。如果您想允许所有可选 Cookies，请选择“接受所有 Cookies”。如果您想禁用 Cookies，请选择“拒绝”。",accept:"接受所有 Cookies",reject:"拒绝"},Z="关于",ee="外观",te="贡献者",oe="深色",ae="浅色",se="更多",ne="隐私",ie="正在运行",re="保存",ce="切换",le="跟随系统",pe="标签页",de={CookiesModal:Q,About:Z,"Allow cookies to help improve our website":"允许用 Cookies 帮助改进本网站",Appearance:ee,"Close all tabs":"关闭所有标签页","Close app":"关闭应用程式","Close current tab":"关闭当前标签页","Close tab":"关闭标签页","Contribution Wiki":"贡献者指南",Contributors:te,"Core contributors":"核心贡献者",Dark:oe,Light:ae,More:se,"New tab":"新标签页",Privacy:ne,"Privacy settings":"隐私设置","Rail Map Toolkit is opened in another window":"线路图工具包已在另一窗口中打开","Refreshing is required for changes to take effect.":"刷新页面后变更才会生效","Resource contributors":"资源贡献者","Resource Administrator":"资源管理员",Running:ie,Save:re,"Select an app to start your own rail map design!":"选择一个应用程序来开始你的线路图设计！",Switch:ce,"Switch to":"切换至",System:le,Tab:pe,"Terms and conditions":"条款与细则","Visit GitHub":"访问 GitHub","Welcome to Rail Map Toolkit":"欢迎使用线路图工具包","You cannot open multiple Rail Map Toolkit at the same time. Please close this window.":"您不能同时打开多个线路图工具包。请关闭当前窗口。"},ue={header:"本網站的 Cookies",text1:"在 RMG，我們使用 Cookies 以確保本網站及服務可以正常運作。這些 Cookies 是必需的，因此已預設啟用。",text2:"我們亦會以 Cookies 的方式：",item1:"分析閣下的使用模式，用來改進本網站",text3:"這些 Cookies 是可選的。如果閣下想容許所有可選 Cookies，請選擇「接受所有 Cookies」。如果閣下想禁用 Cookies，請選擇「拒絕」。",accept:"接受所有 Cookies",reject:"拒絕"},me="關於",be="外觀",he="貢獻者",ge="深色",fe="淺色",Te="更多",Ae="私隱",we="運行中",Re="儲存",ve="切換",ye="跟隨系統",ke="分頁",Se={CookiesModal:ue,About:me,"Allow cookies to help improve our website":"容許以 Cookies 幫助改進本網站",Appearance:be,"Close all tabs":"關閉所有分頁","Close app":"關閉應用程式","Close current tab":"關閉當前分頁","Close tab":"關閉分頁","Contribution Wiki":"貢獻者指南",Contributors:he,"Core contributors":"主要貢獻者",Dark:ge,Light:fe,More:Te,"New tab":"新分頁",Privacy:Ae,"Privacy settings":"私隱設定","Rail Map Toolkit is opened in another window":"路綫圖工具組已於另一視窗中開啟","Refreshing is required for changes to take effect.":"重新整理頁面後變更才會生效","Resource contributors":"資源貢獻者","Resource Administrator":"資源管理員",Running:we,Save:Re,"Select an app to start your own rail map design!":"選擇一個應用程式以開始你的路綫圖設計！",Switch:ve,"Switch to":"切換至",System:ye,Tab:ke,"Terms and conditions":"條款及細則","Visit GitHub":"造訪 GitHub","Welcome to Rail Map Toolkit":"歡迎使用路綫圖工具組","You cannot open multiple Rail Map Toolkit at the same time. Please close this window.":"你不能同時開啟多個路綫圖工具組。請關閉當前視窗。"},Ce={header:"이 웹 사이트의 쿠키",text1:"RMG에서는 쿠키를 사용하여 웹 사이트 및 서비스가 제대로 작동하는지 확인합니다.이러한 쿠키는 필수이므로 기본적으로 시작됩니다.",text2:"저희도 쿠키 방식으로：",item1:"당신의 사용 패턴을 분석하여, 본 사이트를 개선합니다",text3:"이 쿠키들은 선택 사항입니다.모든 선택 가능한 쿠키를 허용하려면 '모든 쿠키 허용'을 선택하십시오.쿠키를 사용하지 않으려면 '거부'를 선택하십시오.",accept:"모든 쿠키 허용",reject:"거부"},Pe="관한",Ee="화면 스타일",Me="기여자",Ie="다크 모드",Oe="라이트 모드",_e="저장",xe="시스템 모드",De={CookiesModal:Ce,About:Pe,"Allow cookies to help improve our website":"쿠키를 사용하여 이 웹 사이트를 개선할 수 있도록 허용",Appearance:Ee,"Contribution Wiki":"기여자 안내",Contributors:Me,"Core contributors":"핵심 기여자",Dark:Ie,Light:Oe,"Privacy settings":"개인 정보 보호 설정","Refreshing is required for changes to take effect.":"페이지를 새로 고친 후에만 변경 가능","Resource contributors":"자원 기여자","Resource Administrator":"자원 관리자",Save:_e,"Select an app to start your own rail map design!":"응용 프로그램을 선택하여 노선도 설계를 시작하십시오.","Switch to":"곳으로 전환",System:xe,"Terms and conditions":"조항과 세칙","Visit GitHub":"GitHub 방문하기","Welcome to Rail Map Toolkit":"노선도 툴킷에 오신 것을 환영합니다"},Le=new p.I18nBuilder().use(_).withAppName("Rail Map Toolkit").withLng(p.getLanguage()).withDefaultResource(x).withResource("en",K).withResource("zh-Hans",de).withResource("zh-Hant",Se).withResource("ko",De).build(),h={rmg:{name:"Rail Map Generator",url:"/rmg/",allowedEnvs:[i.DEV,i.UAT,i.PRD],allowMultiInstances:!0},rmp:{name:"Rail Map Painter",url:"/rmp/",allowedEnvs:[i.DEV,i.UAT,i.PRD]},"rmg-palette":{name:"Palette",url:"/rmg-palette/",allowedEnvs:[i.DEV,i.UAT,i.PRD]},"rmg-palette-upload":{name:"Palette - Upload",url:"/rmg-palette/new",allowedEnvs:[i.DEV,i.UAT,i.PRD]},"rmg-components":{name:"Components",url:"/rmg-components/",allowedEnvs:[i.DEV,i.UAT]},"rmg-templates":{name:"RMG Templates",url:"/rmg-templates/",allowedEnvs:[i.DEV,i.UAT,i.PRD]},"rmg-templates-upload":{name:"RMG Templates - Upload",url:"/rmg-templates/new",allowedEnvs:[i.DEV,i.UAT,i.PRD]},"rmp-gallery":{name:"RMP Gallery",url:"/rmp-gallery/",allowedEnvs:[i.DEV,i.UAT,i.PRD]},"seed-project":{name:"Seed Project",url:"/seed-project/",allowedEnvs:[i.DEV,i.UAT]},"rmg-translate":{name:"Translate",url:"/rmg-translate/",allowedEnvs:[i.DEV,i.UAT]}},A=e=>Object.entries(h).filter(([t,o])=>o.allowedEnvs.includes(e)).map(([t])=>t);var f=(e=>(e.OPENED_TABS="rmg-home__openedTabs",e.ACTIVE_TAB="rmg-home__activeTab",e))(f||{});const Ze={GitHub:"GitHub Pages",GitLab:"GitLab Pages",Bitbucket:"Bitbucket Cloud",localhost:"localhost",unknown:"unknown"},et=(e,t)=>`https://${t===i.PRD?"":"uat-"}railmapgen.${e===D.GITLAB?"gitlab":"github"}.io`;var P=(e=>(e.APP_LOAD="APP_LOAD",e.OPEN_APP="OPEN_APP",e.CLOSE_APP="CLOSE_APP",e.TOGGLE_NAV_MENU="TOGGLE_NAV_MENU",e.CHANGE_LANGUAGE="CHANGE_LANGUAGE",e.SWITCH_MIRROR="SWITCH_MIRROR",e))(P||{});const Ne="rmg-home:frame-",$e={isPrimary:void 0,isShowMenu:!0,openedTabs:[],activeTab:void 0},E=L({name:"app",initialState:$e,reducers:{setIsPrimary:(e,t)=>{e.isPrimary=t.payload},toggleMenu:e=>{e.isShowMenu=!e.isShowMenu},setOpenedTabs:(e,t)=>{e.openedTabs=t.payload},updateTabUrl:(e,t)=>{const{id:o,url:n}=t.payload;e.openedTabs=e.openedTabs.map(a=>a.id===o?{...a,url:n}:a)},setActiveTab:(e,t)=>{e.activeTab=t.payload},openApp:(e,t)=>{const{appId:o,url:n}=t.payload,a=e.openedTabs.find(({id:r})=>r===e.activeTab),s=e.openedTabs.find(({app:r})=>r===o);if((a==null?void 0:a.app)!==o)if(s)e.activeTab=s.id;else{const r=crypto.randomUUID();e.openedTabs.push({id:r,app:o,url:n!=null?n:h[o].url}),e.activeTab=r}},openAppInNew:(e,t)=>{const o=crypto.randomUUID();e.openedTabs.push({id:o,app:t.payload}),e.activeTab=o},closeTab:(e,t)=>{var a;const o=t.payload,n=e.openedTabs.slice().sort((s,r)=>{const u=Object.keys(h);return u.indexOf(s.app)-u.indexOf(r.app)});if(e.openedTabs=e.openedTabs.filter(s=>s.id!==o),e.activeTab===o){const s=n.findIndex(r=>r.id===o);e.activeTab=(a=n.filter(r=>r.id!==o)[Math.max(0,s-1)])==null?void 0:a.id}},closeApp:(e,t)=>{var r,u;const o=t.payload;if(!e.openedTabs.some(l=>l.app===o))return;const n=Object.keys(h).filter(l=>e.openedTabs.some(c=>c.app===l)),a=(r=e.openedTabs.find(l=>l.id===e.activeTab))==null?void 0:r.app,s=e.openedTabs.filter(l=>l.app!==o);if(e.openedTabs=s,a===o){const l=n.findIndex(c=>c===o);e.activeTab=(u=s.find(c=>c.app===n[Math.max(0,l-1)]))==null?void 0:u.id}}}}),{setIsPrimary:Ge,toggleMenu:tt,setOpenedTabs:v,updateTabUrl:Ue,setActiveTab:y,openApp:w,openAppInNew:ot,closeTab:at,closeApp:je}=E.actions,Ve=E.reducer,M=N(),d=$({reducer:{app:Ve},middleware:e=>e().prepend(M.middleware)}),st=()=>G(),nt=U,k=M.startListening;window.rmgStore=d;const He="rmt-instance-checker",I="ping",O="pong",g=new BroadcastChannel(He);g.addEventListener("message",e=>{e.data===I&&(console.log("[rmt] Received ping from another RMT instance."),g.postMessage(O))});const Be=async()=>{let e=!0;g.addEventListener("message",o=>{o.data===O&&(console.warn("[rmt] Received pong from another RMT instance. This instance is not primary."),e=!1,g.close())}),g.postMessage(I);let t=5;for(;t--;)if(await We(500),!e)return!1;return console.log("[rmt] This instance is primary."),!0},We=e=>new Promise(t=>{setTimeout(t,e,`Timeout after ${e/1e3} seconds`)}),Fe=e=>{try{const t=window.localStorage.getItem(f.OPENED_TABS),o=window.localStorage.getItem("rmg-home__openedApps");if(t){const n=JSON.parse(t);if(Array.isArray(n)){const a=n.filter(s=>s.app in h);e.dispatch(v(a))}else console.warn("initOpenedTabs():: Cannot parse invalid opened tabs state from local storage")}else if(o){const n=JSON.parse(o);if(Array.isArray(n)&&typeof n[0]=="string"){const a=n.map(s=>({id:crypto.randomUUID(),app:s}));e.dispatch(v(a))}else console.warn("initOpenedTabs():: cannot parse invalid opened apps state from local storage")}}catch(t){console.warn("initOpenedTabs():: cannot parse opened apps state from local storage",t)}},qe=e=>{var n;const t=window.localStorage.getItem(f.ACTIVE_TAB),o=e.getState().app.openedTabs;t&&o.some(({id:a})=>a===t)?e.dispatch(y(t)):e.dispatch(y((n=o[0])==null?void 0:n.id))},ze=e=>{const o=new URLSearchParams(window.location.search).get("app");console.log(`openSearchedApp():: searchParams app=${o}`),A(p.getEnv()).includes(o)?e.dispatch(w({appId:o})):console.warn(`openSearchedApp():: app ${o} not found`)};function Je(e){Fe(e),qe(e),k({predicate:(t,o,n)=>JSON.stringify(o.app.openedTabs)!==JSON.stringify(n.app.openedTabs),effect:(t,o)=>{window.localStorage.setItem(f.OPENED_TABS,JSON.stringify(o.getState().app.openedTabs))}}),k({predicate:(t,o,n)=>o.app.activeTab!==n.app.activeTab,effect:(t,o)=>{const n=o.getState().app.activeTab;n!==void 0&&window.localStorage.setItem(f.ACTIVE_TAB,n)}}),ze(e),Be().then(t=>{e.dispatch(Ge(t)),t||e.dispatch(j())})}let S;const Ye=C.lazy(()=>Y(()=>import("./app-root-d2917e1a.js"),["assets/app-root-d2917e1a.js","assets/vendor-777a2cc7.js"])),Xe=()=>{S=V(document.getElementById("root")),S.render(m.jsx(C.StrictMode,{children:m.jsx(H,{store:d,children:m.jsx(B,{i18n:Le,children:m.jsx(W,{children:m.jsx(F,{suspenseFallback:m.jsx(q,{isIndeterminate:!0}),allowReset:!0,children:m.jsx(Ye,{})})})})})}))};p.ready().then(()=>{Je(d),Xe(),p.onAppOpen(e=>{const t=A(p.getEnv());typeof e=="object"?t.includes(e.appId)&&d.dispatch(w({appId:e.appId,url:e.url})):t.includes(e)&&d.dispatch(w({appId:e}))}),p.onAppClose(e=>{A(p.getEnv()).includes(e)&&d.dispatch(je(e))}),p.onUrlUpdate((e,t)=>{if(t){const o=t.slice(Ne.length);console.log(`Received URL update for frame=${o}, url=${e}`),d.dispatch(Ue({id:o,url:e}))}}),p.event(P.APP_LOAD,{openedApps:d.getState().app.openedTabs.map(e=>e.app)})});export{P as E,Ne as F,Ke as __vite_legacy_guard,st as a,h as b,w as c,at as d,je as e,et as f,A as g,Ze as m,ot as o,y as s,tt as t,nt as u};

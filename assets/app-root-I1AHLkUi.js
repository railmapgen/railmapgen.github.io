import{j as e,S as O,G as D,I as ue,T as R,e as C,n as Ee,o as F,C as J,F as K,p as es,B as w,q as ss,P as re,s as Te,t as ts,u as Pe,v as he,w as ns,A as Ne,x as V,y as as,z as os,D as is,E as Y,b as T,c as P,d as te,g as ee,H as De,J as we,K as Se,l as pe,O as U,Q as Z,U as xe,V as ls,W as ge,X as ze,Y as rs,Z as ne,_ as cs,$ as ds,a0 as us,r as f,a1 as hs,a2 as ps,a3 as xs,N as gs,a4 as ms,a5 as js,a6 as ye,a7 as fs,a8 as Ue,a9 as ws,aa as Ss,ab as bs,ac as vs,ad as Cs,ae as ys,k as ks,af as Ms,M as As,ag as Rs,ah as Ls,ai as Os,aj as _s,i as Is,ak as Es,m as Ts}from"./mantine-B5EjhH7N.js";import{k as S,r as j,o as Ve,R as B,B as Ps}from"./react-UC3gAxe5.js";import{u as L,o as me,F as Ns,a as M,b as Ds,S as q,l as N,s as Be,f as Q,g as je,c as Fe,n as We,d as $e,e as zs,h as _,A as I,i as Us,j as z,k as be,m as Vs,p as Bs,E,q as Fs,t as oe,r as Ws,v as $s,w as Gs,x as Ge,y as Hs,z as Js,B as qs,C as Ks,D as Ys,G as Qs,H as Xs}from"./main-CT4vB9Vs.js";import{a as se,b as He,S as Zs,O as et,L as ce}from"./asset-enablements-C5a48byM.js";import"./index-C_hgTfa4.js";const st="_burger_1y0se_1",tt={burger:st},nt="_workspace_1nep4_1",at="_show_1nep4_13",ot="_welcome_1nep4_23",it="_icons_1nep4_38",ae={workspace:nt,"app-container":"_app-container_1nep4_8",show:at,welcome:ot,icons:it},lt="/assets/rmp-logo512-eHekupnf.png";function rt(){const{t:s}=S(),t=L();return e.jsxs(O,{className:ae.welcome,children:[e.jsxs(D,{className:ae.icons,grow:!0,children:[e.jsx(ue,{src:"/logo512.png",title:s("Open")+" "+s("Rail Map Generator"),onClick:()=>t(me({appId:"rmg"}))}),e.jsx(ue,{src:lt,title:s("Open")+" "+s("Rail Map Painter"),onClick:()=>t(me({appId:"rmp"}))})]}),e.jsx(R,{children:s("Welcome to Rail Map Toolkit")}),e.jsx(C,{children:s("Select an app to start your own rail map design!")})]})}function ct(s){const{tab:t,isActive:a}=s,n=j.useMemo(()=>t.url??"/"+t.app+"/",[t.app]);return e.jsx("div",{className:Ee(ae["app-container"],a&&ae.show),children:e.jsx("iframe",{id:Ns+t.id,src:n,loading:"lazy",title:t.app,"data-persisted-url":t.url,"data-testid":"app-container-iframe"})})}function dt({alwaysShowWelcome:s}){const{openedTabs:t,activeTab:a}=M(o=>o.app),[,n]=Ve();return j.useEffect(()=>{var o;if(a){const l=(o=t.find(r=>r.id===a))==null?void 0:o.app;n(l?{app:l}:{})}else n({})},[a]),e.jsx("div",{className:ae.workspace,children:s||t.length===0?e.jsx(rt,{}):t.map(o=>e.jsx(ct,{tab:o,isActive:a===o.id},o.id))})}const ut="_root_mj6g1_5",ht="_wrapper_mj6g1_31",pt="_alert_mj6g1_42",xt="_header_mj6g1_49",gt="_body_mj6g1_55",mt="_aside_mj6g1_62",jt="_main_mj6g1_75",G={root:ut,"show-menu":"_show-menu_mj6g1_15",wrapper:ht,alert:pt,header:xt,body:gt,aside:mt,main:jt},ft="_card_15zs0_1",ke={card:ft},Me=(s,t,a)=>{const n=new Blob([a],{type:t});wt(s,n)},wt=(s,t)=>{const a=window.URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download=s,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(a)},St=()=>{const{t:s}=S(),{token:t,refreshToken:a,currentSaveId:n}=M(k=>k.account),{resolveConflictModal:{isOpen:o,lastChangedAtTimeStamp:l,lastUpdatedAtTimeStamp:r,cloudData:d}}=M(k=>k.rmpSave),c=L(),[h,u]=B.useState(!1),p=()=>c(zs()),i=()=>{Fe(q.RMP,d),We(),c($e(r)),p()},b=()=>{Me(`RMP_${r}.json`,"application/json",d)},y=async()=>{if(!n||!t||!a)return;u(!0);const k=await Ds(n,t,a,q.RMP);if(!k){c(N()),u(!1);return}if(k.status===409){c(Be()),u(!1);return}k.status===200&&(c(Q()),u(!1),p())},v=async()=>{const{data:k}=await je(q.RMP);Me(`RMP_${l}.json`,"application/json",k)};return e.jsxs(F,{opened:o,onClose:()=>{},size:"lg",title:s("Oops! It seems there's a conflict"),withCloseButton:!1,closeOnClickOutside:!1,closeOnEscape:!1,centered:!0,children:[e.jsx(C,{children:s("The local save is newer than the cloud one. Which one would you like to keep?")}),e.jsxs(D,{my:"xs",children:[e.jsx(J,{withBorder:!0,className:ke.card,children:e.jsxs(O,{children:[e.jsxs(K,{children:[e.jsx(es,{}),e.jsx(C,{span:!0,children:s("Local save")})]}),e.jsxs(C,{span:!0,children:[s("Update at:")," ",new Date(l).toLocaleString()]}),e.jsx(w,{color:"red",loading:h,onClick:()=>y(),children:s("Replace cloud with local")}),e.jsx(w,{onClick:()=>v(),children:s("Download Local save")})]})}),e.jsx(J,{withBorder:!0,className:ke.card,children:e.jsxs(O,{children:[e.jsxs(K,{children:[e.jsx(ss,{}),e.jsx(C,{span:!0,children:s("Cloud save")})]}),e.jsxs(C,{span:!0,children:[s("Update at:")," ",new Date(r).toLocaleString()]}),e.jsx(w,{color:"red",onClick:()=>i(),children:s("Replace local with cloud")}),e.jsx(w,{onClick:()=>b(),children:s("Download Cloud save")})]})})]})]})},bt="_body_yczk0_1",vt={body:bt};function Ae({meets:s,label:t}){return e.jsxs(C,{c:s?"teal":"red",style:{display:"flex",alignItems:"center"},mt:7,size:"sm",children:[s?e.jsx(Pe,{size:14}):e.jsx(he,{size:14}),e.jsx(ns,{ml:10,children:t})]})}const fe=[{re:/[0-9]/,label:"Includes number"},{re:/[a-zA-Z]/,label:"Includes letter"}];function Ct(s){let t=s.length>=8?0:1;return fe.forEach(a=>{a.re.test(s)||(t+=1)}),Math.max(100-100/(fe.length+1)*t,10)}function ve({value:s,onChange:t}){const{t:a}=S(),[n,o]=j.useState(!1),l=fe.map((c,h)=>e.jsx(Ae,{label:c.label,meets:c.re.test(s)},h)),r=Ct(s),d=r===100?"teal":r>50?"yellow":"red";return e.jsxs(re,{opened:n,position:"bottom",width:"target",transitionProps:{transition:"pop"},children:[e.jsx(re.Target,{children:e.jsx("div",{onFocusCapture:()=>o(!0),onBlurCapture:()=>o(!1),children:e.jsx(Te,{label:a("Password"),value:s,onChange:c=>t(c.currentTarget.value)})})}),e.jsxs(re.Dropdown,{children:[e.jsx(ts,{color:d,value:r,size:5,mb:"xs"}),e.jsx(Ae,{label:a("Includes at least 8 characters"),meets:s.length>=8}),l]})]})}const yt=()=>{const{t:s}=S(),t=L(),{isLoggedIn:a,email:n,name:o,refreshToken:l}=M(h=>h.account),[r,d]=B.useState(void 0),c=async()=>{a&&(await _(I.AUTH_LOGOUT,{method:"POST",body:JSON.stringify({refreshToken:l})}),t(N()))};return e.jsxs(e.Fragment,{children:[e.jsxs(K,{py:"xs",align:"center",wrap:"wrap",children:[e.jsx(Ne,{size:"lg",name:o,color:"initials"}),e.jsxs(K,{direction:"column",ml:"xs",flex:1,children:[e.jsx(C,{span:!0,fw:"bold",children:o}),e.jsx(C,{span:!0,size:"sm",children:n})]}),e.jsxs(K,{ml:"auto",children:[e.jsx(V,{variant:"subtle",color:"gray",size:"sm",onClick:()=>d("name"),"aria-label":s("Change name"),title:s("Change name"),children:e.jsx(as,{})}),e.jsx(V,{variant:"subtle",color:"gray",size:"sm",onClick:()=>d("password"),"aria-label":s("Change password"),title:s("Change password"),children:e.jsx(os,{})}),e.jsx(V,{variant:"subtle",color:"gray",size:"sm",onClick:c,"aria-label":s("Log out"),title:s("Log out"),children:e.jsx(is,{})})]})]}),e.jsx(kt,{infoType:r,onClose:()=>d(void 0)})]})};function kt(s){const{infoType:t,onClose:a}=s,{t:n}=S(),o=L(),{isLoggedIn:l,id:r,token:d}=M(i=>i.account),[c,h]=B.useState(""),u=i=>o(z({title:n("Unable to update account info"),message:i,type:"error",duration:9e3})),p=async()=>{if(!(!l||!t))try{const i=await _(I.USER+"/"+r,{method:"PATCH",body:JSON.stringify({[t]:c})},d);if(i.status===401){u(n("Login status expired")),o(N());return}if(i.status!==200){u(await i.text());return}if(t==="password"){o(N()),a();return}if(t==="name"){o(Us(c)),a();return}}catch(i){u(i.message)}};return e.jsxs(F,{opened:!!t,onClose:a,title:n("Update account info"),closeOnEscape:!1,children:[t==="name"&&e.jsx(Y,{label:n("Name"),value:c,onChange:({currentTarget:{value:i}})=>h(i)}),t==="password"&&e.jsx(ve,{value:c,onChange:i=>h(i)}),e.jsx(D,{mt:"xs",children:e.jsx(w,{ml:"auto",onClick:p,children:n("Change")})})]})}const Mt=/^\S+@\S+\.\S+$/,ie=s=>!!s.match(Mt),Je=s=>s.length>=8&&!!s.match(/\d/)&&!!s.match(/[a-zA-Z]/),Re=60;function qe({value:s,onChange:t,onVerify:a,otpSent:n,allowResendOtp:o,...l}){const{t:r}=S(),[d,c]=j.useState(!1),[h,u]=j.useState(Re),p=!!s&&ie(s),i=()=>{o&&(c(!0),u(Re)),a()};return j.useEffect(()=>{let b;return d&&h>0?b=window.setTimeout(()=>{u(h-1)},1e3):h===0&&c(!1),()=>clearTimeout(b)},[d,h]),e.jsx(Y,{type:"email",label:r("Email"),value:s,onChange:({currentTarget:{value:b}})=>t(b),error:s&&!ie(s),rightSection:n?e.jsx(w,{variant:"transparent",size:"xs",leftSection:e.jsx(Pe,{}),disabled:!0,children:r("Verification code sent")}):e.jsx(w,{variant:"subtle",size:"xs",onClick:i,disabled:!p||d,children:d?`${h}s`:r("Send verification code")}),rightSectionWidth:"fit-content",...l})}const At=s=>{const{t}=S(),a=L(),[n,o]=j.useState(""),[l,r]=j.useState(""),[d,c]=j.useState(""),[h,u]=j.useState(""),[p,i]=j.useState(!1),y=!!n&&ie(n)&&!!d&&!!l&&Je(l),v=A=>a(z({title:t("Unable to reset your password"),message:A,type:"error",duration:9e3})),k=async()=>{try{const A=await _(I.AUTH_SEND_RESET_PASSWORD_EMAIL,{method:"POST",body:JSON.stringify({email:n})});A.status===204?u(n):A.status>400&&u("error")}catch{u("error")}},x=async()=>{i(!0);const A=new URLSearchParams({token:d}),g=`${I.AUTH_RESET_PASSWORD}?${A.toString()}`;try{const m=await _(g,{method:"POST",body:JSON.stringify({password:l})});if(m.status!==204){v(await m.text());return}const{error:W,username:$}=(await a(be({email:n,password:l}))).payload;W?v(W):a(z({title:t("Welcome ")+$,message:t("Your password has been reset successfully."),type:"success",duration:5e3}))}catch(m){v(m.message)}finally{i(!1)}};return e.jsxs(T,{children:[e.jsx(P,{children:e.jsx(R,{order:3,size:"h5",children:t("Forgot password")})}),e.jsxs(te,{direction:"column",gap:"xs",children:[h==="error"&&e.jsx(ee,{color:"red",icon:e.jsx(De,{}),title:t("Check your email again!")}),h&&h!=="error"&&e.jsx(ee,{color:"blue",icon:e.jsx(we,{}),title:t("Email with reset link is sent to")+" "+h}),e.jsx(qe,{value:n,onChange:o,onVerify:k,otpSent:h}),e.jsx(Y,{label:t("Reset password token"),value:d,onChange:({currentTarget:{value:A}})=>c(A)}),e.jsx(ve,{value:l,onChange:r}),e.jsx(w,{onClick:x,loading:p,disabled:!y||p,children:t("Reset password")}),e.jsx(w,{variant:"default",onClick:()=>s.setLoginState("login"),disabled:p,children:t("Back to log in")})]})]})},Rt=/^\S+@\S+\.\S+$/,Le=s=>!!s.match(Rt),Lt=s=>{const{t}=S(),a=L(),[n,o]=j.useState(""),[l,r]=j.useState(""),[d,c]=j.useState(!1),h=!!n&&Le(n)&&!!l,u=async()=>{c(!0);try{const{error:p,username:i}=(await a(be({email:n,password:l}))).payload;a(p?z({title:t("Unable to login"),message:p,type:"error",duration:9e3}):z({title:t("Welcome ")+i,message:t("Login success"),type:"success",duration:5e3}))}finally{c(!1)}};return e.jsxs(T,{children:[e.jsx(P,{children:e.jsx(R,{order:3,size:"h5",children:t("Log in")})}),e.jsxs(te,{direction:"column",gap:"xs",children:[e.jsx(Y,{type:"email",label:t("Email"),value:n,onChange:({currentTarget:{value:p}})=>o(p),error:n&&!Le(n)}),e.jsx(Te,{label:t("Password"),value:l,onChange:({currentTarget:{value:p}})=>r(p)}),e.jsx(Se,{component:"button",ml:"auto",onClick:()=>s.setLoginState("forgot-password"),children:t("Forgot password")+"?"}),e.jsx(w,{onClick:u,loading:d,disabled:!h||d,children:t("Log in")}),e.jsx(w,{variant:"default",onClick:()=>s.setLoginState("register"),disabled:d,children:t("Create an account")})]})]})},Ot=s=>{const{t}=S(),a=L(),[n,o]=j.useState(""),[l,r]=j.useState(""),[d,c]=j.useState(""),[h,u]=j.useState(""),[p,i]=j.useState(""),[b,y]=j.useState(!1),v=!!l&&ie(l),k=!!n&&v&&!!h&&!!d&&Je(d),x=m=>a(z({title:t("Unable to create your account"),message:m,type:"error",duration:9e3})),A=async()=>{try{const m=await _(I.AUTH_SEND_VERIFICATION_EMAIL,{method:"POST",body:JSON.stringify({email:l})});m.status===204?i(l):m.status>400&&i("error")}catch{i("error")}},g=async()=>{y(!0);try{const m=await _(I.AUTH_REGISTER,{method:"POST",body:JSON.stringify({name:n,email:l,password:d,emailVerificationToken:Number(h)})});if(m.status!==201){x(await m.text());return}const{error:W,username:$}=(await a(be({email:l,password:d}))).payload;W?x(W):a(z({title:t("Welcome ")+$,message:t("Your account is created successfully."),type:"success",duration:5e3}))}catch(m){x(m.message)}finally{y(!1)}};return e.jsxs(T,{children:[e.jsx(P,{children:e.jsx(R,{order:3,size:"h5",children:t("Create an account")})}),e.jsxs(te,{direction:"column",gap:"xs",children:[p==="error"&&e.jsx(ee,{color:"red",icon:e.jsx(De,{}),title:t("The email is not valid!")}),p&&p!=="error"&&e.jsx(ee,{color:"blue",icon:e.jsx(we,{}),title:t("Verification email is sent to")+" "+p}),e.jsx(Y,{label:t("Name"),description:t("You may always change it later."),value:n,onChange:({currentTarget:{value:m}})=>o(m)}),e.jsx(qe,{description:t("We'll never share your email."),value:l,onChange:r,onVerify:A,otpSent:p,allowResendOtp:!0}),e.jsx(Y,{label:t("Verification code"),value:h,onChange:({currentTarget:{value:m}})=>u(m)}),e.jsx(ve,{value:d,onChange:c}),e.jsx(w,{onClick:g,loading:b,disabled:!k||b,children:t("Sign up")}),e.jsx(w,{variant:"default",onClick:()=>s.setLoginState("login"),disabled:b,children:t("Back to log in")})]})]})},_t=1,It=10,Et=()=>{const{t:s}=S(),t=L(),{isLoggedIn:a,token:n,activeSubscriptions:o,currentSaveId:l,saves:r}=M(g=>g.account),{lastChangedAtTimeStamp:d}=M(g=>g.rmpSave),c=a&&r&&(o.RMP_CLOUD?r.length<It:r.length<_t),h=Math.min(...(r??[]).map(g=>g.id)),u=g=>!o.RMP_CLOUD&&g!==h,[p,i]=B.useState(void 0),[b,y]=B.useState(void 0),v=g=>t(z({title:s("Unable to sync your save"),message:g,type:"error",duration:9e3})),k=async()=>{const g=await je(q.RMP);if(!a||!g||!n){v(s("Failed to get the RMP save!"));return}const{data:m,hash:W}=g,$=crypto.randomUUID();try{const H=await _(I.SAVES,{method:"POST",body:JSON.stringify({index:$,data:m,hash:W})},n);if(H.status===401){v(s("Login status expired")),t(N());return}if(H.status!==200){v(await H.text());return}t(Q())}catch(H){v(H.message)}},x=async g=>{if(!(!a||!n)){if(g===l){if(i(l),!l||u(l)){v(s("Can not sync this save!")),i(void 0);return}const m=await t(Q());if(m.meta.requestStatus!=="fulfilled"){v(s("Login status expired")),i(void 0);return}const $=m.payload.saves.filter(Ze=>Ze.id===l).at(0);if(!$){v(s("Current save id is not in saveList!")),i(void 0);return}const H=new Date($.lastUpdateAt);if(new Date(d)<H){pe.warn(`Save id: ${l} is newer in the cloud via local compare.`),t(Be()),i(void 0);return}const Ce=await je(q.RMP);if(!Ce){v(s("Failed to get the RMP save!")),i(void 0);return}const{data:Qe,hash:Xe}=Ce,le=await _(I.SAVES+"/"+l,{method:"PATCH",body:JSON.stringify({data:Qe,hash:Xe})},n);if(le.status===401){v(s("Login status expired")),i(void 0),t(N());return}if(le.status!==200){v(await le.text()),i(void 0);return}i(void 0)}else{i(g);const m=await _(I.SAVES+"/"+g,{},n);if(m.status===401){v(s("Login status expired")),i(void 0),t(N());return}if(m.status!==200){v(await m.text()),i(void 0);return}pe.info(`Set ${q.RMP} with save id: ${g}`),Fe(q.RMP,await m.text()),t($e(new Date().valueOf())),We(),i(void 0)}t(Q())}},A=async g=>{if(!a||!g||!n)return;y(g);const m=await _(I.SAVES+"/"+l,{method:"DELETE"},n);if(m.status===401){v(s("Login status expired")),y(void 0),t(N());return}if(m.status!==200){v(await m.text()),y(void 0);return}t(Q()),y(void 0)};return e.jsxs(T,{children:[e.jsxs(P,{align:"center",children:[e.jsx(R,{order:3,size:"h5",children:s("Synced saves")}),e.jsxs(C,{ml:"auto",size:"sm",children:[s("Maximum save count:")," ",o.RMP_CLOUD?10:1]}),e.jsx(w,{variant:"subtle",size:"xs",ml:"xs",disabled:!c,onClick:k,children:s("Create")})]}),e.jsx(te,{direction:"column",gap:"xs",children:r==null?void 0:r.map(g=>e.jsxs(J,{withBorder:!0,shadow:"sm",style:{flexDirection:"row"},children:[e.jsxs(O,{gap:"xs",flex:1,children:[e.jsx(C,{fw:500,children:g.id===l?s("Current save"):s("Cloud save")}),e.jsxs(C,{children:[s("Last update at:")," ",new Date(g.lastUpdateAt).toLocaleString()]})]}),e.jsxs(O,{gap:"xs",ml:"xs",children:[e.jsx(w,{variant:"filled",color:"red",loading:b===g.id,onClick:()=>A(g.id),children:s("Delete this save")}),e.jsx(w,{variant:"filled",disabled:u(g.id),loading:p===g.id,onClick:()=>x(g.id),children:g.id===l?s("Sync now"):s("Sync this slot")})]})]},g.id))})]})},Tt=s=>{const{t}=S(),{opened:a,onClose:n,getSubscriptions:o}=s,{isLoggedIn:l,token:r}=M(i=>i.account),d=L(),[c,h]=B.useState(""),u=i=>d(z({title:t("Unable to redeem"),message:i,type:"error",duration:9e3})),p=async i=>{if(!l)return;const b=await _(I.SUBSCRIPTION_REDEEM,{method:"POST",body:JSON.stringify({cdkey:i.trim()})},r);if(b.status===401){u(t("Login status expired")),d(N());return}if(b.status!==202){const y=(await b.json()).message;u(t(y));return}await o(),n()};return e.jsxs(F,{opened:a,onClose:n,title:t("Redeem your subscription"),children:[e.jsx(C,{children:t("CDKey could be purchased in the following sites:")}),e.jsx(U,{withPadding:!0,mt:"xs",children:e.jsx(U.Item,{children:e.jsxs(Se,{href:"https://afdian.com/item/9c8b220c614311efab2d52540025c377",target:"_blank",children:["爱发电 ",e.jsx(Z,{})]})})}),e.jsxs(D,{align:"flex-end",gap:"sm",mt:"xs",children:[e.jsx(Y,{label:"CDKey",placeholder:t("Enter your CDKey here"),value:c,onChange:({currentTarget:{value:i}})=>h(i),style:{minWidth:240}}),e.jsx(w,{onClick:()=>p(c),children:t("Redeem")})]})]})},Pt=()=>{const{t:s}=S(),{isLoggedIn:t,token:a}=M(u=>u.account),n=L(),[o,l]=B.useState([]),[r,d]=B.useState(!1),c=u=>n(z({title:s("Unable to retrieve your subscriptions"),message:u,type:"error",duration:9e3})),h=async()=>{if(!t)return;const u=await _(I.SUBSCRIPTION,{},a);if(u.status===401){c(s("Login status expired")),n(N());return}if(u.status!==200){c(await u.text());return}const p=(await u.json()).subscriptions;if(!p.map(b=>b.type).includes("RMP_CLOUD"))return;l([{type:"RMP",expires:p[0].expires}]);const i=structuredClone(Vs);for(const b of p){const y=b.type;y in i&&(i[y]=!0)}n(Bs(i))};return B.useEffect(()=>{h()},[]),e.jsxs(T,{children:[e.jsxs(P,{align:"center",children:[e.jsx(R,{order:3,size:"h5",children:s("All subscriptions")}),e.jsx(w,{variant:"subtle",size:"xs",ml:"auto",onClick:()=>d(!0),children:s("Redeem")})]}),e.jsxs(te,{direction:"column",gap:"xs",children:[o.length===0&&e.jsxs(J,{withBorder:!0,shadow:"sm",children:[e.jsx(J.Section,{p:"xs",children:e.jsx(R,{order:4,size:"h3",children:s("Rail Map Painter")})}),e.jsxs(O,{gap:"xs",children:[e.jsx(C,{children:s("With this subscription, the following features are unlocked:")}),e.jsxs(U,{withPadding:!0,children:[e.jsx(U.Item,{children:s("PRO features")}),e.jsx(U.Item,{children:s("Sync 9 more saves")}),e.jsx(U.Item,{children:s("Unlimited master nodes")}),e.jsx(U.Item,{children:s("Unlimited parallel lines")})]}),e.jsxs(C,{children:[s("Expires at:")," ",s("Not applicable")]})]})]}),o.map(u=>e.jsxs(J,{withBorder:!0,shadow:"sm",children:[e.jsx(J.Section,{p:"xs",children:e.jsx(R,{order:4,size:"h3",children:s(u.type==="RMP"?"Rail Map Painter":u.type)})}),e.jsxs(O,{gap:"xs",children:[e.jsxs(C,{children:[s("Expires at:")," ",new Date(u.expires).toLocaleString()]}),e.jsx(w,{color:"blue",onClick:()=>d(!0),children:s("Renew")})]})]},u.type))]}),e.jsx(Tt,{opened:r,onClose:()=>d(!1),getSubscriptions:h})]})},Nt=()=>{const{t:s}=S(),{isLoggedIn:t}=M(o=>o.account),[a,n]=j.useState("login");return e.jsxs(T,{children:[e.jsx(P,{children:e.jsx(R,{order:2,size:"h4",children:s("Account")})}),t?e.jsxs(te,{className:vt.body,children:[e.jsx(yt,{}),e.jsx(xe,{}),e.jsx(Pt,{}),e.jsx(Et,{})]}):a==="login"?e.jsx(Lt,{setLoginState:n}):a==="register"?e.jsx(Ot,{setLoginState:n}):e.jsx(At,{setLoginState:n})]})},Dt="_button_1hzui_1",zt="_label_1hzui_11",X={button:Dt,label:zt,"sub-label":"_sub-label_1hzui_17"};function Ke(){return ls("(min-width: 36em)")}function Ut(s){var k;const{appId:t,onAboutOpen:a}=s,{t:n}=S(),o=L(),l=Ke(),{activeTab:r,openedTabs:d}=M(x=>x.app),c=se[t],h=c.name.split(" - ").map(x=>n(x)).join(" - "),u=d.some(x=>x.app===t),p=!c.allowMultiInstances&&((k=d.find(x=>x.id===r))==null?void 0:k.app)===t,i=x=>{u||f.event(E.OPEN_APP,{appId:t,isOpenInNew:x}),o(x?Fs(t):me({appId:t})),l||(o(oe()),f.toggleNavMenu(!1))},b=x=>{o(Ws(x)),l||(o(oe()),f.toggleNavMenu(!1))},y=x=>{o($s(x)),f.event(E.CLOSE_APP,{app:t})},v=x=>{o(Gs(x)),f.event(E.CLOSE_APP,{app:x})};return e.jsx(ge,{component:"div",role:"button",variant:"filled",label:h,active:p,classNames:{root:X.button,label:X.label},leftSection:u?e.jsx(us,{title:n("Running")}):void 0,rightSection:e.jsxs(e.Fragment,{children:[c.allowMultiInstances&&e.jsx(V,{"aria-label":n("New tab"),title:n("New tab"),variant:"subtle",color:p?"white":"gray",mr:4,onClick:x=>{x.stopPropagation(),i(!0)},children:e.jsx(rs,{})}),e.jsxs(ne,{children:[e.jsx(ne.Target,{children:e.jsx(V,{variant:"subtle",color:p?"white":"gray",onClick:x=>x.stopPropagation(),children:e.jsx(cs,{})})}),e.jsxs(ne.Dropdown,{children:[u&&e.jsx(ne.Item,{leftSection:e.jsx(he,{}),onClick:x=>{x.stopPropagation(),v(t)},children:c.allowMultiInstances?n("Close all tabs"):n("Close app")}),e.jsx(ne.Item,{leftSection:e.jsx(ds,{}),onClick:x=>{x.stopPropagation(),a()},children:n("About")})]})]})]}),disableRightSectionRotation:!0,opened:!0,onClick:()=>i(!1),children:c.allowMultiInstances&&d.filter(x=>x.app===t).map((x,A)=>{const g=x.id===r;return e.jsx(ge,{component:"div",role:"button",variant:"filled",active:g,label:e.jsxs(e.Fragment,{children:[e.jsx(ze,{color:"lightgray",c:"black",mr:"xs",circle:!0,display:"inline-flex",children:A+1}),x.title??n("Tab")+" "+(A+1).toString()+" - "+h]}),classNames:{root:X.button,label:X["sub-label"]},rightSection:e.jsx(V,{variant:"subtle",color:g?"white":"gray","aria-label":n("Close tab"),title:n("Close tab"),onClick:m=>{m.stopPropagation(),y(x.id)},children:e.jsx(he,{})}),onClick:()=>b(x.id)},x.id)})})}const Vt=async s=>{const t=`/${s}/info.json`;try{return(await(await fetch(t)).json()).version}catch(a){return pe.info(`Failed to get version of ${s}`,a),"unknown"}};function Bt(s){var d,c,h;const{appId:t,onClose:a}=s,{t:n}=S(),[o,l]=j.useState("Unknown"),r=t?(h=(c=(d=se[t])==null?void 0:d.url)==null?void 0:c.split("/"))==null?void 0:h[1]:void 0;return j.useEffect(()=>{r?Vt(r).then(u=>l(u)):l("Unknown")},[r]),e.jsx(F,{opened:!!t,onClose:a,size:"xl",title:e.jsxs(e.Fragment,{children:[n("About")+" "+(t?se[t].name.split(" - ").map(u=>n(u)).join(" - "):""),e.jsx(ze,{color:"gray",radius:"sm",ml:"xs",children:o})]}),children:e.jsx(w,{component:"a",href:"https://github.com/railmapgen/"+r,target:"_blank",children:n("Visit GitHub")})})}function Oe({assetType:s}){const{t}=S(),[a,n]=j.useState(),o=He(s,f.getEnv(),f.getInstance());return e.jsxs(T,{children:[e.jsx(P,{children:e.jsx(R,{order:2,size:"h4",children:t(s==="devtool"?"Devtools":"Apps")})}),e.jsx(K,{direction:"column",children:o.map(l=>e.jsx(Ut,{appId:l,onAboutOpen:()=>n(l)},l))}),e.jsx(Bt,{appId:a,onClose:()=>n(void 0)})]})}function Ft(){const{t:s}=S(),t=He("link",f.getEnv(),f.getInstance()),a=n=>{f.event(E.OPEN_LINK,{id:n})};return e.jsxs(T,{children:[e.jsx(P,{children:e.jsx(R,{order:2,size:"h4",children:s("Useful links")})}),e.jsx(K,{direction:"column",children:t.map(n=>e.jsx(ge,{variant:"filled",label:s(se[n].name),classNames:{root:X.button,label:X.label},rightSection:e.jsx(Z,{}),href:se[n].url,target:"_blank",onClick:()=>a(n)},n))})]})}const _e={"textarea-label":"_textarea-label_kau51_1","textarea-input":"_textarea-input_kau51_5"};function Wt(s){var c;const{opened:t,onClose:a}=s,{t:n}=S(),[o,l]=j.useState(),r=Object.entries(localStorage),d=()=>{o&&(window.localStorage.removeItem(o),window.location.reload())};return e.jsxs(F,{opened:t,onClose:a,size:"xl",title:n("Local Storage"),children:[e.jsx(O,{gap:"xs",children:r.map(h=>e.jsx(hs,{label:e.jsxs(D,{align:"center",gap:"xs",children:[h[0],e.jsx(V,{variant:"default",size:"xs",title:n("Remove this item"),"aria-label":n("Remove this item"),onClick:()=>l(h[0]),children:e.jsx(ps,{})})]}),value:h[1],readOnly:!0,rows:4,classNames:{label:_e["textarea-label"],input:_e["textarea-input"]}},h[0]))}),e.jsx(D,{pt:"xs",children:e.jsx(w,{ml:"auto",onClick:a,children:n("Go back")})}),o&&e.jsxs(F,{opened:!0,onClose:()=>l(void 0),centered:!0,title:n("Warning"),children:[e.jsxs(C,{children:[n("LocalStorageModal.text1"),e.jsx(xs,{children:o}),n("LocalStorageModal.text2"),e.jsx(C,{span:!0,fw:500,children:n(((c=se[o.split("__")[0]])==null?void 0:c.name)??"Unknown app")}),n("LocalStorageModal.text3"),e.jsx("br",{}),n("LocalStorageModal.text4")]}),e.jsxs(D,{gap:"xs",mt:"xs",children:[e.jsx(w,{variant:"default",ml:"auto",onClick:()=>l(void 0),children:n("Back")}),e.jsx(w,{color:"red",onClick:d,children:n("Delete and reload")})]})]})]})}function Ye(s){const{t}=S(),a=[{group:t("Main languages"),items:Zs.map(n=>({value:n,label:ce[n][n]}))},{group:t("Other languages"),items:et.map(n=>({value:n,label:ce[n][n]??ce[n].en}))}];return e.jsx(gs,{label:t("Language"),defaultValue:f.getLanguage(),onChange:({currentTarget:{value:n}})=>{const o=n;f.setLanguage(o),f.getI18nInstance().changeLanguage(o),f.event(E.CHANGE_LANGUAGE,{language:o})},data:a,...s})}function $t(){const{t:s}=S(),{setColorScheme:t}=ms(),a=L(),{lastShowDevtools:n,refreshRequired:o}=M(i=>i.app),[l,r]=j.useState(f.isAllowAnalytics()),[d,c]=j.useState(!1),h=Ge(n),u=i=>{r(i),f.allowAnalytics(i).refreshRequired&&a(qs())},p=[{value:"light",label:s("Light")},{value:"dark",label:s("Dark")},{value:"system",label:s("System")}];return e.jsxs(T,{children:[o&&e.jsx(ee,{color:"blue",icon:e.jsx(we,{}),mb:"xs",children:s("Refreshing is required for changes to take effect.")}),e.jsx(P,{children:e.jsx(R,{order:2,size:"h4",children:s("Settings")})}),e.jsxs(O,{gap:"xs",py:"xs",children:[e.jsx(Ye,{}),e.jsx(js,{size:"sm",label:s("Appearance"),defaultValue:f.getColourMode(),onChange:i=>{t(i==="system"?"auto":i),f.setColourMode(i)},data:p}),e.jsx(ye,{label:s("Allow cookies to help improve our website"),labelPosition:"left",checked:l,onChange:({currentTarget:{checked:i}})=>u(i),disabled:o,styles:{labelWrapper:{flex:1}}}),e.jsx(ye,{label:s("Show dev tools for 1 day"),labelPosition:"left",checked:h,onChange:({currentTarget:{checked:i}})=>{i?(a(Hs()),f.event(E.SHOW_DEVTOOLS)):a(Js())},styles:{labelWrapper:{flex:1}}}),h&&e.jsx(w,{variant:"default",leftSection:e.jsx(fs,{}),onClick:()=>c(!0),children:s("Export Local Storage")})]}),h&&e.jsx(Wt,{opened:d,onClose:()=>c(!1)})]})}function Gt(){const{t:s}=S(),{remoteFonts:t}=M(a=>a.app);return e.jsxs(T,{children:[e.jsx(P,{children:e.jsx(R,{order:2,size:"h4",children:s("Web fonts")})}),e.jsxs(O,{gap:"xs",children:[e.jsxs(C,{fs:"italic",children:[s("FontsSection.text1")," ",s("FontsSection.text2")," ",s("FontsSection.text3")," (",s("FontsSection.safari"),")"]}),Object.entries(t).map(([a,n])=>e.jsx(w,{variant:"default",rightSection:n.url?e.jsx(Z,{}):void 0,disabled:!n.url,onClick:()=>{window.open(n.url,"_blank"),f.event(E.DOWNLOAD_FONT,{family:a})},children:n.displayName?`${n.displayName} (${a})`:a},a))]})]})}const Ht="_bilibili_5ep1h_1",Jt={bilibili:Ht};function qt(s){return Ue({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 32C132.3 32 32 134.9 32 261.7c0 101.5 64.2 187.5 153.2 217.9a17.56 17.56 0 0 0 3.8.4c8.3 0 11.5-6.1 11.5-11.4 0-5.5-.2-19.9-.3-39.1a102.4 102.4 0 0 1-22.6 2.7c-43.1 0-52.9-33.5-52.9-33.5-10.2-26.5-24.9-33.6-24.9-33.6-19.5-13.7-.1-14.1 1.4-14.1h.1c22.5 2 34.3 23.8 34.3 23.8 11.2 19.6 26.2 25.1 39.6 25.1a63 63 0 0 0 25.6-6c2-14.8 7.8-24.9 14.2-30.7-49.7-5.8-102-25.5-102-113.5 0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8a18.64 18.64 0 0 1 5-.5c8.1 0 26.4 3.1 56.6 24.1a208.21 208.21 0 0 1 112.2 0c30.2-21 48.5-24.1 56.6-24.1a18.64 18.64 0 0 1 5 .5c12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6 0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5 0 30.7-.3 55.5-.3 63 0 5.4 3.1 11.5 11.4 11.5a19.35 19.35 0 0 0 4-.4C415.9 449.2 480 363.1 480 261.7 480 134.9 379.7 32 256 32z"},child:[]}]})(s)}function Kt(s){return Ue({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M126.12 315.1A47.06 47.06 0 1 1 79.06 268h47.06zm23.72 0a47.06 47.06 0 0 1 94.12 0v117.84a47.06 47.06 0 1 1-94.12 0zm47.06-188.98A47.06 47.06 0 1 1 244 79.06v47.06zm0 23.72a47.06 47.06 0 0 1 0 94.12H79.06a47.06 47.06 0 0 1 0-94.12zm188.98 47.06a47.06 47.06 0 1 1 47.06 47.1h-47.06zm-23.72 0a47.06 47.06 0 0 1-94.12 0V79.06a47.06 47.06 0 1 1 94.12 0zM315.1 385.88a47.06 47.06 0 1 1-47.1 47.06v-47.06zm0-23.72a47.06 47.06 0 0 1 0-94.12h117.84a47.06 47.06 0 1 1 0 94.12z"},child:[]}]})(s)}function Yt(){const{t:s}=S();return e.jsxs(T,{children:[e.jsx(P,{children:e.jsx(R,{order:2,size:"h4",children:s("Help & support")})}),e.jsxs(O,{gap:"xs",children:[e.jsx(w,{variant:"default",leftSection:e.jsx(qt,{}),rightSection:e.jsx(Z,{}),onClick:()=>{window.open("https://github.com/railmapgen/railmapgen.github.io/issues","_blank"),f.event(E.RAISE_ISSUE)},children:s("Raise an Issue on GitHub")}),e.jsx(w,{variant:"default",leftSection:e.jsx(Kt,{}),rightSection:e.jsx(Z,{}),onClick:()=>{window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),f.event(E.JOIN_SLACK)},children:s("Join us on Slack")}),e.jsx(w,{variant:"default",leftSection:e.jsx(ue,{className:Jt.bilibili,src:"images/bilibili.svg"}),rightSection:e.jsx(Z,{}),onClick:()=>{window.open("https://space.bilibili.com/10124055","_blank"),f.event(E.FOLLOW_BILIBILI)},children:s("Follow us on Bilibili")})]})]})}function Qt(){const{t:s}=S(),{isShowMenu:t,menuView:a,lastShowDevtools:n}=M(p=>p.app),{isLoggedIn:o,name:l}=M(p=>p.account),r=L(),d=Ke(),[c]=Ve(),h=(f.getInstance()==="GitLab"?"https://railmapgen.gitlab.io/":"https://railmapgen.github.io/")+"?"+c.toString();j.useEffect(()=>{o&&r(Q())},[o]);const u=[{key:"apps",label:s("Apps"),Icon:e.jsx(ws,{size:22})},{key:"links",label:s("Useful links"),Icon:e.jsx(Ss,{size:22})},{key:"devtools",label:s("Devtools"),Icon:e.jsx(bs,{size:22}),ActionIconProps:{style:{display:Ge(n)?"inline-flex":"none"}}},{key:"account",label:s("Account"),Icon:e.jsx(Ne,{variant:"light",name:o?l:void 0,size:"sm",color:"initials"}),ActionIconProps:{mt:"auto"}},{key:"contributors",label:s("Contributors"),Icon:e.jsx(vs,{size:22}),ActionIconProps:{onClick:()=>{r(Ks("contributors")),d||(r(oe()),f.toggleNavMenu(!1))}}},{key:"support",label:s("Help & support"),Icon:e.jsx(Cs,{size:22})},{key:"settings",label:s("Settings"),Icon:e.jsx(ys,{size:22})}];return e.jsx("nav",{className:Ee(G.root,t&&G["show-menu"]),children:e.jsxs("div",{className:G.wrapper,children:[e.jsxs(ks,{className:G.header,children:[e.jsx(R,{children:s("Rail Map Toolkit")}),e.jsx(Ms,{env:f.getEnv(),ver:f.getAppVersion()})]}),e.jsx(xe,{}),f.getEnv()!=="PRD"&&e.jsxs(ee,{color:"yellow",icon:e.jsx(As,{}),className:G.alert,children:[s("You're currently viewing a testing environment.")," ",e.jsx(Se,{size:"sm",href:h,target:"_blank",children:s("Back to production environment")})]}),e.jsxs("div",{className:G.body,children:[e.jsx("div",{className:G.aside,children:u.map(({key:p,label:i,Icon:b,ActionIconProps:y})=>e.jsx(Rs,{label:i,position:"right",withArrow:!0,children:e.jsx(V,{variant:a===p?"light":"subtle",color:a===p?void 0:"gray",size:"lg",onClick:()=>r(Ys(p)),...y,children:b})},p))}),e.jsx(xe,{orientation:"vertical"}),e.jsxs("div",{className:G.main,children:[a==="apps"?e.jsx(Oe,{assetType:"app"}):a==="links"?e.jsx(Ft,{}):a==="devtools"?e.jsx(Oe,{assetType:"devtool"}):a==="settings"?e.jsx($t,{}):a==="support"?e.jsxs(e.Fragment,{children:[e.jsx(Yt,{}),e.jsx(Gt,{})]}):a==="account"?e.jsx(Nt,{}):e.jsx(e.Fragment,{}),e.jsx(St,{})]})]})]})})}function Xt(s){const{opened:t,onClose:a}=s,{t:n}=S(),o=()=>{f.allowAnalytics(!0),a()},l=()=>{f.allowAnalytics(!1).refreshRequired?window.location.reload():a()};return e.jsxs(F,{opened:t,onClose:()=>{},title:n("CookiesModal.header"),withCloseButton:!1,closeOnEscape:!1,closeOnClickOutside:!1,centered:!0,children:[e.jsx(D,{children:e.jsx(Ye,{ml:"auto"})}),e.jsxs(O,{gap:"xs",py:"xs",children:[e.jsx(C,{children:n("CookiesModal.text1")}),e.jsx(C,{mt:2,children:n("CookiesModal.text2")}),e.jsx(U,{withPadding:!0,children:e.jsxs(U.Item,{children:[" ",n("CookiesModal.item1")]})}),e.jsx(C,{mt:2,children:n("CookiesModal.text3")})]}),e.jsxs(D,{gap:"sm",children:[e.jsx(w,{variant:"default",ml:"auto",onClick:l,children:n("CookiesModal.reject")}),e.jsx(w,{onClick:o,children:n("CookiesModal.accept")})]})]})}const Zt=()=>{};function en(){const{t:s}=S(),[t,a]=j.useState(!1),n=()=>{a(!0),Qs(),setTimeout(()=>{window.location.reload()},1e3)};return e.jsxs(F,{opened:!0,onClose:Zt,title:s("Rail Map Toolkit is opened in another window"),withCloseButton:!1,closeOnEscape:!1,closeOnClickOutside:!1,centered:!0,children:[e.jsx(C,{children:s("You cannot open multiple Rail Map Toolkit at the same time. Please close this window.")}),e.jsx(D,{mt:"xs",children:e.jsx(w,{variant:"default",onClick:n,loading:t,disabled:t,children:s("Restart RMT in this window")})})]})}const sn=()=>{};function tn(){const{t:s}=S();return e.jsx(F,{opened:!0,onClose:sn,title:s("Rail Map Toolkit is opened in another window"),withCloseButton:!1,closeOnEscape:!1,closeOnClickOutside:!1,centered:!0,children:e.jsx(C,{children:s("Current session has been terminated. Please close this window.")})})}const nn="_root_nos1z_1",an={root:nn},on={info:void 0,success:"green",warning:"yellow",error:"red"},de=200,Ie=400;function ln({notification:s}){const t=L(),[a,n]=j.useState(!1);return j.useEffect(()=>{setTimeout(()=>{n(!0)},de);const o=setTimeout(()=>{n(!1)},de+s.duration);return setTimeout(()=>{t(Xs(s.id))},de+s.duration+Ie),()=>{clearTimeout(o)}},[]),e.jsx(Ls,{mounted:a,transition:"slide-left",duration:Ie,timingFunction:"ease",children:o=>e.jsx(Os,{color:on[s.type],title:s.title,onClose:()=>n(!1),withBorder:!0,style:o,children:s.message})})}function rn(){const{notifications:s}=M(t=>t.notification);return e.jsx(_s,{children:e.jsx(O,{className:an.root,children:s.map(t=>e.jsx(ln,{notification:t},t.id))})})}function gn(){const{t:s}=S(),t=L(),{isPrimary:a,isTerminated:n,isShowMenu:o}=M(c=>c.app),[l,r]=j.useState(!1);j.useEffect(()=>{f.isAnalyticsQADone()||r(!0)},[]);const d=()=>{f.toggleNavMenu(!o),t(oe()),f.event(E.TOGGLE_NAV_MENU)};return e.jsx(Ps,{basename:"/",children:e.jsxs(Is,{className:o?"show-menu":"",children:[e.jsx(V,{className:tt.burger,variant:o?"subtle":"filled",color:o?"gray":void 0,"aria-label":s("Toggle menu"),title:s("Toggle menu"),onClick:d,children:e.jsx(Es,{})}),e.jsxs(Ts,{direction:"row",children:[e.jsx(Qt,{}),e.jsx(dt,{alwaysShowWelcome:n||a===!1})]}),e.jsx(rn,{}),n&&e.jsx(tn,{}),a===!1&&e.jsx(en,{}),e.jsx(Xt,{opened:l,onClose:()=>r(!1)})]})})}export{gn as default};

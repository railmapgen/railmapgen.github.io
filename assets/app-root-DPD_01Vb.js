import{j as e,S as _,G as N,I as ue,T as R,e as C,n as Ee,o as B,C as H,F as K,p as es,B as w,q as ss,P as re,s as Pe,t as ts,u as Ne,v as pe,w as ns,A as De,x as U,y as as,z as os,D as is,E as Y,b as I,c as E,d as te,g as ee,H as ze,J as Se,K as be,l as he,O as z,Q as Z,U as xe,V as ls,W as ge,X as Ue,Y as rs,Z as ne,_ as cs,$ as ds,a0 as us,r as f,a1 as ps,a2 as hs,a3 as xs,N as gs,a4 as ms,a5 as js,a6 as ke,a7 as fs,a8 as Ve,a9 as ws,aa as Ss,ab as bs,ac as vs,ad as Cs,ae as ys,k as ks,af as Ms,M as As,ag as Rs,ah as Ls,ai as _s,aj as Os,i as Ts,ak as Is,m as Es}from"./mantine-B5EjhH7N.js";import{k as S,r as j,o as Be,R as V,B as Ps}from"./react-UC3gAxe5.js";import{u as L,o as me,F as Ns,a as M,b as Ds,S as J,l as P,s as Fe,f as X,g as je,c as We,n as $e,d as Ge,e as zs,A as ae,h as O,i as q,j as Us,k as D,m as ve,p as Vs,q as Bs,E as T,r as Fs,t as fe,v as Ws,w as $s,x as Gs,y as He,z as Hs,B as Js,C as qs,D as Ks,G as Ys,H as Xs,I as Qs}from"./main-DjLCJsqf.js";import{a as se,b as Je,S as Zs,O as et,L as ce}from"./asset-enablements-DzI5TNlO.js";import"./index-C_hgTfa4.js";const st="_burger_1y0se_1",tt={burger:st},nt="_workspace_anux8_1",at="_show_anux8_11",ot="_welcome_anux8_20",it="_icons_anux8_35",oe={workspace:nt,"app-container":"_app-container_anux8_7",show:at,welcome:ot,icons:it},lt="/assets/rmp-logo512-eHekupnf.png";function rt(){const{t:s}=S(),t=L();return e.jsxs(_,{className:oe.welcome,children:[e.jsxs(N,{className:oe.icons,grow:!0,children:[e.jsx(ue,{src:"/logo512.png",title:s("Open")+" "+s("Rail Map Generator"),onClick:()=>t(me({appId:"rmg"}))}),e.jsx(ue,{src:lt,title:s("Open")+" "+s("Rail Map Painter"),onClick:()=>t(me({appId:"rmp"}))})]}),e.jsx(R,{children:s("Welcome to Rail Map Toolkit")}),e.jsx(C,{children:s("Select an app to start your own rail map design!")})]})}function ct(s){const{tab:t,isActive:a}=s,n=j.useMemo(()=>t.url??"/"+t.app+"/",[t.app]);return e.jsx("div",{className:Ee(oe["app-container"],a&&oe.show),children:e.jsx("iframe",{id:Ns+t.id,src:n,loading:"lazy",title:t.app,width:"100%",height:"100%","data-persisted-url":t.url,"data-testid":"app-container-iframe"})})}function dt({alwaysShowWelcome:s}){const{openedTabs:t,activeTab:a}=M(o=>o.app),[,n]=Be();return j.useEffect(()=>{var o;if(a){const l=(o=t.find(c=>c.id===a))==null?void 0:o.app;n(l?{app:l}:{})}else n({})},[a]),e.jsx("div",{className:oe.workspace,children:s||t.length===0?e.jsx(rt,{}):t.map(o=>e.jsx(ct,{tab:o,isActive:a===o.id},o.id))})}const ut="_root_mj6g1_5",pt="_wrapper_mj6g1_31",ht="_alert_mj6g1_42",xt="_header_mj6g1_49",gt="_body_mj6g1_55",mt="_aside_mj6g1_62",jt="_main_mj6g1_75",$={root:ut,"show-menu":"_show-menu_mj6g1_15",wrapper:pt,alert:ht,header:xt,body:gt,aside:mt,main:jt},ft="_card_15zs0_1",Me={card:ft},Ae=(s,t,a)=>{const n=new Blob([a],{type:t});wt(s,n)},wt=(s,t)=>{const a=window.URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download=s,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(a)},St=()=>{const{t:s}=S(),{token:t,refreshToken:a,currentSaveId:n}=M(k=>k.account),{resolveConflictModal:{isOpen:o,lastChangedAtTimeStamp:l,lastUpdatedAtTimeStamp:c,cloudData:u}}=M(k=>k.rmpSave),d=L(),[p,r]=V.useState(!1),x=()=>d(zs()),i=()=>{We(J.RMP,u),$e(),d(Ge(c)),x()},b=()=>{Ae(`RMP_${c}.json`,"application/json",u)},y=async()=>{if(!n||!t||!a)return;r(!0);const k=await Ds(n,t,a,J.RMP);if(!k){d(P()),r(!1);return}if(k.status===409){d(Fe()),r(!1);return}k.status===200&&(d(X()),r(!1),x())},v=async()=>{const{data:k}=await je(J.RMP);Ae(`RMP_${l}.json`,"application/json",k)};return e.jsxs(B,{opened:o,onClose:()=>{},size:"lg",title:s("Oops! It seems there's a conflict"),withCloseButton:!1,closeOnClickOutside:!1,closeOnEscape:!1,centered:!0,children:[e.jsx(C,{children:s("The local save is newer than the cloud one. Which one would you like to keep?")}),e.jsxs(N,{my:"xs",children:[e.jsx(H,{withBorder:!0,className:Me.card,children:e.jsxs(_,{children:[e.jsxs(K,{children:[e.jsx(es,{}),e.jsx(C,{span:!0,children:s("Local save")})]}),e.jsxs(C,{span:!0,children:[s("Update at:")," ",new Date(l).toLocaleString()]}),e.jsx(w,{color:"red",loading:p,onClick:()=>y(),children:s("Replace cloud with local")}),e.jsx(w,{onClick:()=>v(),children:s("Download Local save")})]})}),e.jsx(H,{withBorder:!0,className:Me.card,children:e.jsxs(_,{children:[e.jsxs(K,{children:[e.jsx(ss,{}),e.jsx(C,{span:!0,children:s("Cloud save")})]}),e.jsxs(C,{span:!0,children:[s("Update at:")," ",new Date(c).toLocaleString()]}),e.jsx(w,{color:"red",onClick:()=>i(),children:s("Replace local with cloud")}),e.jsx(w,{onClick:()=>b(),children:s("Download Cloud save")})]})})]})]})},bt="_body_yczk0_1",vt={body:bt};function Re({meets:s,label:t}){return e.jsxs(C,{c:s?"teal":"red",style:{display:"flex",alignItems:"center"},mt:7,size:"sm",children:[s?e.jsx(Ne,{size:14}):e.jsx(pe,{size:14}),e.jsx(ns,{ml:10,children:t})]})}const we=[{re:/[0-9]/,label:"Includes number"},{re:/[a-zA-Z]/,label:"Includes letter"}];function Ct(s){let t=s.length>=8?0:1;return we.forEach(a=>{a.re.test(s)||(t+=1)}),Math.max(100-100/(we.length+1)*t,10)}function Ce({value:s,onChange:t}){const{t:a}=S(),[n,o]=j.useState(!1),l=we.map((d,p)=>e.jsx(Re,{label:d.label,meets:d.re.test(s)},p)),c=Ct(s),u=c===100?"teal":c>50?"yellow":"red";return e.jsxs(re,{opened:n,position:"bottom",width:"target",transitionProps:{transition:"pop"},children:[e.jsx(re.Target,{children:e.jsx("div",{onFocusCapture:()=>o(!0),onBlurCapture:()=>o(!1),children:e.jsx(Pe,{label:a("Password"),value:s,onChange:d=>t(d.currentTarget.value)})})}),e.jsxs(re.Dropdown,{children:[e.jsx(ts,{color:u,value:c,size:5,mb:"xs"}),e.jsx(Re,{label:a("Includes at least 8 characters"),meets:s.length>=8}),l]})]})}const yt=()=>{const{t:s}=S(),t=L(),{isLoggedIn:a,email:n,name:o,refreshToken:l}=M(p=>p.account),[c,u]=V.useState(void 0),d=async()=>{a&&(await fetch(ae+O.AUTH_LOGOUT,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({refreshToken:l})}),t(P()))};return e.jsxs(e.Fragment,{children:[e.jsxs(K,{py:"xs",align:"center",wrap:"wrap",children:[e.jsx(De,{size:"lg",name:o,color:"initials"}),e.jsxs(K,{direction:"column",ml:"xs",flex:1,children:[e.jsx(C,{span:!0,fw:"bold",children:o}),e.jsx(C,{span:!0,size:"sm",children:n})]}),e.jsxs(K,{ml:"auto",children:[e.jsx(U,{variant:"subtle",color:"gray",size:"sm",onClick:()=>u("name"),"aria-label":s("Change name"),title:s("Change name"),children:e.jsx(as,{})}),e.jsx(U,{variant:"subtle",color:"gray",size:"sm",onClick:()=>u("password"),"aria-label":s("Change password"),title:s("Change password"),children:e.jsx(os,{})}),e.jsx(U,{variant:"subtle",color:"gray",size:"sm",onClick:d,"aria-label":s("Log out"),title:s("Log out"),children:e.jsx(is,{})})]})]}),e.jsx(kt,{infoType:c,onClose:()=>u(void 0)})]})};function kt(s){const{infoType:t,onClose:a}=s,{t:n}=S(),o=L(),{isLoggedIn:l,id:c,token:u}=M(i=>i.account),[d,p]=V.useState(""),r=i=>o(D({title:n("Unable to update account info"),message:i,type:"error",duration:9e3})),x=async()=>{if(!(!l||!t))try{const i=await q(O.USER+"/"+c,{method:"PATCH",body:JSON.stringify({[t]:d})},u);if(!i){r(n("Login status expired")),o(P());return}if(i.status!==200){r(await i.text());return}if(t==="password"){o(P()),a();return}if(t==="name"){o(Us(d)),a();return}}catch(i){r(i.message)}};return e.jsxs(B,{opened:!!t,onClose:a,title:n("Update account info"),closeOnEscape:!1,children:[t==="name"&&e.jsx(Y,{label:n("Name"),value:d,onChange:({currentTarget:{value:i}})=>p(i)}),t==="password"&&e.jsx(Ce,{value:d,onChange:i=>p(i)}),e.jsx(N,{mt:"xs",children:e.jsx(w,{ml:"auto",onClick:x,children:n("Change")})})]})}const Mt=/^\S+@\S+\.\S+$/,ie=s=>!!s.match(Mt),qe=s=>s.length>=8&&!!s.match(/\d/)&&!!s.match(/[a-zA-Z]/),Le=60;function Ke({value:s,onChange:t,onVerify:a,otpSent:n,allowResendOtp:o,...l}){const{t:c}=S(),[u,d]=j.useState(!1),[p,r]=j.useState(Le),x=!!s&&ie(s),i=()=>{o&&(d(!0),r(Le)),a()};return j.useEffect(()=>{let b;return u&&p>0?b=window.setTimeout(()=>{r(p-1)},1e3):p===0&&d(!1),()=>clearTimeout(b)},[u,p]),e.jsx(Y,{type:"email",label:c("Email"),value:s,onChange:({currentTarget:{value:b}})=>t(b),error:s&&!ie(s),rightSection:n?e.jsx(w,{variant:"transparent",size:"xs",leftSection:e.jsx(Ne,{}),disabled:!0,children:c("Verification code sent")}):e.jsx(w,{variant:"subtle",size:"xs",onClick:i,disabled:!x||u,children:u?`${p}s`:c("Send verification code")}),rightSectionWidth:"fit-content",...l})}const At=s=>{const{t}=S(),a=L(),[n,o]=j.useState(""),[l,c]=j.useState(""),[u,d]=j.useState(""),[p,r]=j.useState(""),[x,i]=j.useState(!1),y=!!n&&ie(n)&&!!u&&!!l&&qe(l),v=A=>a(D({title:t("Unable to reset your password"),message:A,type:"error",duration:9e3})),k=async()=>{try{const A=await fetch(ae+O.AUTH_SEND_RESET_PASSWORD_EMAIL,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:n})});A.status===204?r(n):A.status>400&&r("error")}catch{r("error")}},h=async()=>{i(!0);const A=new URLSearchParams({token:u}),g=`${ae}${O.AUTH_RESET_PASSWORD}?${A.toString()}`;try{const m=await fetch(g,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({password:l})});if(m.status!==204){v(await m.text());return}const{error:F,username:W}=(await a(ve({email:n,password:l}))).payload;F?v(F):a(D({title:t("Welcome ")+W,message:t("Your password has been reset successfully."),type:"success",duration:5e3}))}catch(m){v(m.message)}finally{i(!1)}};return e.jsxs(I,{children:[e.jsx(E,{children:e.jsx(R,{order:3,size:"h5",children:t("Forgot password")})}),e.jsxs(te,{direction:"column",gap:"xs",children:[p==="error"&&e.jsx(ee,{color:"red",icon:e.jsx(ze,{}),title:t("Check your email again!")}),p&&p!=="error"&&e.jsx(ee,{color:"blue",icon:e.jsx(Se,{}),title:t("Email with reset link is sent to")+" "+p}),e.jsx(Ke,{value:n,onChange:o,onVerify:k,otpSent:p}),e.jsx(Y,{label:t("Reset password token"),value:u,onChange:({currentTarget:{value:A}})=>d(A)}),e.jsx(Ce,{value:l,onChange:c}),e.jsx(w,{onClick:h,loading:x,disabled:!y||x,children:t("Reset password")}),e.jsx(w,{variant:"default",onClick:()=>s.setLoginState("login"),disabled:x,children:t("Back to log in")})]})]})},Rt=/^\S+@\S+\.\S+$/,_e=s=>!!s.match(Rt),Lt=s=>{const{t}=S(),a=L(),[n,o]=j.useState(""),[l,c]=j.useState(""),[u,d]=j.useState(!1),p=!!n&&_e(n)&&!!l,r=async()=>{d(!0);try{const{error:x,username:i}=(await a(ve({email:n,password:l}))).payload;a(x?D({title:t("Unable to login"),message:x,type:"error",duration:9e3}):D({title:t("Welcome ")+i,message:t("Login success"),type:"success",duration:5e3}))}finally{d(!1)}};return e.jsxs(I,{children:[e.jsx(E,{children:e.jsx(R,{order:3,size:"h5",children:t("Log in")})}),e.jsxs(te,{direction:"column",gap:"xs",children:[e.jsx(Y,{type:"email",label:t("Email"),value:n,onChange:({currentTarget:{value:x}})=>o(x),error:n&&!_e(n)}),e.jsx(Pe,{label:t("Password"),value:l,onChange:({currentTarget:{value:x}})=>c(x)}),e.jsx(be,{component:"button",ml:"auto",onClick:()=>s.setLoginState("forgot-password"),children:t("Forgot password")+"?"}),e.jsx(w,{onClick:r,loading:u,disabled:!p||u,children:t("Log in")}),e.jsx(w,{variant:"default",onClick:()=>s.setLoginState("register"),disabled:u,children:t("Create an account")})]})]})},_t=s=>{const{t}=S(),a=L(),[n,o]=j.useState(""),[l,c]=j.useState(""),[u,d]=j.useState(""),[p,r]=j.useState(""),[x,i]=j.useState(""),[b,y]=j.useState(!1),v=!!l&&ie(l),k=!!n&&v&&!!p&&!!u&&qe(u),h=m=>a(D({title:t("Unable to create your account"),message:m,type:"error",duration:9e3})),A=async()=>{try{const m=await fetch(ae+O.AUTH_SEND_VERIFICATION_EMAIL,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:l})});m.status===204?i(l):m.status>400&&i("error")}catch{i("error")}},g=async()=>{y(!0);try{const m=await fetch(ae+O.AUTH_REGISTER,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({name:n,email:l,password:u,emailVerificationToken:Number(p)})});if(m.status!==201){h(await m.text());return}const{error:F,username:W}=(await a(ve({email:l,password:u}))).payload;F?h(F):a(D({title:t("Welcome ")+W,message:t("Your account is created successfully."),type:"success",duration:5e3}))}catch(m){h(m.message)}finally{y(!1)}};return e.jsxs(I,{children:[e.jsx(E,{children:e.jsx(R,{order:3,size:"h5",children:t("Create an account")})}),e.jsxs(te,{direction:"column",gap:"xs",children:[x==="error"&&e.jsx(ee,{color:"red",icon:e.jsx(ze,{}),title:t("The email is not valid!")}),x&&x!=="error"&&e.jsx(ee,{color:"blue",icon:e.jsx(Se,{}),title:t("Verification email is sent to")+" "+x}),e.jsx(Y,{label:t("Name"),description:t("You may always change it later."),value:n,onChange:({currentTarget:{value:m}})=>o(m)}),e.jsx(Ke,{description:t("We'll never share your email."),value:l,onChange:c,onVerify:A,otpSent:x,allowResendOtp:!0}),e.jsx(Y,{label:t("Verification code"),value:p,onChange:({currentTarget:{value:m}})=>r(m)}),e.jsx(Ce,{value:u,onChange:d}),e.jsx(w,{onClick:g,loading:b,disabled:!k||b,children:t("Sign up")}),e.jsx(w,{variant:"default",onClick:()=>s.setLoginState("login"),disabled:b,children:t("Back to log in")})]})]})},Ot=1,Tt=10,It=()=>{const{t:s}=S(),t=L(),{isLoggedIn:a,token:n,activeSubscriptions:o,currentSaveId:l,saves:c}=M(g=>g.account),{lastChangedAtTimeStamp:u}=M(g=>g.rmpSave),d=a&&c&&(o.RMP_CLOUD?c.length<Tt:c.length<Ot),p=Math.min(...(c??[]).map(g=>g.id)),r=g=>!o.RMP_CLOUD&&g!==p,[x,i]=V.useState(void 0),[b,y]=V.useState(void 0),v=g=>t(D({title:s("Unable to sync your save"),message:g,type:"error",duration:9e3})),k=async()=>{const g=await je(J.RMP);if(!a||!g||!n){v(s("Failed to get the RMP save!"));return}const{data:m,hash:F}=g,W=crypto.randomUUID();try{const G=await q(O.SAVES,{method:"POST",body:JSON.stringify({index:W,data:m,hash:F})},n);if(!G){v(s("Login status expired")),t(P());return}if(G.status!==200){v(await G.text());return}t(X())}catch(G){v(G.message)}},h=async g=>{if(!(!a||!n)){if(g===l){if(i(l),!l||r(l)){v(s("Can not sync this save!")),i(void 0);return}const m=await t(X());if(m.meta.requestStatus!=="fulfilled"){v(s("Login status expired")),i(void 0);return}const W=m.payload.saves.filter(Ze=>Ze.id===l).at(0);if(!W){v(s("Current save id is not in saveList!")),i(void 0);return}const G=new Date(W.lastUpdateAt);if(new Date(u)<G){he.warn(`Save id: ${l} is newer in the cloud via local compare.`),t(Fe()),i(void 0);return}const ye=await je(J.RMP);if(!ye){v(s("Failed to get the RMP save!")),i(void 0);return}const{data:Xe,hash:Qe}=ye,le=await q(O.SAVES+"/"+l,{method:"PATCH",body:JSON.stringify({data:Xe,hash:Qe})},n);if(!le){v(s("Login status expired")),i(void 0),t(P());return}if(le.status!==200){v(await le.text()),i(void 0);return}i(void 0)}else{i(g);const m=await q(O.SAVES+"/"+g,{},n);if(!m){v(s("Login status expired")),i(void 0),t(P());return}if(m.status!==200){v(await m.text()),i(void 0);return}he.info(`Set ${J.RMP} with save id: ${g}`),We(J.RMP,await m.text()),t(Ge(new Date().valueOf())),$e(),i(void 0)}t(X())}},A=async g=>{if(!a||!g||!n)return;y(g);const m=await q(O.SAVES+"/"+l,{method:"DELETE"},n);if(!m){v(s("Login status expired")),y(void 0),t(P());return}if(m.status!==200){v(await m.text()),y(void 0);return}t(X()),y(void 0)};return e.jsxs(I,{children:[e.jsxs(E,{align:"center",children:[e.jsx(R,{order:3,size:"h5",children:s("Synced saves")}),e.jsxs(C,{ml:"auto",size:"sm",children:[s("Maximum save count:")," ",o.RMP_CLOUD?10:1]}),e.jsx(w,{variant:"subtle",size:"xs",ml:"xs",disabled:!d,onClick:k,children:s("Create")})]}),e.jsx(te,{direction:"column",gap:"xs",children:c==null?void 0:c.map(g=>e.jsxs(H,{withBorder:!0,shadow:"sm",style:{flexDirection:"row"},children:[e.jsxs(_,{gap:"xs",flex:1,children:[e.jsx(C,{fw:500,children:g.id===l?s("Current save"):s("Cloud save")}),e.jsxs(C,{children:[s("Last update at:")," ",new Date(g.lastUpdateAt).toLocaleString()]})]}),e.jsxs(_,{gap:"xs",ml:"xs",children:[e.jsx(w,{variant:"filled",color:"red",loading:b===g.id,onClick:()=>A(g.id),children:s("Delete this save")}),e.jsx(w,{variant:"filled",disabled:r(g.id),loading:x===g.id,onClick:()=>h(g.id),children:g.id===l?s("Sync now"):s("Sync this slot")})]})]},g.id))})]})},Et=s=>{const{t}=S(),{opened:a,onClose:n,getSubscriptions:o}=s,{isLoggedIn:l,token:c}=M(i=>i.account),u=L(),[d,p]=V.useState(""),r=i=>u(D({title:t("Unable to redeem"),message:i,type:"error",duration:9e3})),x=async i=>{if(!l)return;const b=await q(O.SUBSCRIPTION_REDEEM,{method:"POST",body:JSON.stringify({cdkey:i.trim()})},c);if(!b){r(t("Login status expired")),u(P());return}if(b.status!==202){const y=(await b.json()).message;r(t(y));return}await o(),n()};return e.jsxs(B,{opened:a,onClose:n,title:t("Redeem your subscription"),children:[e.jsx(C,{children:t("CDKey could be purchased in the following sites:")}),e.jsx(z,{withPadding:!0,mt:"xs",children:e.jsx(z.Item,{children:e.jsxs(be,{href:"https://afdian.com/item/9c8b220c614311efab2d52540025c377",target:"_blank",children:["爱发电 ",e.jsx(Z,{})]})})}),e.jsxs(N,{align:"flex-end",gap:"sm",mt:"xs",children:[e.jsx(Y,{label:"CDKey",placeholder:t("Enter your CDKey here"),value:d,onChange:({currentTarget:{value:i}})=>p(i),style:{minWidth:240}}),e.jsx(w,{onClick:()=>x(d),children:t("Redeem")})]})]})},Pt=()=>{const{t:s}=S(),{isLoggedIn:t,token:a}=M(r=>r.account),n=L(),[o,l]=V.useState([]),[c,u]=V.useState(!1),d=r=>n(D({title:s("Unable to retrieve your subscriptions"),message:r,type:"error",duration:9e3})),p=async()=>{if(!t)return;const r=await q(O.SUBSCRIPTION,{},a);if(!r){d(s("Login status expired")),n(P());return}if(r.status!==200){d(await r.text());return}const x=(await r.json()).subscriptions;if(!x.map(b=>b.type).includes("RMP_CLOUD"))return;l([{type:"RMP",expires:x[0].expires}]);const i=structuredClone(Vs);for(const b of x){const y=b.type;y in i&&(i[y]=!0)}n(Bs(i))};return V.useEffect(()=>{p()},[]),e.jsxs(I,{children:[e.jsxs(E,{align:"center",children:[e.jsx(R,{order:3,size:"h5",children:s("All subscriptions")}),e.jsx(w,{variant:"subtle",size:"xs",ml:"auto",onClick:()=>u(!0),children:s("Redeem")})]}),e.jsxs(te,{direction:"column",gap:"xs",children:[o.length===0&&e.jsxs(H,{withBorder:!0,shadow:"sm",children:[e.jsx(H.Section,{p:"xs",children:e.jsx(R,{order:4,size:"h3",children:s("Rail Map Painter")})}),e.jsxs(_,{gap:"xs",children:[e.jsx(C,{children:s("With this subscription, the following features are unlocked:")}),e.jsxs(z,{withPadding:!0,children:[e.jsx(z.Item,{children:s("PRO features")}),e.jsx(z.Item,{children:s("Sync 9 more saves")}),e.jsx(z.Item,{children:s("Unlimited master nodes")}),e.jsx(z.Item,{children:s("Unlimited parallel lines")})]}),e.jsxs(C,{children:[s("Expires at:")," ",s("Not applicable")]})]})]}),o.map(r=>e.jsxs(H,{withBorder:!0,shadow:"sm",children:[e.jsx(H.Section,{p:"xs",children:e.jsx(R,{order:4,size:"h3",children:s(r.type==="RMP"?"Rail Map Painter":r.type)})}),e.jsxs(_,{gap:"xs",children:[e.jsxs(C,{children:[s("Expires at:")," ",new Date(r.expires).toLocaleString()]}),e.jsx(w,{color:"blue",onClick:()=>u(!0),children:s("Renew")})]})]},r.type))]}),e.jsx(Et,{opened:c,onClose:()=>u(!1),getSubscriptions:p})]})},Nt=()=>{const{t:s}=S(),{isLoggedIn:t}=M(o=>o.account),[a,n]=j.useState("login");return e.jsxs(I,{children:[e.jsx(E,{children:e.jsx(R,{order:2,size:"h4",children:s("Account")})}),t?e.jsxs(te,{className:vt.body,children:[e.jsx(yt,{}),e.jsx(xe,{}),e.jsx(Pt,{}),e.jsx(It,{})]}):a==="login"?e.jsx(Lt,{setLoginState:n}):a==="register"?e.jsx(_t,{setLoginState:n}):e.jsx(At,{setLoginState:n})]})},Dt="_button_1hzui_1",zt="_label_1hzui_11",Q={button:Dt,label:zt,"sub-label":"_sub-label_1hzui_17"};function Ut(s){var k;const{appId:t,onAboutOpen:a}=s,{t:n}=S(),o=L(),l=ls("(min-width: 36em)"),{activeTab:c,openedTabs:u}=M(h=>h.app),d=se[t],p=d.name.split(" - ").map(h=>n(h)).join(" - "),r=u.some(h=>h.app===t),x=!d.allowMultiInstances&&((k=u.find(h=>h.id===c))==null?void 0:k.app)===t,i=h=>{r||f.event(T.OPEN_APP,{appId:t,isOpenInNew:h}),o(h?Fs(t):me({appId:t})),l||(o(fe()),f.toggleNavMenu(!1))},b=h=>{o(Ws(h)),l||(o(fe()),f.toggleNavMenu(!1))},y=h=>{o($s(h)),f.event(T.CLOSE_APP,{app:t})},v=h=>{o(Gs(h)),f.event(T.CLOSE_APP,{app:h})};return e.jsx(ge,{component:"div",role:"button",variant:"filled",label:p,active:x,classNames:{root:Q.button,label:Q.label},leftSection:r?e.jsx(us,{title:n("Running")}):void 0,rightSection:e.jsxs(e.Fragment,{children:[d.allowMultiInstances&&e.jsx(U,{"aria-label":n("New tab"),title:n("New tab"),variant:"subtle",color:x?"white":"gray",mr:4,onClick:h=>{h.stopPropagation(),i(!0)},children:e.jsx(rs,{})}),e.jsxs(ne,{children:[e.jsx(ne.Target,{children:e.jsx(U,{variant:"subtle",color:x?"white":"gray",onClick:h=>h.stopPropagation(),children:e.jsx(cs,{})})}),e.jsxs(ne.Dropdown,{children:[r&&e.jsx(ne.Item,{leftSection:e.jsx(pe,{}),onClick:h=>{h.stopPropagation(),v(t)},children:d.allowMultiInstances?n("Close all tabs"):n("Close app")}),e.jsx(ne.Item,{leftSection:e.jsx(ds,{}),onClick:h=>{h.stopPropagation(),a()},children:n("About")})]})]})]}),disableRightSectionRotation:!0,opened:!0,onClick:()=>i(!1),children:d.allowMultiInstances&&u.filter(h=>h.app===t).map((h,A)=>{const g=h.id===c;return e.jsx(ge,{component:"div",role:"button",variant:"filled",active:g,label:e.jsxs(e.Fragment,{children:[e.jsx(Ue,{color:"lightgray",c:"black",mr:"xs",circle:!0,display:"inline-flex",children:A+1}),h.title??n("Tab")+" "+(A+1).toString()+" - "+p]}),classNames:{root:Q.button,label:Q["sub-label"]},rightSection:e.jsx(U,{variant:"subtle",color:g?"white":"gray","aria-label":n("Close tab"),title:n("Close tab"),onClick:m=>{m.stopPropagation(),y(h.id)},children:e.jsx(pe,{})}),onClick:()=>b(h.id)},h.id)})})}const Vt=async s=>{const t=`/${s}/info.json`;try{return(await(await fetch(t)).json()).version}catch(a){return he.info(`Failed to get version of ${s}`,a),"unknown"}};function Bt(s){var u,d,p;const{appId:t,onClose:a}=s,{t:n}=S(),[o,l]=j.useState("Unknown"),c=t?(p=(d=(u=se[t])==null?void 0:u.url)==null?void 0:d.split("/"))==null?void 0:p[1]:void 0;return j.useEffect(()=>{c?Vt(c).then(r=>l(r)):l("Unknown")},[c]),e.jsx(B,{opened:!!t,onClose:a,size:"xl",title:e.jsxs(e.Fragment,{children:[n("About")+" "+(t?se[t].name.split(" - ").map(r=>n(r)).join(" - "):""),e.jsx(Ue,{color:"gray",radius:"sm",ml:"xs",children:o})]}),children:e.jsx(w,{component:"a",href:"https://github.com/railmapgen/"+c,target:"_blank",children:n("Visit GitHub")})})}function Oe({assetType:s}){const{t}=S(),[a,n]=j.useState(),o=Je(s,f.getEnv(),f.getInstance());return e.jsxs(I,{children:[e.jsx(E,{children:e.jsx(R,{order:2,size:"h4",children:t(s==="devtool"?"Devtools":"Apps")})}),e.jsx(K,{direction:"column",children:o.map(l=>e.jsx(Ut,{appId:l,onAboutOpen:()=>n(l)},l))}),e.jsx(Bt,{appId:a,onClose:()=>n(void 0)})]})}function Ft(){const{t:s}=S(),t=Je("link",f.getEnv(),f.getInstance()),a=n=>{f.event(T.OPEN_LINK,{id:n})};return e.jsxs(I,{children:[e.jsx(E,{children:e.jsx(R,{order:2,size:"h4",children:s("Useful links")})}),e.jsx(K,{direction:"column",children:t.map(n=>e.jsx(ge,{variant:"filled",label:s(se[n].name),classNames:{root:Q.button,label:Q.label},rightSection:e.jsx(Z,{}),href:se[n].url,target:"_blank",onClick:()=>a(n)},n))})]})}const Te={"textarea-label":"_textarea-label_kau51_1","textarea-input":"_textarea-input_kau51_5"};function Wt(s){var d;const{opened:t,onClose:a}=s,{t:n}=S(),[o,l]=j.useState(),c=Object.entries(localStorage),u=()=>{o&&(window.localStorage.removeItem(o),window.location.reload())};return e.jsxs(B,{opened:t,onClose:a,size:"xl",title:n("Local Storage"),children:[e.jsx(_,{gap:"xs",children:c.map(p=>e.jsx(ps,{label:e.jsxs(N,{align:"center",gap:"xs",children:[p[0],e.jsx(U,{variant:"default",size:"xs",title:n("Remove this item"),"aria-label":n("Remove this item"),onClick:()=>l(p[0]),children:e.jsx(hs,{})})]}),value:p[1],readOnly:!0,rows:4,classNames:{label:Te["textarea-label"],input:Te["textarea-input"]}},p[0]))}),e.jsx(N,{pt:"xs",children:e.jsx(w,{ml:"auto",onClick:a,children:n("Go back")})}),o&&e.jsxs(B,{opened:!0,onClose:()=>l(void 0),centered:!0,title:n("Warning"),children:[e.jsxs(C,{children:[n("LocalStorageModal.text1"),e.jsx(xs,{children:o}),n("LocalStorageModal.text2"),e.jsx(C,{span:!0,fw:500,children:n(((d=se[o.split("__")[0]])==null?void 0:d.name)??"Unknown app")}),n("LocalStorageModal.text3"),e.jsx("br",{}),n("LocalStorageModal.text4")]}),e.jsxs(N,{gap:"xs",mt:"xs",children:[e.jsx(w,{variant:"default",ml:"auto",onClick:()=>l(void 0),children:n("Back")}),e.jsx(w,{color:"red",onClick:u,children:n("Delete and reload")})]})]})]})}function Ye(s){const{t}=S(),a=[{group:t("Main languages"),items:Zs.map(n=>({value:n,label:ce[n][n]}))},{group:t("Other languages"),items:et.map(n=>({value:n,label:ce[n][n]??ce[n].en}))}];return e.jsx(gs,{label:t("Language"),defaultValue:f.getLanguage(),onChange:({currentTarget:{value:n}})=>{const o=n;f.setLanguage(o),f.getI18nInstance().changeLanguage(o),f.event(T.CHANGE_LANGUAGE,{language:o})},data:a,...s})}function $t(){const{t:s}=S(),{setColorScheme:t}=ms(),a=L(),{lastShowDevtools:n,refreshRequired:o}=M(i=>i.app),[l,c]=j.useState(f.isAllowAnalytics()),[u,d]=j.useState(!1),p=He(n),r=i=>{c(i),f.allowAnalytics(i).refreshRequired&&a(qs())},x=[{value:"light",label:s("Light")},{value:"dark",label:s("Dark")},{value:"system",label:s("System")}];return e.jsxs(I,{children:[o&&e.jsx(ee,{color:"blue",icon:e.jsx(Se,{}),mb:"xs",children:s("Refreshing is required for changes to take effect.")}),e.jsx(E,{children:e.jsx(R,{order:2,size:"h4",children:s("Settings")})}),e.jsxs(_,{gap:"xs",py:"xs",children:[e.jsx(Ye,{}),e.jsx(js,{size:"sm",label:s("Appearance"),defaultValue:f.getColourMode(),onChange:i=>{t(i==="system"?"auto":i),f.setColourMode(i)},data:x}),e.jsx(ke,{label:s("Allow cookies to help improve our website"),labelPosition:"left",checked:l,onChange:({currentTarget:{checked:i}})=>r(i),disabled:o,styles:{labelWrapper:{flex:1}}}),e.jsx(ke,{label:s("Show dev tools for 1 day"),labelPosition:"left",checked:p,onChange:({currentTarget:{checked:i}})=>{i?(a(Hs()),f.event(T.SHOW_DEVTOOLS)):a(Js())},styles:{labelWrapper:{flex:1}}}),p&&e.jsx(w,{variant:"default",leftSection:e.jsx(fs,{}),onClick:()=>d(!0),children:s("Export Local Storage")})]}),p&&e.jsx(Wt,{opened:u,onClose:()=>d(!1)})]})}function Gt(){const{t:s}=S(),{remoteFonts:t}=M(a=>a.app);return e.jsxs(I,{children:[e.jsx(E,{children:e.jsx(R,{order:2,size:"h4",children:s("Web fonts")})}),e.jsxs(_,{gap:"xs",children:[e.jsxs(C,{fs:"italic",children:[s("FontsSection.text1")," ",s("FontsSection.text2")," ",s("FontsSection.text3")," (",s("FontsSection.safari"),")"]}),Object.entries(t).map(([a,n])=>e.jsx(w,{variant:"default",rightSection:n.url?e.jsx(Z,{}):void 0,disabled:!n.url,onClick:()=>{window.open(n.url,"_blank"),f.event(T.DOWNLOAD_FONT,{family:a})},children:n.displayName?`${n.displayName} (${a})`:a},a))]})]})}const Ht="_bilibili_5ep1h_1",Jt={bilibili:Ht};function qt(s){return Ve({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 32C132.3 32 32 134.9 32 261.7c0 101.5 64.2 187.5 153.2 217.9a17.56 17.56 0 0 0 3.8.4c8.3 0 11.5-6.1 11.5-11.4 0-5.5-.2-19.9-.3-39.1a102.4 102.4 0 0 1-22.6 2.7c-43.1 0-52.9-33.5-52.9-33.5-10.2-26.5-24.9-33.6-24.9-33.6-19.5-13.7-.1-14.1 1.4-14.1h.1c22.5 2 34.3 23.8 34.3 23.8 11.2 19.6 26.2 25.1 39.6 25.1a63 63 0 0 0 25.6-6c2-14.8 7.8-24.9 14.2-30.7-49.7-5.8-102-25.5-102-113.5 0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8a18.64 18.64 0 0 1 5-.5c8.1 0 26.4 3.1 56.6 24.1a208.21 208.21 0 0 1 112.2 0c30.2-21 48.5-24.1 56.6-24.1a18.64 18.64 0 0 1 5 .5c12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6 0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5 0 30.7-.3 55.5-.3 63 0 5.4 3.1 11.5 11.4 11.5a19.35 19.35 0 0 0 4-.4C415.9 449.2 480 363.1 480 261.7 480 134.9 379.7 32 256 32z"},child:[]}]})(s)}function Kt(s){return Ve({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M126.12 315.1A47.06 47.06 0 1 1 79.06 268h47.06zm23.72 0a47.06 47.06 0 0 1 94.12 0v117.84a47.06 47.06 0 1 1-94.12 0zm47.06-188.98A47.06 47.06 0 1 1 244 79.06v47.06zm0 23.72a47.06 47.06 0 0 1 0 94.12H79.06a47.06 47.06 0 0 1 0-94.12zm188.98 47.06a47.06 47.06 0 1 1 47.06 47.1h-47.06zm-23.72 0a47.06 47.06 0 0 1-94.12 0V79.06a47.06 47.06 0 1 1 94.12 0zM315.1 385.88a47.06 47.06 0 1 1-47.1 47.06v-47.06zm0-23.72a47.06 47.06 0 0 1 0-94.12h117.84a47.06 47.06 0 1 1 0 94.12z"},child:[]}]})(s)}function Yt(){const{t:s}=S();return e.jsxs(I,{children:[e.jsx(E,{children:e.jsx(R,{order:2,size:"h4",children:s("Help & support")})}),e.jsxs(_,{gap:"xs",children:[e.jsx(w,{variant:"default",leftSection:e.jsx(qt,{}),rightSection:e.jsx(Z,{}),onClick:()=>{window.open("https://github.com/railmapgen/railmapgen.github.io/issues","_blank"),f.event(T.RAISE_ISSUE)},children:s("Raise an Issue on GitHub")}),e.jsx(w,{variant:"default",leftSection:e.jsx(Kt,{}),rightSection:e.jsx(Z,{}),onClick:()=>{window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),f.event(T.JOIN_SLACK)},children:s("Join us on Slack")}),e.jsx(w,{variant:"default",leftSection:e.jsx(ue,{className:Jt.bilibili,src:"images/bilibili.svg"}),rightSection:e.jsx(Z,{}),onClick:()=>{window.open("https://space.bilibili.com/10124055","_blank"),f.event(T.FOLLOW_BILIBILI)},children:s("Follow us on Bilibili")})]})]})}function Xt(){const{t:s}=S(),{isShowMenu:t,menuView:a,lastShowDevtools:n}=M(r=>r.app),{isLoggedIn:o,name:l}=M(r=>r.account),c=L(),[u]=Be(),d=(f.getInstance()==="GitLab"?"https://railmapgen.gitlab.io/":"https://railmapgen.github.io/")+"?"+u.toString();j.useEffect(()=>{o&&c(X())},[o]);const p=[{key:"apps",label:s("Apps"),Icon:e.jsx(ws,{size:22})},{key:"links",label:s("Useful links"),Icon:e.jsx(Ss,{size:22})},{key:"devtools",label:s("Devtools"),Icon:e.jsx(bs,{size:22}),ActionIconProps:{style:{display:He(n)?"inline-flex":"none"}}},{key:"account",label:s("Account"),Icon:e.jsx(De,{variant:"light",name:o?l:void 0,size:"sm",color:"initials"}),ActionIconProps:{mt:"auto"}},{key:"contributors",label:s("Contributors"),Icon:e.jsx(vs,{size:22}),ActionIconProps:{onClick:()=>c(Ks("contributors"))}},{key:"support",label:s("Help & support"),Icon:e.jsx(Cs,{size:22})},{key:"settings",label:s("Settings"),Icon:e.jsx(ys,{size:22})}];return e.jsx("nav",{className:Ee($.root,t&&$["show-menu"]),children:e.jsxs("div",{className:$.wrapper,children:[e.jsxs(ks,{className:$.header,children:[e.jsx(R,{children:s("Rail Map Toolkit")}),e.jsx(Ms,{env:f.getEnv(),ver:f.getAppVersion()})]}),e.jsx(xe,{}),f.getEnv()!=="PRD"&&e.jsxs(ee,{color:"yellow",icon:e.jsx(As,{}),className:$.alert,children:[s("You're currently viewing a testing environment.")," ",e.jsx(be,{size:"sm",href:d,target:"_blank",children:s("Back to production environment")})]}),e.jsxs("div",{className:$.body,children:[e.jsx("div",{className:$.aside,children:p.map(({key:r,label:x,Icon:i,ActionIconProps:b})=>e.jsx(Rs,{label:x,position:"right",withArrow:!0,children:e.jsx(U,{variant:a===r?"light":"subtle",color:a===r?void 0:"gray",size:"lg",onClick:()=>c(Ys(r)),...b,children:i})},r))}),e.jsx(xe,{orientation:"vertical"}),e.jsxs("div",{className:$.main,children:[a==="apps"?e.jsx(Oe,{assetType:"app"}):a==="links"?e.jsx(Ft,{}):a==="devtools"?e.jsx(Oe,{assetType:"devtool"}):a==="settings"?e.jsx($t,{}):a==="support"?e.jsxs(e.Fragment,{children:[e.jsx(Yt,{}),e.jsx(Gt,{})]}):a==="account"?e.jsx(Nt,{}):e.jsx(e.Fragment,{}),e.jsx(St,{})]})]})]})})}function Qt(s){const{opened:t,onClose:a}=s,{t:n}=S(),o=()=>{f.allowAnalytics(!0),a()},l=()=>{f.allowAnalytics(!1).refreshRequired?window.location.reload():a()};return e.jsxs(B,{opened:t,onClose:()=>{},title:n("CookiesModal.header"),withCloseButton:!1,closeOnEscape:!1,closeOnClickOutside:!1,centered:!0,children:[e.jsx(N,{children:e.jsx(Ye,{ml:"auto"})}),e.jsxs(_,{gap:"xs",py:"xs",children:[e.jsx(C,{children:n("CookiesModal.text1")}),e.jsx(C,{mt:2,children:n("CookiesModal.text2")}),e.jsx(z,{withPadding:!0,children:e.jsxs(z.Item,{children:[" ",n("CookiesModal.item1")]})}),e.jsx(C,{mt:2,children:n("CookiesModal.text3")})]}),e.jsxs(N,{gap:"sm",children:[e.jsx(w,{variant:"default",ml:"auto",onClick:l,children:n("CookiesModal.reject")}),e.jsx(w,{onClick:o,children:n("CookiesModal.accept")})]})]})}const Zt=()=>{};function en(){const{t:s}=S(),[t,a]=j.useState(!1),n=()=>{a(!0),Xs(),setTimeout(()=>{window.location.reload()},1e3)};return e.jsxs(B,{opened:!0,onClose:Zt,title:s("Rail Map Toolkit is opened in another window"),withCloseButton:!1,closeOnEscape:!1,closeOnClickOutside:!1,centered:!0,children:[e.jsx(C,{children:s("You cannot open multiple Rail Map Toolkit at the same time. Please close this window.")}),e.jsx(N,{mt:"xs",children:e.jsx(w,{variant:"default",onClick:n,loading:t,disabled:t,children:s("Restart RMT in this window")})})]})}const sn=()=>{};function tn(){const{t:s}=S();return e.jsx(B,{opened:!0,onClose:sn,title:s("Rail Map Toolkit is opened in another window"),withCloseButton:!1,closeOnEscape:!1,closeOnClickOutside:!1,centered:!0,children:e.jsx(C,{children:s("Current session has been terminated. Please close this window.")})})}const nn="_root_nos1z_1",an={root:nn},on={info:void 0,success:"green",warning:"yellow",error:"red"},de=200,Ie=400;function ln({notification:s}){const t=L(),[a,n]=j.useState(!1);return j.useEffect(()=>{setTimeout(()=>{n(!0)},de);const o=setTimeout(()=>{n(!1)},de+s.duration);return setTimeout(()=>{t(Qs(s.id))},de+s.duration+Ie),()=>{clearTimeout(o)}},[]),e.jsx(Ls,{mounted:a,transition:"slide-left",duration:Ie,timingFunction:"ease",children:o=>e.jsx(_s,{color:on[s.type],title:s.title,onClose:()=>n(!1),withBorder:!0,style:o,children:s.message})})}function rn(){const{notifications:s}=M(t=>t.notification);return e.jsx(Os,{children:e.jsx(_,{className:an.root,children:s.map(t=>e.jsx(ln,{notification:t},t.id))})})}function gn(){const{t:s}=S(),t=L(),{isPrimary:a,isTerminated:n,isShowMenu:o}=M(d=>d.app),[l,c]=j.useState(!1);j.useEffect(()=>{f.isAnalyticsQADone()||c(!0)},[]);const u=()=>{f.toggleNavMenu(!o),t(fe()),f.event(T.TOGGLE_NAV_MENU)};return e.jsx(Ps,{basename:"/",children:e.jsxs(Ts,{className:o?"show-menu":"",children:[e.jsx(U,{className:tt.burger,variant:o?"subtle":"filled",color:o?"gray":void 0,"aria-label":s("Toggle menu"),title:s("Toggle menu"),onClick:u,children:e.jsx(Is,{})}),e.jsxs(Es,{direction:"row",children:[e.jsx(Xt,{}),e.jsx(dt,{alwaysShowWelcome:n||a===!1})]}),e.jsx(rn,{}),n&&e.jsx(tn,{}),a===!1&&e.jsx(en,{}),e.jsx(Qt,{opened:l,onClose:()=>c(!1)})]})})}export{gn as default};

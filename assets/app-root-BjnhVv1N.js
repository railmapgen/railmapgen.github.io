import{j as e,aq as xe,a as ee,ar as Ne,H as y,T as b,B as ae,as as P,at as K,F as T,au as ne,af as he,av as I,b as g,aw as q,Z as ie,ax as X,$ as Y,a0 as ge,a1 as Q,a2 as se,a6 as re,a7 as ce,a9 as Ee,aa as G,ab as $,I as Xe,e as V,g as Ye,ay as Ve,az as ye,aA as Me,aB as Qe,a4 as hs,aC as Le,aD as te,a5 as Ze,aE as us,aF as Be,D as Re,ae as ps,am as xs,aG as Fe,aH as gs,aI as js,aJ as ms,aK as Ue,Q as es,aL as ve,aM as ke,W as Ie,k as Pe,P as fs,l as ws,m as vs,R as ks,U as Ss,V as bs,X as Cs,aN as zs,aO as ys,aP as Se,N as Ms}from"./chakra-I2PZeTsG.js";import{m as w,r as C,n as ss,b as z,B as Rs}from"./react-BlkKGiDP.js";import{F as As,u as H,a as O,f as me,g as fe,S as N,b as F,A as L,s as U,c as Ae,n as Te,d as we,e as ue,l as ts,h as Ts,i as Oe,j as Hs,k as Es,m as J,E as B,o as Ls,p as Is,t as He,q as Ps,r as Os,v as Ds,w as ns,x as be,y as _s,L as Ns,N as Vs,z as as,B as Bs,C as Fs,D as Us,G as Gs}from"./main-C84_A4wm.js";import{l as oe,f as R,i as $s,e as E,r as S,b as os,j as Ws,u as Js,k as Ks,g as Ce,h as qs}from"./index-CDs_GfXC.js";import{R as is}from"./rmg-fields-4lLcYL6w.js";var Xs=["en","zh-Hans","zh-Hant"],Ys=["ja","ko"],Ge={ar:{ar:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",en:"Arabic",ko:"ì•„ëžì–´","zh-Hans":"é˜¿æ‹‰ä¼¯æ–‡","zh-Hant":"é˜¿æ‹‰ä¼¯æ–‡"},az:{az:"AzÉ™rbaycanca",en:"Azerbaijani",ko:"ì•„ì œë¥´ë°”ì´ìž”ì–´","zh-Hans":"é˜¿å¡žæ‹œç–†æ–‡","zh-Hant":"é˜¿å¡žæ‹œç–†æ–‡"},ca:{ca:"CatalÃ ",en:"Catalan",ko:"ì¹´íƒˆë£¨ëƒì–´","zh-Hans":"åŠ æ³°ç½—å°¼äºšæ–‡","zh-Hant":"åŠ æ³°éš†å°¼äºžæ–‡"},da:{da:"Dansk",en:"Danish",ko:"ë´ë§ˆí¬ì–´","zh-Hans":"ä¸¹éº¦æ–‡","zh-Hant":"ä¸¹éº¥æ–‡"},de:{de:"Deutsch",en:"German",ko:"ë…ì¼ì–´","zh-Hans":"å¾·æ–‡","zh-Hant":"å¾·æ–‡"},el:{el:"Î•Î»Î»Î·Î½Î¹ÎºÎ¬",en:"Greek",ko:"ê·¸ë¦¬ìŠ¤ì–´","zh-Hans":"å¸Œè…Šæ–‡","zh-Hant":"å¸Œè‡˜æ–‡"},en:{en:"English",ja:"è‹±èªž",ko:"ì˜ì–´","zh-Hans":"è‹±æ–‡","zh-Hant":"è‹±æ–‡"},es:{en:"Spanish",es:"EspaÃ±ol",ko:"ìŠ¤íŽ˜ì¸ì–´","zh-Hans":"è¥¿ç­ç‰™æ–‡","zh-Hant":"è¥¿ç­ç‰™æ–‡"},fa:{en:"Persian",fa:"ÙØ§Ø±Ø³ÛŒ",ko:"íŽ˜ë¥´ì‹œì•„ì–´","zh-Hans":"æ³¢æ–¯æ–‡","zh-Hant":"æ³¢æ–¯æ–‡"},fr:{en:"French",fr:"FranÃ§ais",ko:"í”„ëž‘ìŠ¤ì–´","zh-Hans":"æ³•æ–‡","zh-Hant":"æ³•æ–‡"},ga:{en:"Irish",ga:"Gaeilge",ko:"ì•„ì¼ëžœë“œì–´","zh-Hans":"çˆ±å°”å…°æ–‡","zh-Hant":"æ„›çˆ¾è˜­æ–‡"},gd:{en:"Scottish Gaelic",gd:"GÃ idhlig",ko:"ìŠ¤ì½”í‹€ëžœë“œ ê²Œì¼ì–´","zh-Hans":"è‹æ ¼å…°ç›–å°”æ–‡","zh-Hant":"è˜‡æ ¼è˜­è“‹çˆ¾æ–‡"},hi:{en:"Hindi",hi:"à¤¹à¤¿à¤¨à¥à¤¦à¥€",ko:"ížŒë””ì–´","zh-Hans":"å°åœ°æ–‡","zh-Hant":"å°åœ°æ–‡"},hu:{en:"Hungarian",hu:"Magyar",ko:"í—ê°€ë¦¬ì–´","zh-Hans":"åŒˆç‰™åˆ©æ–‡","zh-Hant":"åŒˆç‰™åˆ©æ–‡"},id:{en:"Indoesian",id:"Bahasa Indonesia",ko:"ì¸ë„ë„¤ì‹œì•„ì–´","zh-Hans":"å°å°¼æ–‡","zh-Hant":"å°å°¼æ–‡"},it:{en:"Italian",it:"Italiano",ko:"ì´íƒˆë¦¬ì•„ì–´","zh-Hans":"æ„å¤§åˆ©æ–‡","zh-Hant":"æ„å¤§åˆ©æ–‡"},ja:{en:"Japanese",ja:"æ—¥æœ¬èªž",ko:"ì¼ë³¸ì–´","zh-Hans":"æ—¥æ–‡","zh-Hant":"æ—¥æ–‡"},kk:{en:"Kazakh",kk:"ÒšÐ°Ð·Ð°Ò›ÑˆÐ°",ko:"ì¹´ìžíì–´","zh-Hans":"å“ˆè¨å…‹æ–‡","zh-Hant":"å“ˆè–©å…‹æ–‡"},ko:{en:"Korean",ja:"éŸ“å›½èªž",ko:"í•œêµ­ì–´","zh-Hans":"éŸ©æ–‡","zh-Hant":"éŸ“æ–‡"},ms:{en:"Malay",ko:"ë§ë ˆì´ì–´",ms:"Bahasa Melayu","zh-Hans":"é©¬æ¥æ–‡","zh-Hant":"é¦¬ä¾†æ–‡"},no:{en:"Norwegian",ko:"ë…¸ë¥´ì›¨ì´ì–´",no:"Norsk","zh-Hans":"æŒªå¨æ–‡","zh-Hant":"æŒªå¨æ–‡"},pl:{en:"Polish",ko:"í´ëž€ë“œì–´",pl:"Polski","zh-Hans":"æ³¢å…°æ–‡","zh-Hant":"æ³¢è˜­æ–‡"},pt:{en:"Portuguese",ko:"í¬ë¥´íˆ¬ê°ˆì–´",pt:"PortuguÃªs","zh-Hans":"è‘¡è„ç‰™æ–‡","zh-Hant":"è‘¡è„ç‰™æ–‡"},ro:{en:"Romanian",ko:"ë£¨ë§ˆë‹ˆì•„ì–´",ro:"RomÃ¢nÄƒ","zh-Hans":"ç½—é©¬å°¼äºšæ–‡","zh-Hant":"ç¾…é¦¬å°¼äºžæ–‡"},ru:{en:"Russian",ko:"ëŸ¬ì‹œì•„ì–´",ru:"Ð ÑƒÑÑÐºÐ¸Ð¹","zh-Hans":"ä¿„æ–‡","zh-Hant":"ä¿„æ–‡"},sv:{en:"Swedish",ko:"ìŠ¤ì›¨ë´ì–´",sv:"Svenska","zh-Hans":"ç‘žå…¸æ–‡","zh-Hant":"ç‘žå…¸æ–‡"},th:{en:"Thai",ko:"íƒœêµ­ì–´",th:"à¸ à¸²à¸©à¸²à¹„à¸—à¸¢","zh-Hans":"æ³°æ–‡","zh-Hant":"æ³°æ–‡"},tr:{en:"Turkish",ko:"íŠ€ë¥´í‚¤ì˜ˆì–´",tr:"TÃ¼rkÃ§e","zh-Hans":"åœŸè€³å…¶æ–‡","zh-Hant":"åœŸè€³å…¶æ–‡"},uk:{en:"Ukrainian",ko:"ìš°í¬ë¼ì´ë‚˜ì–´",uk:"Ð£ÐºÑ€Ð°Ñ—Ð½ÑÑŒÐºÐ°","zh-Hans":"ä¹Œå…‹å…°æ–‡","zh-Hant":"çƒå…‹è˜­æ–‡"},ur:{en:"Urdo",ko:"ìš°ë¥´ë‘ì–´",ur:"Ø§Ø±Ø¯Ùˆ","zh-Hans":"ä¹Œå°”éƒ½æ–‡","zh-Hant":"çƒçˆ¾éƒ½æ–‡"},uz:{en:"Uzbek",ko:"ìš°ì¦ˆë² í¬ì–´",uz:"OÊ»zbekcha","zh-Hans":"ä¹Œå…¹åˆ«å…‹æ–‡","zh-Hant":"çƒèŒ²åˆ¥å…‹æ–‡"},vi:{en:"Vietnamese",ko:"ë² íŠ¸ë‚¨ì–´",vi:"Tiáº¿ng Viá»‡t","zh-Hans":"è¶Šå—æ–‡","zh-Hant":"è¶Šå—æ–‡"},"zh-Hans":{en:"Simplified Chinese",ja:"ä¸­å›½èªžï¼ˆç°¡ä½“å­—ï¼‰",ko:"ì¤‘êµ­ì–´ ê°„ì²´ìž","zh-Hans":"ç®€ä½“ä¸­æ–‡","zh-Hant":"ç°¡é«”ä¸­æ–‡"},"zh-Hant":{en:"Traditional Chinese",ja:"ä¸­å›½èªžï¼ˆç¹ä½“å­—ï¼‰",ko:"ì¤‘êµ­ì–´ ì •ì²´ìž","zh-Hans":"ç¹ä½“ä¸­æ–‡","zh-Hant":"ç¹é«”ä¸­æ–‡"}};const Qs="/assets/rmp-logo512-eHekupnf.png",Zs={flex:1,justifyContent:"center",mb:10,"& > div":{mb:3},"& img":{w:120,p:2,backgroundColor:"white",borderRadius:12}};function et(){const{t}=w();return e.jsxs(xe,{sx:Zs,children:[e.jsxs(ee,{spacing:3,children:[e.jsx(Ne,{src:"/logo512.png"}),e.jsx(Ne,{src:Qs,backgroundColor:"white"})]}),e.jsx(y,{children:t("Welcome to Rail Map Toolkit")}),e.jsx(b,{fontSize:"lg",textAlign:"center",children:t("Select an app to start your own rail map design!")})]})}function st(t){const{tab:s,isActive:n}=t,a=C.useMemo(()=>{var o;return(o=s.url)!=null?o:"/"+s.app+"/"},[s.url,s.app]);return e.jsx(ae,{display:n?"block":"none",flex:1,children:e.jsx("iframe",{id:As+s.id,src:a,loading:"lazy",title:s.app,width:"100%",height:"100%"})})}function tt(){const{openedTabs:t,activeTab:s}=H(a=>a.app),[,n]=ss();return C.useEffect(()=>{var a;if(s){const o=(a=t.find(i=>i.id===s))==null?void 0:a.app;n(o?{app:o}:{})}else n({})},[s]),t.length===0?e.jsx(et,{}):e.jsx(e.Fragment,{children:t.map(a=>e.jsx(st,{tab:a,isActive:s===a.id},a.id))})}function nt(t){return P({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"},child:[]}]})(t)}function at(t){return P({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M11 7h2v2h-2V7zm0 4h2v6h-2v-6zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"},child:[]}]})(t)}function pe(t){return P({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 19H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"},child:[]}]})(t)}function ot(t){return P({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 0 0 .12-.61l-1.92-3.32a.488.488 0 0 0-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 0 0-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58a.49.49 0 0 0-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"},child:[]}]})(t)}function it(t){return P({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"},child:[]}]})(t)}function rt(t){return P({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M12 2C6.49 2 2 6.49 2 12s4.49 10 10 10 10-4.49 10-10S17.51 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3-8c0 1.66-1.34 3-3 3s-3-1.34-3-3 1.34-3 3-3 3 1.34 3 3z"},child:[]}]})(t)}function ct(t){return P({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"},child:[]}]})(t)}function lt(t){return P({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"},child:[]}]})(t)}function $e(t){return P({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},child:[]}]})(t)}function dt(t){return P({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"},child:[]}]})(t)}function ht(t){return P({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"},child:[]}]})(t)}function ut(t){return P({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"},child:[]}]})(t)}const pt=()=>{const t=K(),{t:s}=w(),n=O(),{isLoggedIn:a,name:o,token:i,refreshToken:r,saves:c,currentSaveId:l}=H(u=>u.account),h=u=>t({title:u,status:"error",duration:9e3,isClosable:!0});z.useEffect(()=>{a&&n(me())},[a]),z.useEffect(()=>{l&&p()},[l]);const p=async()=>{var m;const u=await fe(N.RMP);if(!u){v();return}const{hash:x}=u,f=(m=c.filter(k=>k.id===l).at(0))==null?void 0:m.hash;f&&f!==x&&v()},v=async()=>{const{rep:u,token:x,refreshToken:f}=await F(L.SAVES+"/"+l,{},i,r);if(!f||!x){h(s("Login status expired"));return}if(n(U({access:x,refresh:f})),u.status!==200){h(await u.text());return}oe.info("Set ".concat(N.RMP," with save id: ").concat(l)),Ae(N.RMP,await u.text()),Te()};return e.jsxs(T,{p:"1",flexDirection:"row",children:[e.jsx(ne,{name:a?o:void 0}),e.jsx(ae,{ml:"3",alignContent:"center",children:e.jsx(b,{as:"b",children:a?o:s("Log in / Sign up")})}),e.jsx(ae,{ml:"auto",alignContent:"center",children:e.jsx(he,{"aria-label":"More account info",variant:"ghost",size:"md",onClick:()=>n(we("account")),icon:e.jsx(ct,{})})})]})},xt=pt,gt=()=>{const{t}=w(),s=O(),{isLoggedIn:n,email:a,name:o,refreshToken:i}=H(h=>h.account),[r,c]=z.useState(void 0),l=async()=>{n&&(await fetch(ue+L.AUTH_LOGOUT,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({refreshToken:i})}),s(ts()))};return e.jsxs(R,{width:"100%",children:[e.jsxs(I,{width:"100%",children:[e.jsx(ne,{size:"md",name:o}),e.jsxs(ee,{width:"100%",children:[e.jsx(b,{as:"b",fontSize:"xl",children:a}),e.jsx(g,{size:"sm",ml:"auto",onClick:l,children:t("Log out")})]}),e.jsxs(ee,{width:"100%",children:[e.jsx(b,{as:"b",fontSize:"xl",children:o}),e.jsx(g,{size:"sm",ml:"auto",onClick:()=>c("name"),children:t("Change name")})]}),e.jsx(ee,{width:"100%",children:e.jsx(g,{size:"sm",ml:"auto",onClick:()=>c("password"),children:t("Change password")})})]}),e.jsx(jt,{infoType:r,onClose:()=>c(void 0)})]})};function jt(t){const{infoType:s,onClose:n}=t,{t:a}=w(),o=K(),i=O(),{isLoggedIn:r,id:c,token:l,refreshToken:h}=H(f=>f.account),[p,v]=z.useState(""),u=f=>o({title:f,status:"error",duration:9e3,isClosable:!0}),x=async()=>{if(!r||!s)return;const{rep:f,token:m,refreshToken:k}=await F(L.USER+"/"+c,{method:"PATCH",body:JSON.stringify({[s]:p})},l,h);if(!k||!m){u(a("Login status expired"));return}if(i(U({access:m,refresh:k})),f.status!==200){u(await f.text());return}if(s==="password"){i(ts()),n();return}if(s==="name"){i(Ts(p)),n();return}};return e.jsxs(q,{isOpen:!!s,onClose:n,size:"xl",scrollBehavior:"inside",children:[e.jsx(ie,{}),e.jsxs(X,{children:[e.jsx(Y,{children:a("Update account info")}),e.jsx(ge,{}),e.jsx(Q,{children:e.jsx($s,{defaultValue:p,onDebouncedChange:f=>v(f)})}),e.jsx(se,{children:e.jsx(g,{onClick:x,children:a("Change")})})]})]})}const mt=t=>{const s=K(),{t:n}=w(),a=O(),[o,i]=z.useState(""),[r,c]=z.useState(""),[l,h]=z.useState(""),[p,v]=z.useState(""),u=m=>s({title:m,status:"error",duration:9e3,isClosable:!0}),x=async()=>{const m=await fetch(ue+L.AUTH_SEND_RESET_PASSWORD_EMAIL,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:o})});if(m.status===204){v(o);return}if(m.status===400){v("error");return}},f=async()=>{const m=new URLSearchParams({token:l}),k="".concat(ue).concat(L.AUTH_RESET_PASSWORD,"?").concat(m.toString()),d=await fetch(k,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({password:r})});if(d.status!==204){u(await d.text());return}const{error:D,username:W}=(await a(Oe({email:o,password:r}))).payload;s(D?{title:D,status:"error",duration:9e3,isClosable:!0}:{title:n("Welcome ")+W,status:"success",duration:5e3,isClosable:!0})};return e.jsxs(E,{children:[e.jsx(R,{children:e.jsx(y,{as:"h4",size:"md",my:1,children:n("Forgot password")})}),p&&e.jsxs(re,{status:p==="error"?"error":"info",children:[e.jsx(ce,{}),e.jsx(Ee,{children:p==="error"?n("Check your email again!"):n("Email with reset link is sent to: ")+p})]}),e.jsxs(T,{p:"3",flexDirection:"column",children:[e.jsxs(G,{children:[e.jsx($,{children:n("Email")}),e.jsxs(Xe,{size:"md",children:[e.jsx(V,{type:"email",value:o,onChange:m=>i(m.target.value)}),e.jsx(Ye,{width:"4.5rem",children:e.jsx(g,{h:"1.75rem",size:"sm",onClick:x,children:n("Send reset link")})})]})]}),e.jsxs(G,{children:[e.jsx($,{children:n("Reset password token")}),e.jsx(V,{value:l,onChange:m=>h(m.target.value)})]}),e.jsxs(G,{children:[e.jsx($,{children:n("Password")}),e.jsx(V,{type:"password",value:r,onChange:m=>c(m.target.value)})]}),e.jsxs(I,{mt:"10",children:[e.jsx(g,{onClick:f,children:n("Reset password")}),e.jsx(g,{onClick:()=>t.setLoginState("login"),children:n("Back to log in")})]})]})]})},ft=t=>{const s=K(),{t:n}=w(),a=O(),[o,i]=z.useState(""),[r,c]=z.useState(""),l=async()=>{const{error:h,username:p}=(await a(Oe({email:o,password:r}))).payload;s(h?{title:h,status:"error",duration:9e3,isClosable:!0}:{title:n("Welcome ")+p,status:"success",duration:5e3,isClosable:!0})};return e.jsxs(E,{children:[e.jsx(R,{children:e.jsx(y,{as:"h4",size:"md",my:1,children:n("Log in")})}),e.jsxs(T,{p:"3",flexDirection:"column",children:[e.jsxs(G,{children:[e.jsx($,{children:n("Email")}),e.jsx(V,{type:"email",value:o,onChange:h=>i(h.target.value)})]}),e.jsxs(G,{children:[e.jsx($,{children:n("Password")}),e.jsx(V,{type:"password",value:r,onChange:h=>c(h.target.value)})]}),e.jsxs(I,{mt:"10",children:[e.jsx(g,{onClick:l,children:n("Log in")}),e.jsx(g,{onClick:()=>t.setLoginState("register"),children:n("Sign up")}),e.jsx(g,{onClick:()=>t.setLoginState("forgot-password"),children:n("Forgot password")})]})]})]})},wt=t=>{const s=K(),{t:n}=w(),a=O(),[o,i]=z.useState(""),[r,c]=z.useState(""),[l,h]=z.useState(""),[p,v]=z.useState(""),[u,x]=z.useState(""),f=d=>s({title:d,status:"error",duration:9e3,isClosable:!0}),m=async()=>{const d=await fetch(ue+L.AUTH_SEND_VERIFICATION_EMAIL,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:r})});if(d.status===204){x(r);return}if(d.status===400){x("error");return}},k=async()=>{const d=await fetch(ue+L.AUTH_REGISTER,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({name:o,email:r,password:l,emailVerificationToken:Number(p)})});if(d.status!==201){f(await d.text());return}const{error:D,username:W}=(await a(Oe({email:r,password:l}))).payload;s(D?{title:D,status:"error",duration:9e3,isClosable:!0}:{title:n("Welcome ")+W,status:"success",duration:5e3,isClosable:!0})};return e.jsxs(E,{children:[e.jsx(R,{children:e.jsx(y,{as:"h4",size:"md",my:1,children:n("Sign up")})}),u&&e.jsxs(re,{status:u==="error"?"error":"info",children:[e.jsx(ce,{}),e.jsx(Ee,{children:u==="error"?n("The email is not valid!"):n("Verification email is sent to: ")+u})]}),e.jsxs(T,{p:"3",flexDirection:"column",children:[e.jsxs(I,{spacing:"25px",children:[e.jsxs(G,{children:[e.jsx($,{children:n("Name")}),e.jsx(V,{type:"text",value:o,onChange:d=>i(d.target.value)}),e.jsx(Ve,{children:n("You may always change it later.")})]}),e.jsxs(G,{children:[e.jsx($,{children:n("Email")}),e.jsxs(Xe,{size:"md",children:[e.jsx(V,{type:"email",value:r,onChange:d=>c(d.target.value)}),e.jsx(Ye,{width:"auto",children:e.jsx(g,{h:"1.75rem",size:"sm",onClick:m,children:n("Send verification code")})})]}),e.jsx(Ve,{children:n("We'll never share your email.")})]}),e.jsxs(G,{children:[e.jsx($,{children:n("Verification code")}),e.jsx(V,{type:"number",value:p,onChange:d=>v(d.target.value)})]}),e.jsxs(G,{children:[e.jsx($,{children:n("Password")}),e.jsx(V,{type:"password",value:l,onChange:d=>h(d.target.value)})]})]}),e.jsxs(I,{mt:"10",children:[e.jsx(g,{onClick:k,children:n("Sign up")}),e.jsx(g,{onClick:()=>t.setLoginState("login"),children:n("Back to log in")})]})]})]})},vt=1,kt=10,St=()=>{const t=K(),{t:s}=w(),n=O(),{isLoggedIn:a,token:o,refreshToken:i,activeSubscriptions:r,currentSaveId:c,saves:l}=H(j=>j.account),h=a&&l&&(r.RMP_CLOUD?l.length<kt:l.length<vt),p=Math.min(...(l!=null?l:[]).map(j=>j.id)),v=j=>!r.RMP_CLOUD&&j!==p,[u,x]=z.useState(void 0),[f,m]=z.useState(void 0),k=j=>t({title:j,status:"error",duration:9e3,isClosable:!0}),d=async()=>{const j=await fe(N.RMP);if(!a||!j||!o){k(s("Failed to get the RMP save!"));return}const{data:M,hash:A}=j,_=crypto.randomUUID(),{rep:Z,token:le,refreshToken:de}=await F(L.SAVES,{method:"POST",body:JSON.stringify({index:_,data:M,hash:A})},o,i);if(!de||!le){k(s("Login status expired"));return}if(n(U({access:le,refresh:de})),Z.status!==200){k(await Z.text());return}n(me())},D=async j=>{if(!(!a||!o)){if(j===c){if(x(c),!c||v(c)){k(s("Can not sync this save!")),x(void 0);return}const M=await fe(N.RMP);if(!M){k(s("Failed to get the RMP save!")),x(void 0);return}const{data:A,hash:_}=M,{rep:Z,token:le,refreshToken:de}=await F(L.SAVES+"/"+c,{method:"PATCH",body:JSON.stringify({data:A,hash:_})},o,i);if(!de||!le){k(s("Login status expired")),x(void 0);return}if(n(U({access:le,refresh:de})),Z.status!==200){k(await Z.text()),x(void 0);return}x(void 0)}else{x(j);const{rep:M,token:A,refreshToken:_}=await F(L.SAVES+"/"+j,{},o,i);if(!_||!A){k(s("Login status expired")),x(void 0);return}if(n(U({access:A,refresh:_})),M.status!==200){k(await M.text()),x(void 0);return}oe.info("Set ".concat(N.RMP," with save id: ").concat(j)),Ae(N.RMP,await M.text()),Te(),x(void 0)}n(me())}},W=async j=>{if(!a||!j||!o)return;m(j);const{rep:M,token:A,refreshToken:_}=await F(L.SAVES+"/"+c,{method:"DELETE"},o,i);if(!_||!A){k(s("Login status expired")),m(void 0);return}if(n(U({access:A,refresh:_})),M.status!==200){k(await M.text()),m(void 0);return}n(me()),m(void 0)};z.useEffect(()=>{c&&je()},[c]);const je=async()=>{var _;const j=await fe(N.RMP);if(!j){_e();return}const{hash:M}=j,A=(_=l.filter(Z=>Z.id===c).at(0))==null?void 0:_.hash;A&&A!==M&&_e()},_e=async()=>{const{rep:j,token:M,refreshToken:A}=await F(L.SAVES+"/"+c,{},o,i);if(!A||!M){k(s("Login status expired"));return}if(n(U({access:M,refresh:A})),j.status!==200){k(await j.text());return}oe.info("Set ".concat(N.RMP," with save id: ").concat(c)),Ae(N.RMP,await j.text()),Te()};return e.jsxs(E,{children:[e.jsx(R,{children:e.jsxs(ee,{width:"100%",children:[e.jsx(y,{as:"h4",size:"md",my:1,children:s("Synced saves")}),e.jsxs(b,{ml:"auto",children:[s("Maximum save count:")," ",r.RMP_CLOUD?10:1]}),e.jsx(g,{size:"sm",isDisabled:!h,onClick:d,children:s("Create")})]})}),e.jsx(I,{mt:"2",children:l&&l.map(j=>e.jsx(ye,{overflow:"hidden",variant:"outline",mb:"3",children:e.jsxs(I,{direction:{base:"column",sm:"row"},children:[e.jsxs(Me,{children:[e.jsx(b,{py:"2",as:"b",children:j.id===c?s("Current save"):s("Cloud save")}),e.jsxs(b,{py:"2",children:[s("Last update at:")," ",new Date(j.lastUpdateAt).toLocaleString()]})]}),e.jsx(Qe,{children:e.jsxs(I,{children:[e.jsx(g,{variant:"solid",colorScheme:"red",isLoading:f===j.id,onClick:()=>W(j.id),children:s("Delete this save")}),e.jsx(g,{variant:"solid",colorScheme:"blue",isDisabled:v(j.id),isLoading:u===j.id,onClick:()=>D(j.id),children:j.id===c?s("Sync now"):s("Sync this slot")})]})})]})},j.id))})]})},bt=t=>{const s=K(),{t:n}=w(),{isOpen:a,onClose:o,getSubscriptions:i}=t,{isLoggedIn:r,token:c,refreshToken:l}=H(f=>f.account),h=O(),p=hs("primary.500","primary.300"),[v,u]=z.useState(""),x=async()=>{if(!r)return;const{rep:f,token:m,refreshToken:k}=await F(L.SUBSCRIPTION_REDEEM,{method:"POST",body:JSON.stringify({cdkey:v})},c,l);if(!(!k||!m)){if(h(U({access:m,refresh:k})),f.status!==202){const d=(await f.json()).message;s({title:n(d),status:"error",duration:5e3,isClosable:!0});return}await i(),o()}};return e.jsxs(q,{isOpen:a,onClose:o,size:"xl",scrollBehavior:"inside",children:[e.jsx(ie,{}),e.jsxs(X,{children:[e.jsx(Y,{children:n("Redeem your subscription")}),e.jsx(ge,{}),e.jsxs(Q,{children:[e.jsx(b,{children:n("CDKey could be purchased in the following sites:")}),e.jsx(Le,{children:e.jsx(te,{children:e.jsxs(Ze,{color:p,href:"https://afdian.com/item/9c8b220c614311efab2d52540025c377",isExternal:!0,children:["çˆ±å‘ç”µ ",e.jsx(us,{as:pe})]})})}),e.jsxs(I,{mt:"5",direction:{base:"column",sm:"row"},children:[e.jsx(b,{children:n("Enter your CDKey here:")}),e.jsx(V,{w:"auto",value:v,onChange:f=>u(f.target.value)}),e.jsx(g,{colorScheme:"teal",onClick:x,children:n("Redeem")})]})]}),e.jsx(se,{})]})]})},Ct=()=>{const t=K(),{t:s}=w(),{isLoggedIn:n,token:a,refreshToken:o}=H(u=>u.account),i=O(),[r,c]=z.useState([]),[l,h]=z.useState(!1),p=u=>t({title:u,status:"error",duration:9e3,isClosable:!0}),v=async()=>{if(!n)return;const{rep:u,token:x,refreshToken:f}=await F(L.SUBSCRIPTION,{},a,o);if(!f||!x){p(s("Login status expired"));return}if(i(U({access:x,refresh:f})),u.status!==200){p(await u.text());return}const m=(await u.json()).subscriptions;if(!m.map(d=>d.type).includes("RMP_CLOUD"))return;c([{type:"RMP",expires:m[0].expires}]);const k=structuredClone(Hs);for(const d of m){const D=d.type;D in k&&(k[D]=!0)}i(Es(k))};return z.useEffect(()=>{v()},[]),e.jsxs(E,{children:[e.jsx(R,{children:e.jsxs(ee,{width:"100%",children:[e.jsx(y,{as:"h4",size:"md",my:1,children:s("All subscriptions")}),e.jsx(g,{size:"sm",ml:"auto",onClick:()=>h(!0),children:s("Redeem")})]})}),e.jsxs(I,{mt:"2",children:[r.length===0&&e.jsxs(ye,{overflow:"hidden",variant:"outline",mb:"3",children:[e.jsx(Be,{children:e.jsx(y,{size:"md",children:s("Rail Map Painter")})}),e.jsx(I,{direction:{base:"column",sm:"row"},children:e.jsx(Me,{children:e.jsxs(I,{children:[e.jsx(b,{children:s("With this subscription, the following features are unlocked:")}),e.jsxs(Le,{children:[e.jsx(te,{children:e.jsx(b,{children:s("PRO features")})}),e.jsx(te,{children:e.jsx(b,{children:s("Sync 9 more saves")})}),e.jsx(te,{children:e.jsx(b,{children:s("Unlimited master nodes")})}),e.jsx(te,{children:e.jsx(b,{children:s("Unlimited parallel lines")})})]}),e.jsxs(b,{children:[s("Expires at:")," ",s("Not applicable")]})]})})})]}),r.map(u=>e.jsxs(ye,{overflow:"hidden",variant:"outline",mb:"3",children:[e.jsx(Be,{children:e.jsx(y,{size:"md",children:s(u.type==="RMP"?"Rail Map Painter":u.type)})}),e.jsxs(I,{direction:{base:"column",sm:"row"},children:[e.jsx(Me,{children:e.jsxs(b,{py:"2",children:[s("Expires at:")," ",new Date(u.expires).toLocaleString()]})}),e.jsx(Qe,{children:e.jsx(g,{variant:"solid",colorScheme:"blue",onClick:()=>h(!0),children:s("Renew")})})]})]},u.type))]}),e.jsx(bt,{isOpen:l,onClose:()=>h(!1),getSubscriptions:v})]})},zt=()=>{const{t}=w(),{isLoggedIn:s}=H(o=>o.account),[n,a]=z.useState("login");return e.jsxs(E,{children:[e.jsx(R,{children:e.jsx(y,{as:"h4",size:"md",my:1,children:t("Account")})}),s?e.jsx(T,{flexDirection:"column",alignItems:"center",children:e.jsxs(I,{width:"100%",p:"2",spacing:"30px",children:[e.jsx(gt,{}),e.jsx(Re,{}),e.jsx(Ct,{}),e.jsx(Re,{}),e.jsx(St,{})]})}):n==="login"?e.jsx(ft,{setLoginState:a}):n==="register"?e.jsx(wt,{setLoginState:a}):e.jsx(mt,{setLoginState:a})]})},yt=zt,We={"& button:first-of-type":{w:"100%",overflow:"hidden",justifyContent:"flex-start",textOverflow:"ellipsis",textAlign:"start","& span.chakra-button__icon":{ml:-1,color:"orange.300",'[data-theme="dark"] &':{color:"orange.200"}}},'&[aria-current="true"] > button':{bg:"primary.50",_hover:{bg:"primary.100"},'[data-theme="dark"] &':{bg:"primary.700",_hover:{bg:"primary.600"}}},"& > div":{zIndex:6}};function Mt(t){var k;const{appId:s,onAboutOpen:n}=t,{t:a}=w(),o=O(),i=ps("(min-width: ".concat(xs.breakpoints.sm,")")),{activeTab:r,openedTabs:c}=H(d=>d.app),l=J[s],h=l.name.split(" - ").map(d=>a(d)).join(" - "),p=c.some(d=>d.app===s),v=!l.allowMultiInstances&&((k=c.find(d=>d.id===r))==null?void 0:k.app)===s,u=d=>{p||S.event(B.OPEN_APP,{appId:s,isOpenInNew:d}),o(d?Ls(s):Is({appId:s})),i[0]||(o(He()),S.toggleNavMenu(!1))},x=d=>{o(Ps(d)),i[0]||(o(He()),S.toggleNavMenu(!1))},f=d=>{o(Os(d)),S.event(B.CLOSE_APP,{app:s})},m=d=>{o(Ds(d)),S.event(B.CLOSE_APP,{app:d})};return e.jsxs(e.Fragment,{children:[e.jsxs(Fe,{variant:v?"solid":"ghost",size:"md",isAttached:!0,"aria-current":v,sx:We,children:[e.jsx(g,{onClick:()=>u(!1),leftIcon:p?e.jsx(rt,{title:a("Running")}):e.jsx(ae,{w:4}),children:h}),l.allowMultiInstances&&e.jsx(he,{"aria-label":a("New tab"),title:a("New tab"),icon:e.jsx(it,{}),onClick:()=>u(!0)}),e.jsxs(gs,{children:[e.jsx(js,{as:he,icon:e.jsx(ht,{}),"aria-label":a("More"),title:a("More")}),e.jsxs(ms,{children:[p&&e.jsx(Ue,{icon:e.jsx($e,{}),onClick:()=>m(s),children:l.allowMultiInstances?a("Close all tabs"):a("Close app")}),e.jsx(Ue,{icon:e.jsx(at,{}),onClick:n,children:a("About")})]})]})]}),l.allowMultiInstances&&c.filter(d=>d.app===s).map((d,D)=>{var je;const W=d.id===r;return e.jsxs(Fe,{variant:W?"solid":"ghost",size:"sm",ml:8,mr:1,isAttached:!0,"aria-current":W,sx:We,children:[e.jsxs(g,{onClick:()=>x(d.id),children:[e.jsx(es,{mr:2,children:D+1}),(je=d.title)!=null?je:a("Tab")+" "+(D+1).toString()+" - "+h]}),e.jsx(he,{"aria-label":a("Close tab"),title:a("Close tab"),icon:e.jsx($e,{}),onClick:()=>f(d.id)})]},d.id)})]})}const Rt=async t=>{const s="/".concat(t,"/info.json");try{return(await(await fetch(s)).json()).version}catch(n){return oe.info("Failed to get version of ".concat(t),n),"unknown"}},At=async(t,s)=>{const n="/".concat(t,"/legacy-contributor-list.txt");return(await(await fetch(n,{signal:s})).text()).split("\n")};function Tt(t){var c,l,h;const{appId:s,onClose:n}=t,{t:a}=w(),[o,i]=C.useState("Unknown"),r=s?(h=(l=(c=J[s])==null?void 0:c.url)==null?void 0:l.split("/"))==null?void 0:h[1]:void 0;return C.useEffect(()=>{r?Rt(r).then(p=>i(p)):i("Unknown")},[r]),e.jsxs(q,{isOpen:!!s,onClose:n,size:"xl",scrollBehavior:"inside",children:[e.jsx(ie,{}),e.jsxs(X,{children:[e.jsxs(Y,{children:[a("About")+" "+(s?J[s].name.split(" - ").map(p=>a(p)).join(" - "):""),e.jsx(es,{ml:1,children:o})]}),e.jsx(ge,{}),e.jsx(Q,{}),e.jsx(se,{children:e.jsx(g,{colorScheme:"primary",onClick:()=>window.open("https://github.com/railmapgen/"+r,"_blank"),children:a("Visit GitHub")})})]})]})}function Je({assetType:t}){const{t:s}=w(),[n,a]=C.useState(),o=ns(t,S.getEnv(),S.getInstance());return e.jsxs(E,{children:[e.jsx(R,{children:e.jsx(y,{as:"h4",size:"md",my:1,children:s(t==="devtool"?"Devtools":"Apps")})}),e.jsx(T,{direction:"column",children:o.map(i=>e.jsx(Mt,{appId:i,onAboutOpen:()=>a(i)},i))}),e.jsx(Tt,{appId:n,onClose:()=>a(void 0)})]})}const Ht={"& button":{w:"100%",overflow:"hidden",justifyContent:"flex-start",textOverflow:"ellipsis",textAlign:"start","& span.chakra-button__icon:last-of-type":{ml:"auto"}}};function Et(){const{t}=w(),s=ns("link",S.getEnv(),S.getInstance()),n=a=>{S.event(B.OPEN_LINK,{id:a}),window.open(J[a].url,"_blank")};return e.jsxs(E,{sx:Ht,children:[e.jsx(R,{children:e.jsx(y,{as:"h4",size:"md",my:1,children:t("Useful links")})}),e.jsx(T,{direction:"column",children:s.map(a=>e.jsx(g,{variant:"ghost",size:"md",leftIcon:e.jsx(ae,{w:4}),rightIcon:e.jsx(pe,{}),onClick:()=>n(a),children:t(J[a].name)},a))})]})}const Lt={"& > span":{minW:"75%",borderRadius:"lg",cursor:"pointer","& > span:last-of-type":{display:"block"},"& p":{fontSize:"sm","&:first-of-type":{fontSize:"lg",fontWeight:"bold",mb:1}}},"& .chakra-avatar":{ml:1,mr:3,my:4}};function It(){const{t}=w();return e.jsxs(E,{children:[e.jsx(R,{children:e.jsx(y,{as:"h5",size:"sm",children:t("Developer team")})}),e.jsxs(xe,{sx:Lt,children:[e.jsxs(ve,{size:"lg",onClick:()=>window.open("https://github.com/wongchito","_blank"),children:[e.jsx(ne,{src:"https://github.com/wongchito.png",size:"lg"}),e.jsxs(ke,{children:[e.jsx(b,{children:"Chito Wong"}),e.jsx(b,{children:"Author of Rail Map Toolkit platform"}),e.jsx(b,{children:"Author of Rail Map Generator"})]})]}),e.jsxs(ve,{size:"lg",onClick:()=>window.open("https://github.com/thekingofcity","_blank"),children:[e.jsx(ne,{src:"https://github.com/thekingofcity.png",size:"lg"}),e.jsxs(ke,{children:[e.jsx(b,{children:"thekingofcity"}),e.jsx(b,{children:"Author of Rail Map Painter"}),e.jsx(b,{children:"Author of RMG (Shanghai Metro style)"})]})]}),e.jsxs(ve,{size:"lg",onClick:()=>window.open("https://github.com/langonginc","_blank"),children:[e.jsx(ne,{src:"https://github.com/langonginc.png",size:"lg"}),e.jsxs(ke,{children:[e.jsx(b,{children:"langonginc"}),e.jsx(b,{children:"Author of Rail Map Painter"})]})]})]})]})}function De(t){const{login:s,urlRepo:n,...a}=t,o=n?"https://github.com/railmapgen/".concat(n,"/issues?q=is:issue+author:").concat(s):"https://github.com/".concat(s);return e.jsx(ne,{name:s,title:s,src:"https://github.com/".concat(s,".png"),loading:"lazy",onClick:()=>window.open(o,"_blank"),cursor:"pointer",...a})}const Pt=["Swiftiecott","linchen1965","28yfang","Windows-Taskmgr"];function Ot(){const{t}=w();return e.jsxs(E,{children:[e.jsx(R,{children:e.jsx(y,{as:"h5",size:"sm",children:t("Resource administrators")})}),e.jsx(Ie,{spacing:1.5,px:2,children:Pt.map(s=>e.jsx(Pe,{children:e.jsx(De,{login:s,size:"md"})},s))})]})}const rs="https://api.github.com/repos/railmapgen",ze={},cs=async(t,s)=>{if(t in ze)return ze[t];const a=await(await fetch(t,s)).json();return ze[t]=a,a},Dt=async(t,s,n)=>{const a="".concat(rs,"/").concat(t,"/contributors"),o=new URLSearchParams({per_page:"100",page:s.toString()});return(await cs(a+"?"+o.toString(),{signal:n})).map(r=>r.login)},_t=async(t,s,n)=>{const a="".concat(rs,"/").concat(t,"/issues"),o=new URLSearchParams({state:"closed",labels:"donation",per_page:"100",page:s.toString()});return(await cs(a+"?"+o.toString(),{signal:n})).filter(r=>r.state_reason==="completed").map(r=>{var c;return(c=r.user)==null?void 0:c.login})};function ls(t){const[s,n]=C.useState([]);return[s,o=>{n(i=>{const r=new Set(i?i.concat(o):o);return Array.from(r)})}]}const Nt=["","wongchito","thekingofcity","github-actions[bot]"],Ke=t=>!Nt.includes(t);function Vt(t){const[s,n]=ls(),[a,o]=C.useState(!0),[i,r]=C.useState(!1),c=C.useRef(),l=async()=>{var p;let h=0;for(;++h;){c.current=new AbortController;const v=await Dt(t,h,(p=c.current)==null?void 0:p.signal);if(n(v.filter(Ke)),v.length<100)break}};return C.useEffect(()=>(l().then(()=>{var h;return J[t].legacyContributors?(c.current=new AbortController,At(t,(h=c.current)==null?void 0:h.signal)):[]}).then(h=>n(h.filter(Ke))).catch(h=>{oe.error("unable to fetch contributors for:",t,h),r(!0)}).finally(()=>o(!1)),()=>{var h;(h=c.current)==null||h.abort(),o(!0),r(!1)}),[t]),{contributors:s,isLoading:a,isError:i}}const Bt={position:"relative",minH:20,"& .chakra-alert":{flexDirection:"column"},"& .chakra-alert__icon":{boxSize:7,mr:0,mb:1}};function Ft(t){const{appId:s}=t,{t:n}=w(),{contributors:a,isLoading:o,isError:i}=Vt(s);return e.jsxs(T,{sx:Bt,children:[o&&e.jsx(os,{isIndeterminate:!0}),i&&e.jsxs(re,{status:"warning",children:[e.jsx(ce,{}),n("Unable to load contributors")]}),!i&&a&&e.jsx(Ie,{spacing:1.5,children:a==null?void 0:a.map(r=>e.jsx(Pe,{children:e.jsx(De,{login:r,urlRepo:s,size:"sm"})},r))})]})}const Ut={"& > *:not(.rmg-section__header)":{px:2},"& h6":{my:2}};function Gt(){const{t}=w();return e.jsxs(E,{sx:Ut,children:[e.jsx(R,{children:e.jsx(y,{as:"h5",size:"sm",children:t("Resource contributors")})}),Object.entries(J).filter(([,s])=>s.showContributors).map(([s,n])=>e.jsxs(C.Fragment,{children:[e.jsx(y,{as:"h6",size:"xs",children:t(n.name)}),e.jsx(Ft,{appId:s},s)]},s)),e.jsx(b,{as:"i",fontSize:"xs",mt:3,children:t("Notes: Contributors are sorted by number of commits and commit time.")})]})}function $t(){const[t,s]=ls(),[n,a]=C.useState(!0),[o,i]=C.useState(!1),r=C.useRef(),c=async()=>{var h;const l=Object.entries(J).filter(([,p])=>p.showDonators).map(([p])=>p);for(const p of l)try{let v=0;for(;++v;){r.current=new AbortController;const u=await _t(p,v,(h=r.current)==null?void 0:h.signal);if(s(u),u.length<100)break}}catch(v){throw oe.error("unable to fetch donators for:",p,v),v}};return C.useEffect(()=>(c().catch(()=>i(!0)).finally(()=>a(!1)),()=>{var l;(l=r.current)==null||l.abort(),a(!0),i(!1)}),[]),{donators:t,isLoading:n,isError:o}}const Wt={position:"relative",px:2,minH:20,"& .chakra-alert":{flexDirection:"column"},"& .chakra-alert__icon":{boxSize:7,mr:0,mb:1}};function Jt(){const{t}=w(),{donators:s,isLoading:n,isError:a}=$t();return e.jsxs(E,{children:[e.jsx(R,{children:e.jsx(y,{as:"h5",size:"sm",children:"â¤ï¸ "+t("Donators")})}),e.jsxs(T,{sx:Wt,children:[n&&e.jsx(os,{isIndeterminate:!0}),a&&e.jsxs(re,{status:"warning",children:[e.jsx(ce,{}),t("Unable to load donators")]}),!a&&s&&e.jsx(Ie,{spacing:1.5,children:s==null?void 0:s.map(o=>e.jsx(Pe,{children:e.jsx(De,{login:o,size:"sm"})},o))})]})]})}const Kt={bg:"inherit",py:0,"& section:not(:last-of-type)":{mb:4}};function qt(t){const{isOpen:s,onClose:n}=t,{t:a}=w();return e.jsxs(q,{isOpen:s,onClose:n,size:"xl",scrollBehavior:"inside",children:[e.jsx(ie,{}),e.jsxs(X,{children:[e.jsx(Y,{children:a("Contributors")}),e.jsx(ge,{}),e.jsxs(Q,{sx:Kt,children:[e.jsx(It,{}),e.jsx(Jt,{}),e.jsx(Ot,{}),e.jsx(Gt,{})]}),e.jsx(se,{children:e.jsx(g,{colorScheme:"primary",onClick:()=>window.open("https://github.com/railmapgen/rmg/wiki/How-to-add-color-palette-and-line-templates","_blank"),children:a("Contribution Wiki")})})]})]})}function Xt(){const{t}=w(),s=O(),{isShowMenu:n,showFontAdvice:a}=H(r=>r.app),[o,i]=C.useState(n&&a==="show");return C.useEffect(()=>{let r;return n&&a==="show"?r=window.setTimeout(()=>{i(!0)},5e3):i(!1),()=>{window.clearTimeout(r)}},[n,a]),e.jsxs(fs,{isOpen:o,onClose:()=>s(be()),children:[e.jsx(ws,{children:e.jsx(g,{variant:"ghost",size:"sm",w:"100%",leftIcon:e.jsx(nt,{}),onClick:()=>{s(we("support")),s(be())},children:t("Help & support")})}),e.jsxs(vs,{children:[e.jsx(ks,{}),e.jsx(Ss,{}),e.jsxs(bs,{children:["ðŸ’¡ ",t("Pro tip")]}),e.jsx(Cs,{children:t("Fonts are slow to load? Learn how to speed it up!")}),e.jsxs(zs,{display:"flex",children:[e.jsx(g,{variant:"ghost",size:"sm",ml:"auto",onClick:()=>{s(_s()),S.storage.set(Ns.SHOW_FONT_ADVICE,Vs)},children:t("Don't show again")}),e.jsx(g,{variant:"solid",colorScheme:"primary",size:"sm",ml:2,onClick:()=>s(be()),children:t("OK")})]})]})]})}function Yt(){const{t}=w(),s=O(),{menuView:n,refreshRequired:a}=H(r=>r.app),[o,i]=C.useState(!1);return e.jsxs(T,{direction:"column",children:[e.jsx(Re,{}),n==="main"?e.jsxs(ys,{templateColumns:"repeat(3, auto)",children:[e.jsx(Se,{children:e.jsx(g,{variant:"ghost",size:"sm",w:"100%",leftIcon:e.jsx(ut,{}),onClick:()=>i(!0),children:t("Contributors")})}),e.jsx(Se,{children:e.jsx(Xt,{})}),e.jsx(Se,{children:e.jsx(g,{variant:"ghost",size:"sm",w:"100%",leftIcon:e.jsx(ot,{}),onClick:()=>s(we("settings")),children:t("Settings")})})]}):e.jsx(g,{variant:"ghost",size:"sm",w:"100%",leftIcon:e.jsx(lt,{}),onClick:()=>s(we("main")),isDisabled:a,children:t("Go back")}),e.jsx(qt,{isOpen:o,onClose:()=>i(!1)})]})}function ds(){const{t}=w();return{type:"select",label:t("Language"),value:S.getLanguage(),options:{[t("Main languages")]:Xs.reduce((s,n)=>({...s,[n]:Ge[n][n]}),{}),[t("Other languages")]:Ys.reduce((s,n)=>({...s,[n]:Ge[n][n]}),{})},onChange:s=>{const n=s;S.setLanguage(n),S.getI18nInstance().changeLanguage(n),S.event(B.CHANGE_LANGUAGE,{language:n})}}}function Qt(t){const{isOpen:s,onClose:n}=t,{t:a}=w(),o=Object.entries(localStorage);return e.jsxs(q,{isOpen:s,onClose:n,size:"xl",scrollBehavior:"inside",children:[e.jsx(ie,{}),e.jsxs(X,{children:[e.jsx(Y,{children:a("Local Storage")}),e.jsx(ge,{}),e.jsx(Q,{children:e.jsx(xe,{p:1,children:o.map(i=>e.jsx(Ws,{label:i[0],minW:"full",children:e.jsx(Ms,{value:i[1],readOnly:!0,fontFamily:"monospace",fontSize:"xs"})},i[0]))})}),e.jsx(se,{children:e.jsx(g,{onClick:n,children:a("Go back")})})]})]})}function Zt(){const{t}=w(),{setColourMode:s}=Js(),n=O(),{lastShowDevtools:a,refreshRequired:o}=H(x=>x.app),[i,r]=C.useState(S.isAllowAnalytics()),[c,l]=C.useState(!1),h=ds(),p=x=>{r(x),S.allowAnalytics(x).refreshRequired&&n(Us())},v={light:t("Light"),dark:t("Dark"),system:t("System")},u=[h,{type:"select",label:t("Appearance"),value:S.getColourMode(),options:v,onChange:x=>s(x)},{type:"switch",label:t("Allow cookies to help improve our website"),isChecked:i,onChange:p,oneLine:!0,isDisabled:o},{type:"switch",label:t("Show dev tools for 1 day"),isChecked:as(a),onChange:x=>{x?(n(Bs()),S.event(B.SHOW_DEVTOOLS)):n(Fs())},oneLine:!0}];return e.jsxs(E,{children:[o&&e.jsxs(re,{status:"info",variant:"solid",size:"xs",children:[e.jsx(ce,{}),t("Refreshing is required for changes to take effect.")]}),e.jsx(R,{children:e.jsx(y,{as:"h4",size:"md",my:1,children:t("Settings")})}),e.jsxs(ae,{px:2,children:[e.jsx(is,{fields:u,minW:"full"}),e.jsx(g,{width:"100%",onClick:()=>l(!0),children:t("Export Local Storage")})]}),e.jsx(Qt,{isOpen:c,onClose:()=>l(!1)})]})}const en={px:2,"& button":{w:"100%"}};function sn(){const{t}=w(),{remoteFonts:s}=H(n=>n.app);return e.jsxs(E,{children:[e.jsx(R,{children:e.jsx(y,{as:"h4",size:"md",my:1,children:t("Web fonts")})}),e.jsxs(xe,{sx:en,children:[e.jsxs(b,{as:"i",fontSize:"sm",children:[t("FontsSection.text1")," ",t("FontsSection.text2")," ",t("FontsSection.text3")," (",t("FontsSection.safari"),")"]}),Object.entries(s).map(([n,a])=>e.jsx(g,{size:"sm",rightIcon:a.url?e.jsx(pe,{}):void 0,isDisabled:!a.url,onClick:()=>{window.open(a.url,"_blank"),S.event(B.DOWNLOAD_FONT,{family:n})},children:a.displayName?"".concat(a.displayName," (").concat(n,")"):n},n))]})]})}function tn(t){return P({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 32C132.3 32 32 134.9 32 261.7c0 101.5 64.2 187.5 153.2 217.9a17.56 17.56 0 0 0 3.8.4c8.3 0 11.5-6.1 11.5-11.4 0-5.5-.2-19.9-.3-39.1a102.4 102.4 0 0 1-22.6 2.7c-43.1 0-52.9-33.5-52.9-33.5-10.2-26.5-24.9-33.6-24.9-33.6-19.5-13.7-.1-14.1 1.4-14.1h.1c22.5 2 34.3 23.8 34.3 23.8 11.2 19.6 26.2 25.1 39.6 25.1a63 63 0 0 0 25.6-6c2-14.8 7.8-24.9 14.2-30.7-49.7-5.8-102-25.5-102-113.5 0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8a18.64 18.64 0 0 1 5-.5c8.1 0 26.4 3.1 56.6 24.1a208.21 208.21 0 0 1 112.2 0c30.2-21 48.5-24.1 56.6-24.1a18.64 18.64 0 0 1 5 .5c12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6 0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5 0 30.7-.3 55.5-.3 63 0 5.4 3.1 11.5 11.4 11.5a19.35 19.35 0 0 0 4-.4C415.9 449.2 480 363.1 480 261.7 480 134.9 379.7 32 256 32z"},child:[]}]})(t)}function nn(t){return P({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M126.12 315.1A47.06 47.06 0 1 1 79.06 268h47.06zm23.72 0a47.06 47.06 0 0 1 94.12 0v117.84a47.06 47.06 0 1 1-94.12 0zm47.06-188.98A47.06 47.06 0 1 1 244 79.06v47.06zm0 23.72a47.06 47.06 0 0 1 0 94.12H79.06a47.06 47.06 0 0 1 0-94.12zm188.98 47.06a47.06 47.06 0 1 1 47.06 47.1h-47.06zm-23.72 0a47.06 47.06 0 0 1-94.12 0V79.06a47.06 47.06 0 1 1 94.12 0zM315.1 385.88a47.06 47.06 0 1 1-47.1 47.06v-47.06zm0-23.72a47.06 47.06 0 0 1 0-94.12h117.84a47.06 47.06 0 1 1 0 94.12z"},child:[]}]})(t)}const an={px:2,"& button":{w:"100%"}};function on(){const{t}=w();return e.jsxs(E,{children:[e.jsx(R,{children:e.jsx(y,{as:"h4",size:"md",my:1,children:t("Help & support")})}),e.jsxs(xe,{sx:an,children:[e.jsx(g,{size:"md",leftIcon:e.jsx(tn,{}),rightIcon:e.jsx(pe,{}),onClick:()=>{window.open("https://github.com/railmapgen/railmapgen.github.io/issues","_blank"),S.event(B.RAISE_ISSUE)},children:t("Raise an Issue on GitHub")}),e.jsx(g,{size:"md",leftIcon:e.jsx(nn,{}),rightIcon:e.jsx(pe,{}),onClick:()=>{window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),S.event(B.JOIN_SLACK)},children:t("Join us on Slack")})]})]})}const qe=420,rn={flexShrink:0,flexDirection:"column",overflow:"hidden",alignItems:"flex-end",background:"inherit",transition:"0.3s ease-in-out",maxW:0,visibility:"hidden",boxShadow:"lg",zIndex:100,".show-menu &":{maxW:{base:"100%",md:qe},w:{base:"100%",md:"unset"},visibility:"initial"},"& > div":{flexDirection:"column",h:"100%",w:{base:"100vw",md:qe},background:"inherit","& .nav-menu__header":{flex:0,flexDirection:"row",alignItems:"center",minHeight:10,pl:12},"& .nav-menu__body":{flexDirection:"column",flex:1,overflowX:"hidden",overflowY:"auto",background:"inherit"}},"& .chakra-alert":{flexGrow:0,pl:3,pr:2,py:2,"& a":{fontWeight:"bold",textDecoration:"underline","&:hover, &:focus":{textDecoration:"none"}}}};function cn(){const{t}=w(),{menuView:s,lastShowDevtools:n}=H(i=>i.app),[a]=ss(),o=(S.getInstance()==="GitLab"?"https://railmapgen.gitlab.io/":"https://railmapgen.github.io/")+"?"+a.toString();return e.jsx(T,{sx:rn,children:e.jsxs(T,{children:[e.jsxs(T,{className:"nav-menu__header",children:[e.jsx(y,{as:"h4",size:"md",children:t("Rail Map Toolkit")}),e.jsx(Ks,{environment:S.getEnv(),version:S.getAppVersion()})]}),S.getEnv()!=="PRD"&&e.jsxs(re,{status:"warning",children:[e.jsx(ce,{}),e.jsxs(Ee,{children:[t("You're currently viewing a testing environment.")," ",e.jsx(Ze,{href:o,isExternal:!0,children:t("Back to production environment")})]})]}),e.jsxs(T,{className:"nav-menu__body",children:[s==="main"&&e.jsx(xt,{}),s==="main"?e.jsxs(e.Fragment,{children:[e.jsx(Je,{assetType:"app"}),as(n)&&e.jsx(Je,{assetType:"devtool"}),e.jsx(Et,{})]}):s==="settings"?e.jsx(Zt,{}):s==="support"?e.jsxs(e.Fragment,{children:[e.jsx(on,{}),e.jsx(sn,{})]}):s==="account"?e.jsx(yt,{}):e.jsx(e.Fragment,{})]}),e.jsx(Yt,{})]})})}function ln(t){const{isOpen:s,onClose:n}=t,{t:a}=w(),o=C.useRef(null),i=ds(),r=()=>{S.allowAnalytics(!0),n()},c=()=>{S.allowAnalytics(!1).refreshRequired?window.location.reload():n()};return e.jsxs(q,{initialFocusRef:o,isOpen:s,onClose:()=>{},children:[e.jsx(ie,{}),e.jsxs(X,{children:[e.jsx(Y,{children:a("CookiesModal.header")}),e.jsxs(Q,{children:[e.jsx(T,{justifyContent:"flex-end",mt:-5,children:e.jsx(is,{fields:[i]})}),e.jsx(b,{children:a("CookiesModal.text1")}),e.jsx(b,{mt:2,children:a("CookiesModal.text2")}),e.jsx(Le,{children:e.jsxs(te,{children:[" ",a("CookiesModal.item1")]})}),e.jsx(b,{mt:2,children:a("CookiesModal.text3")})]}),e.jsx(se,{children:e.jsxs(ee,{children:[e.jsx(g,{variant:"ghost",onClick:c,children:a("CookiesModal.reject")}),e.jsx(g,{ref:o,colorScheme:"primary",onClick:r,children:a("CookiesModal.accept")})]})})]})]})}const dn=()=>{};function hn(){const{t}=w(),[s,n]=C.useState(!1),a=()=>{n(!0),Gs(),setTimeout(()=>{window.location.reload()},1e3)};return e.jsx(q,{isOpen:!0,onClose:dn,children:e.jsxs(X,{children:[e.jsx(Y,{children:t("Rail Map Toolkit is opened in another window")}),e.jsx(Q,{children:t("You cannot open multiple Rail Map Toolkit at the same time. Please close this window.")}),e.jsx(se,{children:e.jsx(g,{colorScheme:"primary",onClick:a,isLoading:s,children:t("Restart RMT in this window")})})]})})}const un=()=>{};function pn(){const{t}=w();return e.jsx(q,{isOpen:!0,onClose:un,children:e.jsxs(X,{children:[e.jsx(Y,{children:t("Rail Map Toolkit is opened in another window")}),e.jsx(Q,{children:t("Current session has been terminated. Please close this window.")})]})})}function wn(){const{t}=w(),s=O(),{isPrimary:n,isTerminated:a,isShowMenu:o}=H(l=>l.app),[i,r]=C.useState(!1);C.useEffect(()=>{S.isAnalyticsQADone()||r(!0)},[]);const c=()=>{S.toggleNavMenu(!o),s(He()),S.event(B.TOGGLE_NAV_MENU)};return a?e.jsx(Ce,{children:e.jsx(pn,{})}):n===!1?e.jsx(Ce,{children:e.jsx(hn,{})}):e.jsx(Rs,{basename:"/",children:e.jsxs(Ce,{className:o?"show-menu":"",children:[e.jsx(he,{variant:o?"ghost":"solid",colorScheme:o?void 0:"primary",size:"md","aria-label":t("Toggle menu"),title:t("Toggle menu"),icon:e.jsx(dt,{}),position:"absolute",zIndex:110,borderRadius:0,onClick:c}),e.jsxs(qs,{sx:{flexDirection:"row"},children:[e.jsx(cn,{}),e.jsx(tt,{})]}),e.jsx(ln,{isOpen:i,onClose:()=>r(!1)})]})})}export{wn as default};

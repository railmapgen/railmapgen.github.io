import{j as e,S as P,G as R,I as pe,T as E,e as k,n as Te,o as $,C as K,F as ne,p as st,B as b,q as nt,u as at,s as Y,t as N,v as ot,P as ce,w as Pe,x as it,y as Ne,z as he,D as lt,A as De,E as rt,H as ct,b as z,c as V,d as te,g as Z,J as ze,K as we,O as be,Q as dt,U as ut,V as pt,l as xe,W as F,X,Y as ge,Z as ht,_ as me,$ as Ve,a0 as xt,a1 as se,a2 as gt,a3 as mt,a4 as jt,r as S,a5 as ft,a6 as St,a7 as wt,N as bt,a8 as vt,a9 as yt,aa as ke,ab as Ct,ac as Ue,ad as kt,ae as Mt,af as At,ag as Ot,ah as Rt,ai as Et,k as Lt,aj as It,M as _t,ak as Tt,al as Pt,am as Nt,an as Dt,i as zt,ao as Vt,m as Ut}from"./mantine-VgnFah2G.js";import{k as v,r as f,o as Be,R as W,B as Bt}from"./react-UC3gAxe5.js";import{u as _,o as je,F as Ft,a as O,b as Wt,S as q,l as T,s as Fe,f as J,g as fe,c as We,n as $e,d as Ge,e as $t,h as L,A as I,i as Gt,j as B,k as ve,m as Ht,p as Jt,E as D,q as Kt,t as ie,r as qt,v as Yt,w as Qt,x as He,y as Xt,z as Zt,B as es,C as ts,D as ss,G as ns,H as as}from"./main-C1pSQnO0.js";import{a as ee,b as Je,S as os,O as is,L as de}from"./asset-enablements-ZxtMOmcs.js";import"./index-C_hgTfa4.js";const ls="_burger_1y0se_1",rs={burger:ls},cs="_workspace_1nep4_1",ds="_show_1nep4_13",us="_welcome_1nep4_23",ps="_icons_1nep4_38",ae={workspace:cs,"app-container":"_app-container_1nep4_8",show:ds,welcome:us,icons:ps},hs="/assets/rmp-logo512-eHekupnf.png";function xs(){const{t}=v(),s=_();return e.jsxs(P,{className:ae.welcome,children:[e.jsxs(R,{className:ae.icons,grow:!0,children:[e.jsx(pe,{src:"/logo512.png",title:t("Open")+" "+t("Rail Map Generator"),onClick:()=>s(je({appId:"rmg"}))}),e.jsx(pe,{src:hs,title:t("Open")+" "+t("Rail Map Painter"),onClick:()=>s(je({appId:"rmp"}))})]}),e.jsx(E,{children:t("Welcome to Rail Map Toolkit")}),e.jsx(k,{children:t("Select an app to start your own rail map design!")})]})}function gs(t){const{tab:s,isActive:a}=t,n=f.useMemo(()=>s.url??"/"+s.app+"/",[s.app]);return e.jsx("div",{className:Te(ae["app-container"],a&&ae.show),children:e.jsx("iframe",{id:Ft+s.id,src:n,loading:"lazy",title:s.app,"data-persisted-url":s.url,"data-testid":"app-container-iframe"})})}function ms({alwaysShowWelcome:t}){const{openedTabs:s,activeTab:a}=O(o=>o.app),[,n]=Be();return f.useEffect(()=>{var o;if(a){const i=(o=s.find(c=>c.id===a))==null?void 0:o.app;n(i?{app:i}:{})}else n({})},[a]),e.jsx("div",{className:ae.workspace,children:t||s.length===0?e.jsx(xs,{}):s.map(o=>e.jsx(gs,{tab:o,isActive:a===o.id},o.id))})}const js="_root_mj6g1_5",fs="_wrapper_mj6g1_31",Ss="_alert_mj6g1_42",ws="_header_mj6g1_49",bs="_body_mj6g1_55",vs="_aside_mj6g1_62",ys="_main_mj6g1_75",G={root:js,"show-menu":"_show-menu_mj6g1_15",wrapper:fs,alert:Ss,header:ws,body:bs,aside:vs,main:ys},Cs="_card_15zs0_1",Me={card:Cs},Ae=(t,s,a)=>{const n=new Blob([a],{type:s});ks(t,n)},ks=(t,s)=>{const a=window.URL.createObjectURL(s),n=document.createElement("a");n.href=a,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(a)},Ms=()=>{const{t}=v(),{token:s,refreshToken:a,currentSaveId:n}=O(j=>j.account),{resolveConflictModal:{isOpen:o,lastChangedAtTimeStamp:i,lastUpdatedAtTimeStamp:c,cloudData:x}}=O(j=>j.rmpSave),d=_(),[p,u]=W.useState(!1),h=()=>d($t()),l=()=>{We(q.RMP,x),$e(),d(Ge(c)),h()},m=()=>{Ae(`RMP_${c}.json`,"application/json",x)},y=async()=>{if(!n||!s||!a)return;u(!0);const j=await Wt(n,s,a,q.RMP);if(!j){d(T()),u(!1);return}if(j.status===409){d(Fe()),u(!1);return}j.status===200&&(d(J()),u(!1),h())},w=async()=>{const{data:j}=await fe(q.RMP);Ae(`RMP_${i}.json`,"application/json",j)};return e.jsxs($,{opened:o,onClose:()=>{},size:"lg",title:t("Oops! It seems there's a conflict"),withCloseButton:!1,closeOnClickOutside:!1,closeOnEscape:!1,centered:!0,children:[e.jsx(k,{children:t("The local save is newer than the cloud one. Which one would you like to keep?")}),e.jsxs(R,{my:"xs",children:[e.jsx(K,{withBorder:!0,className:Me.card,children:e.jsxs(P,{children:[e.jsxs(ne,{children:[e.jsx(st,{}),e.jsx(k,{span:!0,children:t("Local save")})]}),e.jsxs(k,{span:!0,children:[t("Update at:")," ",new Date(i).toLocaleString()]}),e.jsx(b,{color:"red",loading:p,onClick:()=>y(),children:t("Replace cloud with local")}),e.jsx(b,{onClick:()=>w(),children:t("Download Local save")})]})}),e.jsx(K,{withBorder:!0,className:Me.card,children:e.jsxs(P,{children:[e.jsxs(ne,{children:[e.jsx(nt,{}),e.jsx(k,{span:!0,children:t("Cloud save")})]}),e.jsxs(k,{span:!0,children:[t("Update at:")," ",new Date(c).toLocaleString()]}),e.jsx(b,{color:"red",onClick:()=>l(),children:t("Replace local with cloud")}),e.jsx(b,{onClick:()=>m(),children:t("Download Cloud save")})]})})]})]})},As="_body_yczk0_1",Os={body:As};function Ke(t){const{initialValue:s,onSave:a,fontWeight:n="bold",iconVariant:o,textInputWidth:i,placeholder:c="...",emptyPlaceholder:x="(empty)"}=t,d=at(),[p,u]=f.useState(!1),[h,l]=f.useState(s),m=f.useRef(null),[y,w]=f.useState("");f.useEffect(()=>{p&&m.current&&(m.current.focus(),m.current.select())},[p]);const j=()=>{w(h),u(!0)},g=()=>{h!==y&&a(h),u(!1)},M=()=>{l(y),u(!1)},U=A=>{l(A.currentTarget.value)},r=A=>{A.key==="Enter"?g():A.key==="Escape"&&M()},C=()=>{g()};return p?e.jsx(R,{gap:"xs",wrap:"nowrap",style:{width:i},children:e.jsx(Y,{ref:m,value:h,onChange:U,onKeyDown:r,onBlur:C,placeholder:c,styles:{input:{fontWeight:n}}})}):e.jsxs(R,{gap:"xs",wrap:"nowrap",flex:"1",p:"0",onClick:j,style:{cursor:"pointer",padding:`calc(${d.spacing.xs} / 2) ${d.spacing.xs}`,minHeight:"36px",display:"flex",alignItems:"center",borderRadius:d.radius.sm,"&:hover":{backgroundColor:d.colors.gray[0]}},children:[e.jsx(k,{fw:n,style:{flexGrow:1,whiteSpace:"pre-wrap",wordBreak:"break-word"},children:h||x}),e.jsx(N,{variant:o,color:o=="subtle"?"gray":void 0,onClick:A=>{A.stopPropagation(),j()},title:"Edit",children:e.jsx(ot,{size:16})})]})}function Oe({meets:t,label:s}){return e.jsxs(k,{c:t?"teal":"red",style:{display:"flex",alignItems:"center"},mt:7,size:"sm",children:[t?e.jsx(Ne,{size:14}):e.jsx(he,{size:14}),e.jsx(lt,{ml:10,children:s})]})}const Se=[{re:/[0-9]/,label:"Includes number"},{re:/[a-zA-Z]/,label:"Includes letter"}];function Rs(t){let s=t.length>=8?0:1;return Se.forEach(a=>{a.re.test(t)||(s+=1)}),Math.max(100-100/(Se.length+1)*s,10)}function ye({value:t,onChange:s}){const{t:a}=v(),[n,o]=f.useState(!1),i=Se.map((d,p)=>e.jsx(Oe,{label:d.label,meets:d.re.test(t)},p)),c=Rs(t),x=c===100?"teal":c>50?"yellow":"red";return e.jsxs(ce,{opened:n,position:"bottom",width:"target",transitionProps:{transition:"pop"},children:[e.jsx(ce.Target,{children:e.jsx("div",{onFocusCapture:()=>o(!0),onBlurCapture:()=>o(!1),children:e.jsx(Pe,{label:a("Password"),value:t,onChange:d=>s(d.currentTarget.value)})})}),e.jsxs(ce.Dropdown,{children:[e.jsx(it,{color:x,value:c,size:5,mb:"xs"}),e.jsx(Oe,{label:a("Includes at least 8 characters"),meets:t.length>=8}),i]})]})}const Es=()=>{const{t}=v(),s=_(),{isLoggedIn:a,id:n,email:o,name:i,token:c,refreshToken:x}=O(j=>j.account),[d,p]=W.useState(void 0),[u,h]=W.useState(""),l=async()=>{a&&(await L(I.AUTH_LOGOUT,{method:"POST",body:JSON.stringify({refreshToken:x})}),s(T()))},m=j=>s(B({title:t("Unable to update account info"),message:j,type:"error",duration:9e3})),y=async j=>{if(a)try{const g=await L(I.USER+"/"+n,{method:"PATCH",body:JSON.stringify({name:j})},c);if(g.status===401){m(t("Login status expired")),s(T());return}if(g.status!==200){m(await g.text());return}s(Gt(j))}catch(g){m(g.message)}},w=async()=>{if(a)try{const j=await L(I.USER+"/"+n,{method:"PATCH",body:JSON.stringify({password:u})},c);if(j.status===401){m(t("Login status expired")),s(T());return}if(j.status!==200){m(await j.text());return}s(T()),p(void 0)}catch(j){m(j.message)}};return e.jsxs(e.Fragment,{children:[e.jsxs(ne,{py:"xs",align:"center",wrap:"wrap",children:[e.jsx(De,{size:"lg",name:i,color:"initials"}),e.jsxs(P,{justify:"center",ml:"md",gap:"0",flex:"1",children:[e.jsxs(R,{children:[e.jsx(Ke,{initialValue:i??"",onSave:j=>y(j),iconVariant:"subtle",textInputWidth:"181px"}),e.jsx(N,{variant:"subtle",color:"gray",size:"sm",onClick:()=>p("password"),"aria-label":t("Change password"),title:t("Change password"),children:e.jsx(rt,{})}),e.jsx(N,{variant:"subtle",color:"gray",size:"sm",onClick:l,"aria-label":t("Log out"),title:t("Log out"),children:e.jsx(ct,{})})]}),e.jsx(k,{span:!0,size:"sm",children:o})]})]}),e.jsxs($,{opened:!!d,onClose:()=>p(void 0),title:t("Update account info"),closeOnEscape:!1,children:[e.jsx(ye,{value:u,onChange:j=>h(j)}),e.jsx(R,{mt:"xs",children:e.jsx(b,{ml:"auto",onClick:w,children:t("Change")})})]})]})},Ls=/^\S+@\S+\.\S+$/,le=t=>!!t.match(Ls),qe=t=>t.length>=8&&!!t.match(/\d/)&&!!t.match(/[a-zA-Z]/),Re=60;function Ye({value:t,onChange:s,onVerify:a,otpSent:n,allowResendOtp:o,...i}){const{t:c}=v(),[x,d]=f.useState(!1),[p,u]=f.useState(Re),h=!!t&&le(t),l=()=>{o&&(d(!0),u(Re)),a()};return f.useEffect(()=>{let m;return x&&p>0?m=window.setTimeout(()=>{u(p-1)},1e3):p===0&&d(!1),()=>clearTimeout(m)},[x,p]),e.jsx(Y,{type:"email",label:c("Email"),value:t,onChange:({currentTarget:{value:m}})=>s(m),error:t&&!le(t),rightSection:n?e.jsx(b,{variant:"transparent",size:"xs",leftSection:e.jsx(Ne,{}),disabled:!0,children:c("Verification code sent")}):e.jsx(b,{variant:"subtle",size:"xs",onClick:l,disabled:!h||x,children:x?`${p}s`:c("Send verification code")}),rightSectionWidth:"fit-content",...i})}const Is=t=>{const{t:s}=v(),a=_(),[n,o]=f.useState(""),[i,c]=f.useState(""),[x,d]=f.useState(""),[p,u]=f.useState(""),[h,l]=f.useState(!1),y=!!n&&le(n)&&!!x&&!!i&&qe(i),w=M=>a(B({title:s("Unable to reset your password"),message:M,type:"error",duration:9e3})),j=async()=>{try{const M=await L(I.AUTH_SEND_RESET_PASSWORD_EMAIL,{method:"POST",body:JSON.stringify({email:n})});M.status===204?u(n):M.status>400&&u("error")}catch{u("error")}},g=async()=>{l(!0);const M=new URLSearchParams({token:x}),U=`${I.AUTH_RESET_PASSWORD}?${M.toString()}`;try{const r=await L(U,{method:"POST",body:JSON.stringify({password:i})});if(r.status!==204){w(await r.text());return}const{error:C,username:A}=(await a(ve({email:n,password:i}))).payload;C?w(C):a(B({title:s("Welcome ")+A,message:s("Your password has been reset successfully."),type:"success",duration:5e3}))}catch(r){w(r.message)}finally{l(!1)}};return e.jsxs(z,{children:[e.jsx(V,{children:e.jsx(E,{order:3,size:"h5",children:s("Forgot password")})}),e.jsxs(te,{direction:"column",gap:"xs",children:[p==="error"&&e.jsx(Z,{color:"red",icon:e.jsx(ze,{}),title:s("Check your email again!")}),p&&p!=="error"&&e.jsx(Z,{color:"blue",icon:e.jsx(we,{}),title:s("Email with reset link is sent to")+" "+p}),e.jsx(Ye,{value:n,onChange:o,onVerify:j,otpSent:p}),e.jsx(Y,{label:s("Reset password token"),value:x,onChange:({currentTarget:{value:M}})=>d(M)}),e.jsx(ye,{value:i,onChange:c}),e.jsx(b,{onClick:g,loading:h,disabled:!y||h,children:s("Reset password")}),e.jsx(b,{variant:"default",onClick:()=>t.setLoginState("login"),disabled:h,children:s("Back to log in")})]})]})},_s=/^\S+@\S+\.\S+$/,Ee=t=>!!t.match(_s),Ts=t=>{const{t:s}=v(),a=_(),[n,o]=f.useState(""),[i,c]=f.useState(""),[x,d]=f.useState(!1),p=!!n&&Ee(n)&&!!i,u=async()=>{d(!0);try{const{error:h,username:l}=(await a(ve({email:n,password:i}))).payload;a(h?B({title:s("Unable to login"),message:h,type:"error",duration:9e3}):B({title:s("Welcome ")+l,message:s("Login success"),type:"success",duration:5e3}))}finally{d(!1)}};return e.jsxs(z,{children:[e.jsx(V,{children:e.jsx(E,{order:3,size:"h5",children:s("Log in")})}),e.jsxs(te,{direction:"column",gap:"xs",children:[e.jsx(Y,{type:"email",label:s("Email"),value:n,onChange:({currentTarget:{value:h}})=>o(h),error:n&&!Ee(n)}),e.jsx(Pe,{label:s("Password"),value:i,onChange:({currentTarget:{value:h}})=>c(h)}),e.jsx(be,{component:"button",ml:"auto",onClick:()=>t.setLoginState("forgot-password"),children:s("Forgot password")+"?"}),e.jsx(b,{onClick:u,loading:x,disabled:!p||x,children:s("Log in")}),e.jsx(b,{variant:"default",onClick:()=>t.setLoginState("register"),disabled:x,children:s("Create an account")})]})]})},Ps=t=>{const{t:s}=v(),a=_(),[n,o]=f.useState(""),[i,c]=f.useState(""),[x,d]=f.useState(""),[p,u]=f.useState(""),[h,l]=f.useState(""),[m,y]=f.useState(!1),w=!!i&&le(i),j=!!n&&w&&!!p&&!!x&&qe(x),g=r=>a(B({title:s("Unable to create your account"),message:r,type:"error",duration:9e3})),M=async()=>{try{const r=await L(I.AUTH_SEND_VERIFICATION_EMAIL,{method:"POST",body:JSON.stringify({email:i})});r.status===204?l(i):r.status>400&&l("error")}catch{l("error")}},U=async()=>{y(!0);try{const r=await L(I.AUTH_REGISTER,{method:"POST",body:JSON.stringify({name:n,email:i,password:x,emailVerificationToken:Number(p)})});if(r.status!==201){g(await r.text());return}const{error:C,username:A}=(await a(ve({email:i,password:x}))).payload;C?g(C):a(B({title:s("Welcome ")+A,message:s("Your account is created successfully."),type:"success",duration:5e3}))}catch(r){g(r.message)}finally{y(!1)}};return e.jsxs(z,{children:[e.jsx(V,{children:e.jsx(E,{order:3,size:"h5",children:s("Create an account")})}),e.jsxs(te,{direction:"column",gap:"xs",children:[h==="error"&&e.jsx(Z,{color:"red",icon:e.jsx(ze,{}),title:s("The email is not valid!")}),h&&h!=="error"&&e.jsx(Z,{color:"blue",icon:e.jsx(we,{}),title:s("Verification email is sent to")+" "+h}),e.jsx(Y,{label:s("Name"),description:s("You may always change it later."),value:n,onChange:({currentTarget:{value:r}})=>o(r)}),e.jsx(Ye,{description:s("We'll never share your email."),value:i,onChange:c,onVerify:M,otpSent:h,allowResendOtp:!0}),e.jsx(Y,{label:s("Verification code"),value:p,onChange:({currentTarget:{value:r}})=>u(r)}),e.jsx(ye,{value:x,onChange:d}),e.jsx(b,{onClick:U,loading:m,disabled:!j||m,children:s("Sign up")}),e.jsx(b,{variant:"default",onClick:()=>t.setLoginState("login"),disabled:m,children:s("Back to log in")})]})]})},Ns=1,Ds=10,zs=()=>{const{t}=v(),s=_(),{isLoggedIn:a,token:n,activeSubscriptions:o,currentSaveId:i,saves:c}=O(r=>r.account),{lastChangedAtTimeStamp:x}=O(r=>r.rmpSave),d=a&&c&&(o.RMP_CLOUD?c.length<Ds:c.length<Ns),p=Math.min(...(c??[]).map(r=>r.id)),u=r=>!o.RMP_CLOUD&&r!==p,[h,l]=W.useState(void 0),[m,y]=W.useState(void 0),w=r=>s(B({title:t("Unable to sync your save"),message:r,type:"error",duration:9e3})),j=async()=>{const r=await fe(q.RMP);if(!a||!r||!n){w(t("Failed to get the RMP save!"));return}const{data:C,hash:A}=r,oe=crypto.randomUUID();try{const H=await L(I.SAVES,{method:"POST",body:JSON.stringify({index:oe,data:C,hash:A})},n);if(H.status===401){w(t("Login status expired")),s(T());return}if(H.status!==200){w(await H.text());return}s(J())}catch(H){w(H.message)}},g=async r=>{if(!(!a||!n)){if(r===i){if(l(i),!i||u(i)){w(t("Can not sync this save!")),l(void 0);return}const C=await s(J());if(C.meta.requestStatus!=="fulfilled"){w(t("Login status expired")),l(void 0);return}const oe=C.payload.saves.filter(tt=>tt.id===i).at(0);if(!oe){w(t("Current save id is not in saveList!")),l(void 0);return}const H=new Date(oe.lastUpdateAt);if(new Date(x)<H){xe.warn(`Save id: ${i} is newer in the cloud via local compare.`),s(Fe()),l(void 0);return}const Ce=await fe(q.RMP);if(!Ce){w(t("Failed to get the RMP save!")),l(void 0);return}const{data:Ze,hash:et}=Ce,re=await L(I.SAVES+"/"+i,{method:"PATCH",body:JSON.stringify({data:Ze,hash:et})},n);if(re.status===401){w(t("Login status expired")),l(void 0),s(T());return}if(re.status!==200){w(await re.text()),l(void 0);return}l(void 0)}else{l(r);const C=await L(I.SAVES+"/"+r,{},n);if(C.status===401){w(t("Login status expired")),l(void 0),s(T());return}if(C.status!==200){w(await C.text()),l(void 0);return}xe.info(`Set ${q.RMP} with save id: ${r}`),We(q.RMP,await C.text()),s(Ge(new Date().valueOf())),$e(),l(void 0)}s(J())}},M=async r=>{if(!a||!r||!n)return;y(r);const C=await L(I.SAVES+"/"+i,{method:"DELETE"},n);if(C.status===401){w(t("Login status expired")),y(void 0),s(T());return}if(C.status!==200){w(await C.text()),y(void 0);return}s(J()),y(void 0)},U=async(r,C)=>{if(!a||!r||!n)return;const A=await L(`${I.SAVES}/${r}/metadata`,{method:"PATCH",body:JSON.stringify({index:C})},n);if(A.status===401){w(t("Login status expired")),s(T());return}if(A.status!==200){w(await A.text());return}s(J())};return e.jsxs(z,{children:[e.jsxs(V,{align:"center",children:[e.jsx(E,{order:3,size:"h5",flex:"1",children:t("Synced saves")}),e.jsx(b,{variant:"subtle",size:"xs",ml:"xs",disabled:!d,onClick:j,children:t(d?"Create":"Subscribe to sync more")})]}),e.jsx(te,{direction:"column",gap:"xs",children:c==null?void 0:c.map(r=>e.jsxs(K,{withBorder:!0,shadow:"sm",children:[e.jsxs(R,{children:[e.jsx(Ke,{initialValue:r.index,onSave:C=>U(r.id,C),textInputWidth:"207px"}),e.jsx(N,{disabled:u(r.id),loading:h===r.id,onClick:()=>g(r.id),title:r.id===i?t("Sync now"):t("Sync this slot"),children:r.id===i?e.jsx(dt,{}):e.jsx(ut,{})}),e.jsx(N,{color:"red",loading:m===r.id,onClick:()=>M(r.id),title:t("Delete"),children:e.jsx(pt,{})})]}),e.jsxs(R,{justify:"space-between",mt:"md",mb:"md",children:[e.jsxs(k,{children:[t("ID"),": ",r.id]}),e.jsxs(k,{children:[t("Status"),": ",r.id===i?t("Current save"):t("Cloud save")]})]}),e.jsxs(k,{children:[t("Last update at"),": ",new Date(r.lastUpdateAt).toLocaleString()]})]},r.id))})]})},Vs=t=>{const{t:s}=v(),{opened:a,onClose:n,getSubscriptions:o}=t,{isLoggedIn:i,token:c}=O(l=>l.account),x=_(),[d,p]=W.useState(""),u=l=>x(B({title:s("Unable to redeem"),message:l,type:"error",duration:9e3})),h=async l=>{if(!i)return;const m=await L(I.SUBSCRIPTION_REDEEM,{method:"POST",body:JSON.stringify({cdkey:l.trim()})},c);if(m.status===401){u(s("Login status expired")),x(T());return}if(m.status!==202){const y=(await m.json()).message;u(s(y));return}await o(),n()};return e.jsxs($,{opened:a,onClose:n,title:s("Redeem your subscription"),children:[e.jsx(k,{children:s("CDKey could be purchased in the following sites:")}),e.jsx(F,{withPadding:!0,mt:"xs",children:e.jsx(F.Item,{children:e.jsxs(be,{href:"https://afdian.com/item/9c8b220c614311efab2d52540025c377",target:"_blank",children:["爱发电 ",e.jsx(X,{})]})})}),e.jsxs(R,{align:"flex-end",gap:"sm",mt:"xs",children:[e.jsx(Y,{label:"CDKey",placeholder:s("Enter your CDKey here"),value:d,onChange:({currentTarget:{value:l}})=>p(l),style:{minWidth:240}}),e.jsx(b,{onClick:()=>h(d),children:s("Redeem")})]})]})},Us=()=>{const{t}=v(),{isLoggedIn:s,token:a}=O(u=>u.account),n=_(),[o,i]=W.useState([]),[c,x]=W.useState(!1),d=u=>n(B({title:t("Unable to retrieve your subscriptions"),message:u,type:"error",duration:9e3})),p=async()=>{if(!s)return;const u=await L(I.SUBSCRIPTION,{},a);if(u.status===401){d(t("Login status expired")),n(T());return}if(u.status!==200){d(await u.text());return}const h=(await u.json()).subscriptions;if(!h.map(m=>m.type).includes("RMP_CLOUD"))return;i([{type:"RMP",expires:h[0].expires}]);const l=structuredClone(Ht);for(const m of h){const y=m.type;y in l&&(l[y]=!0)}n(Jt(l))};return W.useEffect(()=>{p()},[]),e.jsxs(z,{children:[e.jsxs(V,{align:"center",children:[e.jsx(E,{order:3,size:"h5",children:t("All subscriptions")}),e.jsx(b,{variant:"subtle",size:"xs",ml:"auto",onClick:()=>x(!0),children:t("Redeem")})]}),e.jsxs(te,{direction:"column",gap:"xs",children:[o.length===0&&e.jsxs(K,{withBorder:!0,shadow:"sm",children:[e.jsx(K.Section,{p:"xs",children:e.jsx(E,{order:4,size:"h3",children:t("Rail Map Painter")})}),e.jsxs(P,{gap:"xs",children:[e.jsx(k,{children:t("With this subscription, the following features are unlocked:")}),e.jsxs(F,{withPadding:!0,children:[e.jsx(F.Item,{children:t("PRO features")}),e.jsx(F.Item,{children:t("Sync 9 more saves")}),e.jsx(F.Item,{children:t("Unlimited master nodes")}),e.jsx(F.Item,{children:t("Unlimited parallel lines")})]}),e.jsxs(k,{children:[t("Expires at:")," ",t("Not applicable")]})]})]}),o.map(u=>e.jsxs(K,{withBorder:!0,shadow:"sm",children:[e.jsx(K.Section,{p:"xs",children:e.jsx(E,{order:4,size:"h3",children:t(u.type==="RMP"?"Rail Map Painter":u.type)})}),e.jsxs(P,{gap:"xs",children:[e.jsxs(k,{children:[t("Expires at:")," ",new Date(u.expires).toLocaleString()]}),e.jsx(b,{color:"blue",onClick:()=>x(!0),children:t("Renew")})]})]},u.type))]}),e.jsx(Vs,{opened:c,onClose:()=>x(!1),getSubscriptions:p})]})},Bs=()=>{const{t}=v(),{isLoggedIn:s}=O(o=>o.account),[a,n]=f.useState("login");return e.jsxs(z,{children:[e.jsx(V,{children:e.jsx(E,{order:2,size:"h4",children:t("Account")})}),s?e.jsxs(te,{className:Os.body,children:[e.jsx(Es,{}),e.jsx(ge,{}),e.jsx(Us,{}),e.jsx(zs,{})]}):a==="login"?e.jsx(Ts,{setLoginState:n}):a==="register"?e.jsx(Ps,{setLoginState:n}):e.jsx(Is,{setLoginState:n})]})},Fs="_button_1hzui_1",Ws="_label_1hzui_11",Q={button:Fs,label:Ws,"sub-label":"_sub-label_1hzui_17"};function Qe(){return ht("(min-width: 36em)")}function $s(t){var j;const{appId:s,onAboutOpen:a}=t,{t:n}=v(),o=_(),i=Qe(),{activeTab:c,openedTabs:x}=O(g=>g.app),d=ee[s],p=d.name.split(" - ").map(g=>n(g)).join(" - "),u=x.some(g=>g.app===s),h=!d.allowMultiInstances&&((j=x.find(g=>g.id===c))==null?void 0:j.app)===s,l=g=>{u||S.event(D.OPEN_APP,{appId:s,isOpenInNew:g}),o(g?Kt(s):je({appId:s})),i||(o(ie()),S.toggleNavMenu(!1))},m=g=>{o(qt(g)),i||(o(ie()),S.toggleNavMenu(!1))},y=g=>{o(Yt(g)),S.event(D.CLOSE_APP,{app:s})},w=g=>{o(Qt(g)),S.event(D.CLOSE_APP,{app:g})};return e.jsx(me,{component:"div",role:"button",variant:"filled",label:p,active:h,classNames:{root:Q.button,label:Q.label},leftSection:u?e.jsx(jt,{title:n("Running")}):void 0,rightSection:e.jsxs(e.Fragment,{children:[d.allowMultiInstances&&e.jsx(N,{"aria-label":n("New tab"),title:n("New tab"),variant:"subtle",color:h?"white":"gray",mr:4,onClick:g=>{g.stopPropagation(),l(!0)},children:e.jsx(xt,{})}),e.jsxs(se,{children:[e.jsx(se.Target,{children:e.jsx(N,{variant:"subtle",color:h?"white":"gray",onClick:g=>g.stopPropagation(),children:e.jsx(gt,{})})}),e.jsxs(se.Dropdown,{children:[u&&e.jsx(se.Item,{leftSection:e.jsx(he,{}),onClick:g=>{g.stopPropagation(),w(s)},children:d.allowMultiInstances?n("Close all tabs"):n("Close app")}),e.jsx(se.Item,{leftSection:e.jsx(mt,{}),onClick:g=>{g.stopPropagation(),a()},children:n("About")})]})]})]}),disableRightSectionRotation:!0,opened:!0,onClick:()=>l(!1),children:d.allowMultiInstances&&x.filter(g=>g.app===s).map((g,M)=>{const U=g.id===c;return e.jsx(me,{component:"div",role:"button",variant:"filled",active:U,label:e.jsxs(e.Fragment,{children:[e.jsx(Ve,{color:"lightgray",c:"black",mr:"xs",circle:!0,display:"inline-flex",children:M+1}),g.title??n("Tab")+" "+(M+1).toString()+" - "+p]}),classNames:{root:Q.button,label:Q["sub-label"]},rightSection:e.jsx(N,{variant:"subtle",color:U?"white":"gray","aria-label":n("Close tab"),title:n("Close tab"),onClick:r=>{r.stopPropagation(),y(g.id)},children:e.jsx(he,{})}),onClick:()=>m(g.id)},g.id)})})}const Gs=async t=>{const s=`/${t}/info.json`;try{return(await(await fetch(s)).json()).version}catch(a){return xe.info(`Failed to get version of ${t}`,a),"unknown"}};function Hs(t){var x,d,p;const{appId:s,onClose:a}=t,{t:n}=v(),[o,i]=f.useState("Unknown"),c=s?(p=(d=(x=ee[s])==null?void 0:x.url)==null?void 0:d.split("/"))==null?void 0:p[1]:void 0;return f.useEffect(()=>{c?Gs(c).then(u=>i(u)):i("Unknown")},[c]),e.jsx($,{opened:!!s,onClose:a,size:"xl",title:e.jsxs(e.Fragment,{children:[n("About")+" "+(s?ee[s].name.split(" - ").map(u=>n(u)).join(" - "):""),e.jsx(Ve,{color:"gray",radius:"sm",ml:"xs",children:o})]}),children:e.jsx(b,{component:"a",href:"https://github.com/railmapgen/"+c,target:"_blank",children:n("Visit GitHub")})})}function Le({assetType:t}){const{t:s}=v(),[a,n]=f.useState(),o=Je(t,S.getEnv(),S.getInstance());return e.jsxs(z,{children:[e.jsx(V,{children:e.jsx(E,{order:2,size:"h4",children:s(t==="devtool"?"Devtools":"Apps")})}),e.jsx(ne,{direction:"column",children:o.map(i=>e.jsx($s,{appId:i,onAboutOpen:()=>n(i)},i))}),e.jsx(Hs,{appId:a,onClose:()=>n(void 0)})]})}function Js(){const{t}=v(),s=Je("link",S.getEnv(),S.getInstance()),a=n=>{S.event(D.OPEN_LINK,{id:n})};return e.jsxs(z,{children:[e.jsx(V,{children:e.jsx(E,{order:2,size:"h4",children:t("Useful links")})}),e.jsx(ne,{direction:"column",children:s.map(n=>e.jsx(me,{variant:"filled",label:t(ee[n].name),classNames:{root:Q.button,label:Q.label},rightSection:e.jsx(X,{}),href:ee[n].url,target:"_blank",onClick:()=>a(n)},n))})]})}const Ie={"textarea-label":"_textarea-label_kau51_1","textarea-input":"_textarea-input_kau51_5"};function Ks(t){var d;const{opened:s,onClose:a}=t,{t:n}=v(),[o,i]=f.useState(),c=Object.entries(localStorage),x=()=>{o&&(window.localStorage.removeItem(o),window.location.reload())};return e.jsxs($,{opened:s,onClose:a,size:"xl",title:n("Local Storage"),children:[e.jsx(P,{gap:"xs",children:c.map(p=>e.jsx(ft,{label:e.jsxs(R,{align:"center",gap:"xs",children:[p[0],e.jsx(N,{variant:"default",size:"xs",title:n("Remove this item"),"aria-label":n("Remove this item"),onClick:()=>i(p[0]),children:e.jsx(St,{})})]}),value:p[1],readOnly:!0,rows:4,classNames:{label:Ie["textarea-label"],input:Ie["textarea-input"]}},p[0]))}),e.jsx(R,{pt:"xs",children:e.jsx(b,{ml:"auto",onClick:a,children:n("Go back")})}),o&&e.jsxs($,{opened:!0,onClose:()=>i(void 0),centered:!0,title:n("Warning"),children:[e.jsxs(k,{children:[n("LocalStorageModal.text1"),e.jsx(wt,{children:o}),n("LocalStorageModal.text2"),e.jsx(k,{span:!0,fw:500,children:n(((d=ee[o.split("__")[0]])==null?void 0:d.name)??"Unknown app")}),n("LocalStorageModal.text3"),e.jsx("br",{}),n("LocalStorageModal.text4")]}),e.jsxs(R,{gap:"xs",mt:"xs",children:[e.jsx(b,{variant:"default",ml:"auto",onClick:()=>i(void 0),children:n("Back")}),e.jsx(b,{color:"red",onClick:x,children:n("Delete and reload")})]})]})]})}function Xe(t){const{t:s}=v(),a=[{group:s("Main languages"),items:os.map(n=>({value:n,label:de[n][n]}))},{group:s("Other languages"),items:is.map(n=>({value:n,label:de[n][n]??de[n].en}))}];return e.jsx(bt,{label:s("Language"),defaultValue:S.getLanguage(),onChange:({currentTarget:{value:n}})=>{const o=n;S.setLanguage(o),S.getI18nInstance().changeLanguage(o),S.event(D.CHANGE_LANGUAGE,{language:o})},data:a,...t})}function qs(){const{t}=v(),{setColorScheme:s}=vt(),a=_(),{lastShowDevtools:n,refreshRequired:o}=O(l=>l.app),[i,c]=f.useState(S.isAllowAnalytics()),[x,d]=f.useState(!1),p=He(n),u=l=>{c(l),S.allowAnalytics(l).refreshRequired&&a(es())},h=[{value:"light",label:t("Light")},{value:"dark",label:t("Dark")},{value:"system",label:t("System")}];return e.jsxs(z,{children:[o&&e.jsx(Z,{color:"blue",icon:e.jsx(we,{}),mb:"xs",children:t("Refreshing is required for changes to take effect.")}),e.jsx(V,{children:e.jsx(E,{order:2,size:"h4",children:t("Settings")})}),e.jsxs(P,{gap:"xs",py:"xs",children:[e.jsx(Xe,{}),e.jsx(yt,{size:"sm",label:t("Appearance"),defaultValue:S.getColourMode(),onChange:l=>{s(l==="system"?"auto":l),S.setColourMode(l)},data:h}),e.jsx(ke,{label:t("Allow cookies to help improve our website"),labelPosition:"left",checked:i,onChange:({currentTarget:{checked:l}})=>u(l),disabled:o,styles:{labelWrapper:{flex:1}}}),e.jsx(ke,{label:t("Show dev tools for 1 day"),labelPosition:"left",checked:p,onChange:({currentTarget:{checked:l}})=>{l?(a(Xt()),S.event(D.SHOW_DEVTOOLS)):a(Zt())},styles:{labelWrapper:{flex:1}}}),p&&e.jsx(b,{variant:"default",leftSection:e.jsx(Ct,{}),onClick:()=>d(!0),children:t("Export Local Storage")})]}),p&&e.jsx(Ks,{opened:x,onClose:()=>d(!1)})]})}function Ys(){const{t}=v(),{remoteFonts:s}=O(a=>a.app);return e.jsxs(z,{children:[e.jsx(V,{children:e.jsx(E,{order:2,size:"h4",children:t("Web fonts")})}),e.jsxs(P,{gap:"xs",children:[e.jsxs(k,{fs:"italic",children:[t("FontsSection.text1")," ",t("FontsSection.text2")," ",t("FontsSection.text3")," (",t("FontsSection.safari"),")"]}),Object.entries(s).map(([a,n])=>e.jsx(b,{variant:"default",rightSection:n.url?e.jsx(X,{}):void 0,disabled:!n.url,onClick:()=>{window.open(n.url,"_blank"),S.event(D.DOWNLOAD_FONT,{family:a})},children:n.displayName?`${n.displayName} (${a})`:a},a))]})]})}const Qs="_bilibili_5ep1h_1",Xs={bilibili:Qs};function Zs(t){return Ue({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 32C132.3 32 32 134.9 32 261.7c0 101.5 64.2 187.5 153.2 217.9a17.56 17.56 0 0 0 3.8.4c8.3 0 11.5-6.1 11.5-11.4 0-5.5-.2-19.9-.3-39.1a102.4 102.4 0 0 1-22.6 2.7c-43.1 0-52.9-33.5-52.9-33.5-10.2-26.5-24.9-33.6-24.9-33.6-19.5-13.7-.1-14.1 1.4-14.1h.1c22.5 2 34.3 23.8 34.3 23.8 11.2 19.6 26.2 25.1 39.6 25.1a63 63 0 0 0 25.6-6c2-14.8 7.8-24.9 14.2-30.7-49.7-5.8-102-25.5-102-113.5 0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8a18.64 18.64 0 0 1 5-.5c8.1 0 26.4 3.1 56.6 24.1a208.21 208.21 0 0 1 112.2 0c30.2-21 48.5-24.1 56.6-24.1a18.64 18.64 0 0 1 5 .5c12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6 0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5 0 30.7-.3 55.5-.3 63 0 5.4 3.1 11.5 11.4 11.5a19.35 19.35 0 0 0 4-.4C415.9 449.2 480 363.1 480 261.7 480 134.9 379.7 32 256 32z"},child:[]}]})(t)}function en(t){return Ue({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M126.12 315.1A47.06 47.06 0 1 1 79.06 268h47.06zm23.72 0a47.06 47.06 0 0 1 94.12 0v117.84a47.06 47.06 0 1 1-94.12 0zm47.06-188.98A47.06 47.06 0 1 1 244 79.06v47.06zm0 23.72a47.06 47.06 0 0 1 0 94.12H79.06a47.06 47.06 0 0 1 0-94.12zm188.98 47.06a47.06 47.06 0 1 1 47.06 47.1h-47.06zm-23.72 0a47.06 47.06 0 0 1-94.12 0V79.06a47.06 47.06 0 1 1 94.12 0zM315.1 385.88a47.06 47.06 0 1 1-47.1 47.06v-47.06zm0-23.72a47.06 47.06 0 0 1 0-94.12h117.84a47.06 47.06 0 1 1 0 94.12z"},child:[]}]})(t)}function tn(){const{t}=v();return e.jsxs(z,{children:[e.jsx(V,{children:e.jsx(E,{order:2,size:"h4",children:t("Help & support")})}),e.jsxs(P,{gap:"xs",children:[e.jsx(b,{variant:"default",leftSection:e.jsx(Zs,{}),rightSection:e.jsx(X,{}),onClick:()=>{window.open("https://github.com/railmapgen/railmapgen.github.io/issues","_blank"),S.event(D.RAISE_ISSUE)},children:t("Raise an Issue on GitHub")}),e.jsx(b,{variant:"default",leftSection:e.jsx(en,{}),rightSection:e.jsx(X,{}),onClick:()=>{window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),S.event(D.JOIN_SLACK)},children:t("Join us on Slack")}),e.jsx(b,{variant:"default",leftSection:e.jsx(pe,{className:Xs.bilibili,src:"images/bilibili.svg"}),rightSection:e.jsx(X,{}),onClick:()=>{window.open("https://space.bilibili.com/10124055","_blank"),S.event(D.FOLLOW_BILIBILI)},children:t("Follow us on Bilibili")})]})]})}function sn(){const{t}=v(),{isShowMenu:s,menuView:a,lastShowDevtools:n}=O(h=>h.app),{isLoggedIn:o,name:i}=O(h=>h.account),c=_(),x=Qe(),[d]=Be(),p=(S.getInstance()==="GitLab"?"https://railmapgen.gitlab.io/":"https://railmapgen.github.io/")+"?"+d.toString();f.useEffect(()=>{o&&c(J())},[o]);const u=[{key:"apps",label:t("Apps"),Icon:e.jsx(kt,{size:22})},{key:"links",label:t("Useful links"),Icon:e.jsx(Mt,{size:22})},{key:"devtools",label:t("Devtools"),Icon:e.jsx(At,{size:22}),ActionIconProps:{style:{display:He(n)?"inline-flex":"none"}}},{key:"account",label:t("Account"),Icon:e.jsx(De,{variant:"light",name:o?i:void 0,size:"sm",color:"initials"}),ActionIconProps:{mt:"auto"}},{key:"contributors",label:t("Contributors"),Icon:e.jsx(Ot,{size:22}),ActionIconProps:{onClick:()=>{c(ts("contributors")),x||(c(ie()),S.toggleNavMenu(!1))}}},{key:"support",label:t("Help & support"),Icon:e.jsx(Rt,{size:22})},{key:"settings",label:t("Settings"),Icon:e.jsx(Et,{size:22})}];return e.jsx("nav",{className:Te(G.root,s&&G["show-menu"]),children:e.jsxs("div",{className:G.wrapper,children:[e.jsxs(Lt,{className:G.header,children:[e.jsx(E,{children:t("Rail Map Toolkit")}),e.jsx(It,{env:S.getEnv(),ver:S.getAppVersion()})]}),e.jsx(ge,{}),S.getEnv()!=="PRD"&&e.jsxs(Z,{color:"yellow",icon:e.jsx(_t,{}),className:G.alert,children:[t("You're currently viewing a testing environment.")," ",e.jsx(be,{size:"sm",href:p,target:"_blank",children:t("Back to production environment")})]}),e.jsxs("div",{className:G.body,children:[e.jsx("div",{className:G.aside,children:u.map(({key:h,label:l,Icon:m,ActionIconProps:y})=>e.jsx(Tt,{label:l,position:"right",withArrow:!0,children:e.jsx(N,{variant:a===h?"light":"subtle",color:a===h?void 0:"gray",size:"lg",onClick:()=>c(ss(h)),...y,children:m})},h))}),e.jsx(ge,{orientation:"vertical"}),e.jsxs("div",{className:G.main,children:[a==="apps"?e.jsx(Le,{assetType:"app"}):a==="links"?e.jsx(Js,{}):a==="devtools"?e.jsx(Le,{assetType:"devtool"}):a==="settings"?e.jsx(qs,{}):a==="support"?e.jsxs(e.Fragment,{children:[e.jsx(tn,{}),e.jsx(Ys,{})]}):a==="account"?e.jsx(Bs,{}):e.jsx(e.Fragment,{}),e.jsx(Ms,{})]})]})]})})}function nn(t){const{opened:s,onClose:a}=t,{t:n}=v(),o=()=>{S.allowAnalytics(!0),a()},i=()=>{S.allowAnalytics(!1).refreshRequired?window.location.reload():a()};return e.jsxs($,{opened:s,onClose:()=>{},title:n("CookiesModal.header"),withCloseButton:!1,closeOnEscape:!1,closeOnClickOutside:!1,centered:!0,children:[e.jsx(R,{children:e.jsx(Xe,{ml:"auto"})}),e.jsxs(P,{gap:"xs",py:"xs",children:[e.jsx(k,{children:n("CookiesModal.text1")}),e.jsx(k,{mt:2,children:n("CookiesModal.text2")}),e.jsx(F,{withPadding:!0,children:e.jsxs(F.Item,{children:[" ",n("CookiesModal.item1")]})}),e.jsx(k,{mt:2,children:n("CookiesModal.text3")})]}),e.jsxs(R,{gap:"sm",children:[e.jsx(b,{variant:"default",ml:"auto",onClick:i,children:n("CookiesModal.reject")}),e.jsx(b,{onClick:o,children:n("CookiesModal.accept")})]})]})}const an=()=>{};function on(){const{t}=v(),[s,a]=f.useState(!1),n=()=>{a(!0),ns(),setTimeout(()=>{window.location.reload()},1e3)};return e.jsxs($,{opened:!0,onClose:an,title:t("Rail Map Toolkit is opened in another window"),withCloseButton:!1,closeOnEscape:!1,closeOnClickOutside:!1,centered:!0,children:[e.jsx(k,{children:t("You cannot open multiple Rail Map Toolkit at the same time. Please close this window.")}),e.jsx(R,{mt:"xs",children:e.jsx(b,{variant:"default",onClick:n,loading:s,disabled:s,children:t("Restart RMT in this window")})})]})}const ln=()=>{};function rn(){const{t}=v();return e.jsx($,{opened:!0,onClose:ln,title:t("Rail Map Toolkit is opened in another window"),withCloseButton:!1,closeOnEscape:!1,closeOnClickOutside:!1,centered:!0,children:e.jsx(k,{children:t("Current session has been terminated. Please close this window.")})})}const cn="_root_nos1z_1",dn={root:cn},un={info:void 0,success:"green",warning:"yellow",error:"red"},ue=200,_e=400;function pn({notification:t}){const s=_(),[a,n]=f.useState(!1);return f.useEffect(()=>{setTimeout(()=>{n(!0)},ue);const o=setTimeout(()=>{n(!1)},ue+t.duration);return setTimeout(()=>{s(as(t.id))},ue+t.duration+_e),()=>{clearTimeout(o)}},[]),e.jsx(Pt,{mounted:a,transition:"slide-left",duration:_e,timingFunction:"ease",children:o=>e.jsx(Nt,{color:un[t.type],title:t.title,onClose:()=>n(!1),withBorder:!0,style:o,children:t.message})})}function hn(){const{notifications:t}=O(s=>s.notification);return e.jsx(Dt,{children:e.jsx(P,{className:dn.root,children:t.map(s=>e.jsx(pn,{notification:s},s.id))})})}function wn(){const{t}=v(),s=_(),{isPrimary:a,isTerminated:n,isShowMenu:o}=O(d=>d.app),[i,c]=f.useState(!1);f.useEffect(()=>{S.isAnalyticsQADone()||c(!0)},[]);const x=()=>{S.toggleNavMenu(!o),s(ie()),S.event(D.TOGGLE_NAV_MENU)};return e.jsx(Bt,{basename:"/",children:e.jsxs(zt,{className:o?"show-menu":"",children:[e.jsx(N,{className:rs.burger,variant:o?"subtle":"filled",color:o?"gray":void 0,"aria-label":t("Toggle menu"),title:t("Toggle menu"),onClick:x,children:e.jsx(Vt,{})}),e.jsxs(Ut,{direction:"row",children:[e.jsx(sn,{}),e.jsx(ms,{alwaysShowWelcome:n||a===!1})]}),e.jsx(hn,{}),n&&e.jsx(rn,{}),a===!1&&e.jsx(on,{}),e.jsx(nn,{opened:i,onClose:()=>c(!1)})]})})}export{wn as default};
